
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module LowerBound</title>
<meta name="description" content="Documentation of Coq module LowerBound" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module LowerBound</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CoqlibC</span> <span class="id">Maps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ASTC</span> <span class="id">Integers</span> <span class="id">Floats</span> <span class="id">Values</span> <span class="id">MemoryC</span> <span class="id">Events</span> <span class="id">Globalenvs</span> <span class="id">Smallstep</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Locations</span> <span class="id">Stacklayout</span> <span class="id">Conventions</span> <span class="id">Linking</span>.<br/>
<div class="doc">newly added *</div>
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id">Asm</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Simulation</span> <span class="id">Memory</span> <span class="id">ValuesC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Skeleton</span> <span class="id">ModSem</span> <span class="id">Mod</span> <span class="id">sflib</span> <span class="id">StoreArguments</span> <span class="id">StoreArgumentsProps</span> <span class="id">AsmC</span> <span class="id">AsmregsC</span> <span class="id">Sem</span> <span class="kwd">Syntax</span> <span class="id">LinkingC</span> <span class="kwd">Program</span> <span class="id">SemProps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">GlobalenvsC</span> <span class="id">Lia</span> <span class="id">LinkingC2</span> <span class="id">mktac</span> <span class="id">MemdataC</span> <span class="id">LocationsC</span> <span class="id">AsmStepInj</span> <span class="id">LowerBoundExtra</span> <span class="id">IdSimExtra</span>.<br/>
<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Z.mul</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id">sub_match_genvs</span> <span class="id">A</span> <span class="id">B</span> <span class="id">V</span> <span class="id">W</span> (<span class="id">R</span>: <span class="id">globdef</span> <span class="id">A</span> <span class="id">V</span> -&gt; <span class="id">globdef</span> <span class="id">B</span> <span class="id">W</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ge1</span>: <span class="id">Genv.t</span> <span class="id">A</span> <span class="id">V</span>) (<span class="id">ge2</span>: <span class="id">Genv.t</span> <span class="id">B</span> <span class="id">W</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;{ <span class="id">sub_mge_next</span> : <span class="id">Ple</span> (<span class="id">Genv.genv_next</span> <span class="id">ge1</span>) (<span class="id">Genv.genv_next</span> <span class="id">ge2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_mge_symb</span> <span class="id">id</span> <span class="id">b</span> (<span class="id">FIND</span>: <span class="id">Genv.find_symbol</span> <span class="id">ge1</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">ge2</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_mge_defs</span> <span class="id">b</span> <span class="id">d0</span> (<span class="id">FIND</span>: <span class="id">Genv.find_def</span> <span class="id">ge1</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">d0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">d1</span>, &lt;&lt;<span class="id">FIND</span>: <span class="id">Genv.find_def</span> <span class="id">ge2</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">d1</span>&gt;&gt; /\ &lt;&lt;<span class="id">MATCHDEF</span>: <span class="id">R</span> <span class="id">d0</span> <span class="id">d1</span>&gt;&gt;; }.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">match_prog</span> (<span class="id">sk</span>: <span class="id">Sk.t</span>) (<span class="id">tprog</span>: <span class="id">Asm.program</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:= @<span class="id">match_program</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Linking.Linker_fundef</span> <span class="id">signature</span>) <span class="id">Linker_unit</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">cu</span> <span class="id">tf</span> <span class="id">f</span> =&gt; <span class="id">tf</span> = <span class="id">AST.transf_fundef</span> <span class="id">fn_sig</span> <span class="id">f</span>) <span class="id">eq</span> <span class="id">sk</span> <span class="id">tprog</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">module_match_prog</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_prog</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7092')">Proof.</div>
<div class="proofscript" id="proof7092">
&nbsp;&nbsp;<span class="id">specialize</span> (@<span class="id">match_transform_program</span> <span class="id">_</span> <span class="id">_</span> <span class="id">unit</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">transf_fundef</span> <span class="id">fn_sig</span>) <span class="id">p</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">match_prog</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Mod.sk</span> (<span class="id">module</span> <span class="id">p</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">transform_program</span> (<span class="id">transf_fundef</span> <span class="id">fn_sig</span>) <span class="id">p</span>); <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">module</span>, <span class="id">Sk.of_program</span>, <span class="id">transform_program</span>, <span class="id">transf_fundef</span>. <span class="id">ss</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">skdefs_of_gdefs</span>, <span class="id">skdef_of_gdef</span>, <span class="id">update_snd</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">extensionality</span> <span class="id">i</span>. <span class="tactic">destruct</span> <span class="id">i</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="tactic">destruct</span> <span class="id">v</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">gvar_info</span>. <span class="id">refl</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">transform_program</span> (<span class="id">transf_fundef</span> <span class="id">fn_sig</span>) <span class="id">p</span>). <span class="id">i</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">des</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">list_forall2_rev</span>. <span class="tactic">eapply</span> <span class="id">list_forall2_imply</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">i</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H6</span>; <span class="id">splits</span>; <span class="tactic">eauto</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">mkprogram</span> <span class="id">nil</span> <span class="id">nil</span> <span class="id">p0</span>.(<span class="id">prog_main</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">splits</span>; <span class="tactic">eauto</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">in_prog_defmap</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H8</span>. <span class="id">ss</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">link_success</span> <span class="id">progs</span> <span class="id">sk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LINK_SK</span>: <span class="id">link_sk</span> (<span class="id">List.map</span> <span class="id">AsmC.module</span> <span class="id">progs</span>) = <span class="id">Some</span> <span class="id">sk</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tprog</span>, <span class="id">link_list</span> <span class="id">progs</span> = <span class="id">Some</span> <span class="id">tprog</span> /\ <span class="id">match_prog</span> <span class="id">sk</span> <span class="id">tprog</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7093')">Proof.</div>
<div class="proofscript" id="proof7093">
&nbsp;&nbsp;<span class="tactic">assert</span>((@<span class="id">link_list</span> <span class="id">_</span> (@<span class="id">Linker_prog</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Linking.Linker_fundef</span> <span class="id">signature</span>) <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map</span> <span class="id">Mod.sk</span> (<span class="id">map</span> <span class="id">module</span> <span class="id">progs</span>))) = <span class="id">Some</span> <span class="id">sk</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">link_sk</span>, <span class="id">link_list</span> <span class="kwd">in</span> *. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (@<span class="id">stricter_link_list_aux</span> <span class="id">_</span> (@<span class="id">Linker_prog</span> (<span class="id">AST.fundef</span> <span class="id">signature</span>) <span class="id">unit</span> (<span class="id">Linking.Linker_fundef</span> <span class="id">signature</span>) <span class="id">Linker_unit</span>) (@<span class="id">Linker_prog</span> (<span class="id">AST.fundef</span> <span class="id">signature</span>) <span class="id">unit</span> <span class="id">Linker_skfundef</span> <span class="id">Linker_unit</span>)) <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Linker_prog</span> <span class="id">Linker_def</span> <span class="id">Linking.Linker_fundef</span> <span class="id">Linker_skfundef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">link_prog</span>, <span class="id">proj_sumbool</span>, <span class="id">andb</span> <span class="kwd">in</span> *. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">FORALL</span>: @<span class="id">PTree_Properties.for_all</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> (<span class="id">prog_defmap</span> <span class="id">x0</span>) (@<span class="id">link_prog_check</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Linking.Linker_fundef</span> <span class="id">signature</span>) <span class="id">_</span> <span class="id">x0</span> <span class="id">x1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">true</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree_Properties.for_all_correct</span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PTree_Properties.for_all_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">link_prog_check</span>, <span class="id">proj_sumbool</span>, <span class="id">andb</span> <span class="kwd">in</span> *. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Heq0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">link_def</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">link_skfundef</span>, <span class="id">Linking.link_fundef</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">FORALL</span>. <span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id">PTree.elements_extensional</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">erewrite</span> <span class="id">PTree.gcombine</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id">PTree.gcombine</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PTree_Properties.for_all_correct</span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PTree_Properties.for_all_correct</span> <span class="kwd">in</span> <span class="id">FORALL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">link_prog_merge</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Heq0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">exploit</span> <span class="id">FORALL</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">clear</span> <span class="id">Heq0</span> <span class="id">FORALL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">link_prog_check</span>, <span class="id">proj_sumbool</span>, <span class="id">andb</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">link_def</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">link_skfundef</span>, <span class="id">Linking.link_fundef</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">LINK_SK</span>. <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">LINK_SK</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (@<span class="id">link_list_match</span> (<span class="id">AST.program</span> (<span class="id">AST.fundef</span> <span class="id">signature</span>) <span class="id">unit</span>) <span class="id">Asm.program</span> (@<span class="id">Linker_prog</span> (<span class="id">AST.fundef</span> <span class="id">signature</span>) <span class="id">unit</span> (<span class="id">Linking.Linker_fundef</span> <span class="id">signature</span>) <span class="id">Linker_unit</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> (@<span class="id">TransfTotalLink_rev</span> <span class="id">function</span> <span class="id">signature</span> <span class="id">unit</span> <span class="id">Linker_unit</span> <span class="id">fn_sig</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">list_map_compose</span>. <span class="tactic">clear</span> <span class="id">LINK_SK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">progs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">module_match_prog</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">PRESERVATION</span>.<br/>
<br/>
<h3> linking ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id">progs</span> : <span class="id">list</span> <span class="id">Asm.program</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">prog</span> : <span class="id">Syntax.program</span> := <span class="id">List.map</span> <span class="id">AsmC.module</span> <span class="id">progs</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id">WFSK</span>: <span class="kwd">forall</span> <span class="id">md</span> (<span class="id">IN</span>: <span class="id">In</span> <span class="id">md</span> <span class="id">prog</span>), &lt;&lt;<span class="id">WF</span>: <span class="id">Sk.wf</span> <span class="id">md</span>&gt;&gt;).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id">tprog</span> : <span class="id">Asm.program</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id">LINK</span> : <span class="id">link_list</span> <span class="id">progs</span> = <span class="id">Some</span> <span class="id">tprog</span>.<br/>
<br/>
<h3> genv ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id">sk</span> : <span class="id">Sk.t</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id">LINK_SK</span> : <span class="id">link_sk</span> <span class="id">prog</span> = <span class="id">Some</span> <span class="id">sk</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">skenv_link</span> := <span class="id">Sk.load_skenv</span> <span class="id">sk</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">ge</span> := <span class="id">load_genv</span> <span class="id">prog</span> <span class="id">skenv_link</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">tge</span> := <span class="id">Genv.globalenv</span> <span class="id">tprog</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">WFSKLINK</span>: <span class="id">Sk.wf</span> <span class="id">sk</span>. <span class="tactic">eapply</span> <span class="id">link_list_preserves_wf_sk</span>; <span class="id">et</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">WFSKELINK</span>: <span class="id">SkEnv.wf</span> <span class="id">skenv_link</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7094')">Proof.</div>
<div class="proofscript" id="proof7094">
 <span class="tactic">eapply</span> <span class="id">SkEnv.load_skenv_wf</span>. <span class="id">ss</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Let</span> <span class="id">ININCL</span>: <span class="kwd">forall</span> <span class="id">p</span> (<span class="id">IN</span>: <span class="id">In</span> <span class="id">p</span> <span class="id">prog</span>), &lt;&lt;<span class="id">INCL</span>: <span class="id">SkEnv.includes</span> <span class="id">skenv_link</span> <span class="id">p</span>.(<span class="id">Mod.sk</span>)&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7095')">Proof.</div>
<div class="proofscript" id="proof7095">
 <span class="tactic">eapply</span> <span class="id">link_includes</span>; <span class="id">et</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">local_genv</span> (<span class="id">p</span> : <span class="id">Asm.program</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">skenv_link</span>.(<span class="id">SkEnv.project</span>) <span class="id">p</span>.(<span class="id">Sk.of_program</span> <span class="id">fn_sig</span>)).(<span class="id">SkEnv.revive</span>) <span class="id">p</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_genvs_sub</span> <span class="id">A</span> <span class="id">B</span> <span class="id">V</span> <span class="id">W</span> <span class="id">R</span> (<span class="id">ge1</span>: <span class="id">Genv.t</span> <span class="id">A</span> <span class="id">V</span>) (<span class="id">ge2</span>: <span class="id">Genv.t</span> <span class="id">B</span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MATCHGE</span>: <span class="id">Genv.match_genvs</span> <span class="id">R</span> <span class="id">ge1</span> <span class="id">ge2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_match_genvs</span> <span class="id">R</span> <span class="id">ge1</span> <span class="id">ge2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7096')">Proof.</div>
<div class="proofscript" id="proof7096">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MATCHGE</span>. <span class="id">econs</span>; <span class="id">i</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">mge_next</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Genv.find_def</span> <span class="kwd">in</span> *. <span class="id">specialize</span> (<span class="id">mge_defs</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">mge_defs</span>; <span class="id">eq_closure_tac</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_genvs_le</span> <span class="id">A</span> <span class="id">B</span> <span class="id">V</span> <span class="id">W</span> <span class="id">R1</span> <span class="id">R2</span> (<span class="id">ge1</span>: <span class="id">Genv.t</span> <span class="id">A</span> <span class="id">V</span>) (<span class="id">ge2</span>: <span class="id">Genv.t</span> <span class="id">B</span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MATCHGE</span>: <span class="id">Genv.match_genvs</span> <span class="id">R1</span> <span class="id">ge1</span> <span class="id">ge2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LE</span>: <span class="id">R1</span> &lt;2= <span class="id">R2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.match_genvs</span> <span class="id">R2</span> <span class="id">ge1</span> <span class="id">ge2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7097')">Proof.</div>
<div class="proofscript" id="proof7097">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MATCHGE</span>. <span class="id">econs</span>; <span class="id">i</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (<span class="id">mge_defs</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span> 2. <span class="tactic">eapply</span> <span class="id">LE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">genv_le</span> (<span class="id">ge_src</span> <span class="id">ge_tgt</span>: <span class="id">Genv.t</span> <span class="id">fundef</span> <span class="id">unit</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_match_genvs</span> (@<span class="id">def_match</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">ge_src</span> <span class="id">ge_tgt</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">skenv_link_public_eq</span> <span class="id">id</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.public_symbol</span> <span class="id">skenv_link</span> <span class="id">id</span> = <span class="id">Senv.public_symbol</span> (<span class="id">symbolenv</span> (<span class="id">sem</span> <span class="id">prog</span>)) <span class="id">id</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7098')">Proof.</div>
<div class="proofscript" id="proof7098">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">MATCH_PROG</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_prog</span> <span class="id">sk</span> <span class="id">tprog</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7099')">Proof.</div>
<div class="proofscript" id="proof7099">
 <span class="id">exploit</span> <span class="id">link_success</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">clarify</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">public_eq</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_public</span> <span class="id">sk</span> = <span class="id">prog_public</span> <span class="id">tprog</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7100')">Proof.</div>
<div class="proofscript" id="proof7100">
 <span class="id">cinv</span> <span class="id">MATCH_PROG</span>. <span class="id">des</span>. <span class="tactic">eauto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">genv_public_eq</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.genv_public</span> <span class="id">skenv_link</span> = <span class="id">Genv.genv_public</span> <span class="id">tge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7101')">Proof.</div>
<div class="proofscript" id="proof7101">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">skenv_link</span>, <span class="id">tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Genv.globalenv_public</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">public_eq</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">main_eq</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_main</span> <span class="id">sk</span> = <span class="id">prog_main</span> <span class="id">tprog</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7102')">Proof.</div>
<div class="proofscript" id="proof7102">
 <span class="id">cinv</span> <span class="id">MATCH_PROG</span>. <span class="id">des</span>. <span class="tactic">eauto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_skenv_link_tge</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.match_genvs</span> (<span class="kwd">fun</span> <span class="id">skdef</span> <span class="id">fdef</span> =&gt; <span class="id">skdef_of_gdef</span> <span class="id">fn_sig</span> <span class="id">fdef</span> = <span class="id">skdef</span>) <span class="id">skenv_link</span> <span class="id">tge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7103')">Proof.</div>
<div class="proofscript" id="proof7103">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Genv.globalenvs_match</span> <span class="id">MATCH_PROG</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_genvs_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">PR</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H</span>. <span class="id">ss</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>. <span class="tactic">destruct</span> <span class="id">i2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sub_match_local_genv</span> <span class="id">ge_local</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MATCHGE</span>: <span class="id">genv_le</span> <span class="id">ge_local</span> <span class="id">tge</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_match_genvs</span> (<span class="kwd">fun</span> <span class="id">fdef</span> <span class="id">skdef</span> =&gt; <span class="id">def_match</span> (<span class="id">skdef_of_gdef</span> <span class="id">fn_sig</span> <span class="id">fdef</span>) (<span class="id">skdef</span>)) <span class="id">ge_local</span> <span class="id">skenv_link</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7104')">Proof.</div>
<div class="proofscript" id="proof7104">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">match_skenv_link_tge</span>. <span class="id">inv</span> <span class="id">MATCHGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span>, <span class="id">Genv.find_def</span> <span class="kwd">in</span> *. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">mge_next</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">sub_mge_symb0</span> <span class="kwd">in</span> <span class="id">FIND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">mge_symb</span> <span class="kwd">in</span> <span class="id">FIND</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">sub_mge_defs0</span> <span class="kwd">in</span> <span class="id">FIND</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">mge_defs</span> <span class="id">b</span>). <span class="id">inv</span> <span class="id">mge_defs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eq_closure_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eq_closure_tac</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MATCHDEF</span>; <span class="id">ss</span>; <span class="id">des_ifs</span>; <span class="id">econs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">valid_owner</span> <span class="id">fptr</span> (<span class="id">p</span>: <span class="id">Asm.program</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">valid_owner_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MSFIND</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>) <span class="id">fptr</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FINDF</span>: <span class="id">Genv.find_funct</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">fptr</span> = <span class="id">Some</span> (<span class="id">Internal</span> <span class="id">fd</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">owner_genv_le</span> <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7105')">Proof.</div>
<div class="proofscript" id="proof7105">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ge</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">load_modsems</span>, <span class="id">flip</span>, <span class="id">Mod.modsem</span>, <span class="id">skenv_link</span>, <span class="id">Sk.load_skenv</span>, <span class="id">prog</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">in_map_iff</span> <span class="kwd">in</span> <span class="id">IN</span>. <span class="id">des</span>. <span class="id">clarify</span>. <span class="tactic">apply</span> <span class="id">inj_pair2</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">local_genv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">INCL</span>: <span class="id">SkEnv.includes</span> (<span class="id">Genv.globalenv</span> <span class="id">sk</span>) (<span class="id">Sk.of_program</span> <span class="id">fn_sig</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">link_includes</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">in_map_iff</span>. <span class="id">esplits</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">ss</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (@<span class="id">SkEnv.project_impl_spec</span> <span class="id">skenv_link</span> <span class="id">x</span>.(<span class="id">Sk.of_program</span> <span class="id">fn_sig</span>) <span class="id">INCL</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">skenv_link</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SKWF</span>: <span class="id">SkEnv.wf_proj</span> (<span class="id">SkEnv.project</span> (<span class="id">Genv.globalenv</span> <span class="id">sk</span>) <span class="id">x</span>.(<span class="id">Sk.of_program</span> <span class="id">fn_sig</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">SkEnv.project_spec_preserves_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">SkEnv.load_skenv_wf</span>. <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">SkEnv.project_impl_spec</span>; <span class="id">et</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SkEnv.project_revive_precise</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">SkEnv.project_impl_spec</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="id">i</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">fundef</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">mge_next</span>. <span class="id">refl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">mge_symb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">defs</span> <span class="id">x</span> <span class="id">id</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">SYMBKEEP</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">Sk.of_program_defs</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>; <span class="id">des</span>. <span class="id">ss</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">SYMBDROP</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">Sk.of_program_defs</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>; <span class="id">des</span>. <span class="id">ss</span>. <span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">dup</span> <span class="id">FIND</span>. <span class="tactic">unfold</span> <span class="id">SkEnv.revive</span> <span class="kwd">in</span> <span class="id">FIND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv_map_defs_def</span> <span class="kwd">in</span> <span class="id">FIND</span>. <span class="id">des</span>. <span class="id">gesimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.invert_symbol</span> <span class="id">skenv_link</span> <span class="id">b</span>) <span class="id">eqn</span>:<span class="id">EQ</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">DEFORPHAN</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">GE2P</span>; <span class="id">et</span>. <span class="id">i</span>; <span class="id">des</span>. <span class="id">uo</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">TMP</span>: <span class="id">Genv.find_symbol</span> (<span class="id">SkEnv.project</span> (<span class="id">Genv.globalenv</span> <span class="id">sk</span>) (<span class="id">Sk.of_program</span> <span class="id">fn_sig</span> <span class="id">x</span>)) <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">uge</span>. <span class="tactic">unfold</span> <span class="id">SkEnv.revive</span> <span class="kwd">in</span> <span class="id">SYMB</span>. <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">TMP0</span>: <span class="id">Genv.find_symbol</span> (<span class="id">Genv.globalenv</span> <span class="id">sk</span>) <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">SkEnv.project</span> <span class="kwd">in</span> <span class="id">TMP</span>. <span class="tactic">rewrite</span> <span class="id">Genv_map_defs_symb</span> <span class="kwd">in</span> <span class="id">TMP</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> <span class="id">TMP</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">MapsC.PTree_filter_key_spec</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">id</span> = <span class="id">i0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Genv.find_invert_symbol</span> <span class="kwd">in</span> <span class="id">TMP</span>. <span class="id">clarify</span>. } <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">i</span> = <span class="id">i0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Genv.find_invert_symbol</span> <span class="kwd">in</span> <span class="id">TMP0</span>. <span class="tactic">unfold</span> <span class="id">skenv_link</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">clarify</span>. } <span class="id">clarify</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> (<span class="id">link_list_linkorder</span> <span class="id">_</span> <span class="id">LINK</span>); <span class="id">et</span>. <span class="tactic">intro</span> <span class="id">LO</span>; <span class="id">des</span>. <span class="tactic">rewrite</span> <span class="id">Forall_forall</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">LO</span> <span class="id">x</span> <span class="id">IN0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Linker_prog</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Linker_prog</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">LO1</span>; <span class="id">et</span>. <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">INT</span>: ~<span class="id">ASTC.is_external</span> <span class="id">d0</span>) <span class="tactic">by</span> <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">INT0</span>: ~<span class="id">ASTC.is_external</span> <span class="id">gd2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Linker_def</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H2</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H2</span>; <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gd2</span>. <span class="id">splits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Genv.find_def_symbol</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">b0</span> = <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Genv.invert_find_symbol</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">uge</span>. <span class="tactic">rewrite</span> <span class="id">mge_symb</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">skenv_link</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H0</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">H2</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">H2</span>; <span class="id">ss</span>. <span class="tactic">destruct</span> <span class="id">info1</span>, <span class="id">info2</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">symb_preserved</span> <span class="id">id</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Senv.public_symbol</span> (<span class="id">symbolenv</span> (<span class="id">semantics</span> <span class="id">tprog</span>)) <span class="id">id</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Senv.public_symbol</span> (<span class="id">symbolenv</span> (<span class="id">sem</span> <span class="id">prog</span>)) <span class="id">id</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7106')">Proof.</div>
<div class="proofscript" id="proof7106">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">skenv_link_public_eq</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.public_symbol</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">tge</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">fundef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">mge_symb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>. <span class="tactic">rewrite</span> <span class="id">genv_public_eq</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">symb_main</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">skenv_link</span> (<span class="id">prog_main</span> <span class="id">sk</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">tge</span> (<span class="id">prog_main</span> <span class="id">tprog</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7107')">Proof.</div>
<div class="proofscript" id="proof7107">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">mge_symb</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">main_eq</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">local_global_consistent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ge_local</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LE</span>: <span class="id">genv_le</span> <span class="id">ge_local</span> <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fptr</span> <span class="id">fd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LOCAL</span>: <span class="id">Genv.find_funct</span> <span class="id">ge_local</span> <span class="id">fptr</span> = <span class="id">Some</span> (<span class="id">Internal</span> <span class="id">fd</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GLOBAL</span>: <span class="id">Genv.find_funct</span> <span class="id">skenv_link</span> <span class="id">fptr</span> = <span class="id">Some</span> <span class="id">skd</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sk.get_sig</span> <span class="id">skd</span> = <span class="id">fd</span>.(<span class="id">fn_sig</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7108')">Proof.</div>
<div class="proofscript" id="proof7108">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">LE</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_funct</span>, <span class="id">Genv.find_funct_ptr</span>, <span class="id">Genv.find_def</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cset</span> <span class="id">sub_mge_defs0</span> <span class="id">Heq0</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (<span class="id">mge_defs</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">skdef_of_gdef</span>, <span class="id">fundef</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">FIND</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">MATCHDEF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> initial memory ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id">m_init</span> : <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id">INIT_MEM</span>: <span class="id">sk</span>.(<span class="id">Sk.load_mem</span>) = <span class="id">Some</span> <span class="id">m_init</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">m_tgt_init</span> := <span class="id">m_init</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">TGT_INIT_MEM</span>: <span class="id">Genv.init_mem</span> <span class="id">tprog</span> = <span class="id">Some</span> <span class="id">m_tgt_init</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7109')">Proof.</div>
<div class="proofscript" id="proof7109">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Linker_prog</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">Genv.init_mem_match</span> <span class="id">MATCH_PROG</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">init_inject</span> := <span class="id">Mem.flat_inj</span> (<span class="id">Mem.nextblock</span> <span class="id">m_init</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">initmem_inject</span>: <span class="id">Mem.inject</span> <span class="id">init_inject</span> <span class="id">m_init</span> <span class="id">m_tgt_init</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7110')">Proof.</div>
<div class="proofscript" id="proof7110">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.initmem_inject</span>. <span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> <span class="id">INIT_MEM</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">init_inject_ge</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">init_inject</span> <span class="id">m_init</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7111')">Proof.</div>
<div class="proofscript" id="proof7111">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">init_inject</span>, <span class="id">Mem.flat_inj</span>. <span class="id">econs</span>; <span class="id">i</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Genv.init_mem_genv_next</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">skenv_link</span>, <span class="id">Sk.load_skenv</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">senv_same</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tge</span>: <span class="id">Senv.t</span>) = (<span class="id">skenv_link</span>: <span class="id">Senv.t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7112')">Proof.</div>
<div class="proofscript" id="proof7112">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">match_skenv_link_tge</span>; <span class="tactic">intro</span> <span class="id">MGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">MGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">skenv_link</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">Sk.load_skenv</span> <span class="kwd">in</span> *. <span class="tactic">subst</span> <span class="id">tge</span>. <span class="tactic">unfold</span> <span class="id">link_sk</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MGE</span>. <span class="tactic">unfold</span> <span class="id">fundef</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">senv_eta</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">uge</span>. <span class="tactic">apply</span> <span class="id">func_ext1</span>. <span class="id">i</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Genv.public_symbol</span>. <span class="id">uge</span>. <span class="tactic">apply</span> <span class="id">func_ext1</span>. <span class="id">i</span>. <span class="id">specialize</span> (<span class="id">mge_symb</span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">mge_symb</span>. <span class="id">des_ifs</span>. <span class="tactic">rewrite</span> <span class="id">mge_pubs</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">func_ext1</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">Genv.invert_symbol</span> (@<span class="id">Genv.globalenv</span> (<span class="id">AST.fundef</span> <span class="id">function</span>) <span class="id">unit</span> <span class="id">tprog</span>) <span class="id">x0</span>)) <span class="id">eqn</span>:<span class="id">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Genv.invert_find_symbol</span> <span class="kwd">in</span> <span class="id">T</span>. <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">Genv.find_invert_symbol</span>. <span class="id">uge</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">mge_symb</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">Genv.invert_symbol</span> (<span class="id">Genv.globalenv</span> <span class="id">sk</span>) <span class="id">x0</span>) <span class="id">eqn</span>:<span class="id">U</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.invert_find_symbol</span> <span class="kwd">in</span> <span class="id">U</span>. <span class="id">specialize</span> (<span class="id">mge_symb</span> <span class="id">i</span>). <span class="id">uge</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">mge_symb</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.find_invert_symbol</span> <span class="kwd">in</span> <span class="id">U</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Genv.block_is_volatile</span>, <span class="id">Genv.find_var_info</span>. <span class="tactic">apply</span> <span class="id">func_ext1</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">mge_defs</span> <span class="id">x0</span>). <span class="id">uge</span>. <span class="id">inv</span> <span class="id">mge_defs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">system_symbols_inject</span> <span class="id">j</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SKINJ</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symbols_inject_weak</span> <span class="id">j</span> (<span class="id">System.globalenv</span> <span class="id">skenv_link</span>) <span class="id">skenv_link</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7113')">Proof.</div>
<div class="proofscript" id="proof7113">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">match_skenv_link_tge</span>. <span class="id">inv</span> <span class="id">SKINJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">System.globalenv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rr</span>. <span class="id">esplits</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">NB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="id">et</span>. <span class="id">i</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">VEQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b2</span>) <span class="id">eqn</span>:<span class="id">VEQ1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">SYSTEM</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">system_function_ofs</span> <span class="id">j</span> <span class="id">b_src</span> <span class="id">b_tgt</span> <span class="id">delta</span> <span class="id">fd</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SKINJ</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND</span>: <span class="id">Genv.find_funct_ptr</span> (<span class="id">System.globalenv</span> <span class="id">skenv_link</span>) <span class="id">b_src</span> = <span class="id">Some</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">j</span> <span class="id">b_src</span> = <span class="id">Some</span> (<span class="id">b_tgt</span>, <span class="id">delta</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">delta</span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7114')">Proof.</div>
<div class="proofscript" id="proof7114">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SKINJ</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">b_src</span>). <span class="tactic">clear</span> - <span class="id">FIND</span> <span class="id">WFSKLINK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">System.globalenv</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_funct_ptr</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SkEnv.wf</span> <span class="id">skenv_link</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">SkEnv.load_skenv_wf</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DEFSYMB</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">system_sig</span> <span class="id">j</span> <span class="id">b_src</span> <span class="id">b_tgt</span> <span class="id">delta</span> <span class="id">ef</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SKINJ</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND</span>: <span class="id">Genv.find_funct_ptr</span> (<span class="id">System.globalenv</span> <span class="id">skenv_link</span>) <span class="id">b_src</span> = <span class="id">Some</span> (<span class="id">External</span> <span class="id">ef</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">j</span> <span class="id">b_src</span> = <span class="id">Some</span> (<span class="id">b_tgt</span>, <span class="id">delta</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_funct_ptr</span> <span class="id">tge</span> <span class="id">b_tgt</span> = <span class="id">Some</span> (<span class="id">External</span> <span class="id">ef</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7115')">Proof.</div>
<div class="proofscript" id="proof7115">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">System.globalenv</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">match_skenv_link_tge</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">b_tgt</span> <span class="kwd">with</span> <span class="id">b_src</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Genv.find_funct_ptr</span> <span class="kwd">in</span> <span class="id">FIND</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">SKINJ</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:= <span class="id">b_src</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SkEnv.wf</span> <span class="id">skenv_link</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">SkEnv.load_skenv_wf</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_symbol</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DEFSYMB</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">clarify</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_funct_ptr</span>, <span class="id">Genv.find_def</span>, <span class="id">skdef_of_gdef</span>, <span class="id">fundef</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (<span class="id">mge_defs</span> <span class="id">b_src</span>); <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">system_receptive_at</span> <span class="id">st</span> <span class="id">frs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">receptive_at</span> (<span class="id">sem</span> <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">State</span> ((<span class="id">Frame.mk</span> (<span class="id">System.modsem</span> <span class="id">skenv_link</span>) <span class="id">st</span>) :: <span class="id">frs</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7116')">Proof.</div>
<div class="proofscript" id="proof7116">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">symbolenv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">STEP</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_receptive</span>; <span class="tactic">eauto</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">System.globalenv</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">SkEnv.t</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_traces_preserved</span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">Senv.public_symbol</span> <span class="tactic">at</span> 1. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">skenv_link_public_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">FINAL</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">econs</span> 4; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">single_events_at</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="id">inv</span> <span class="id">STEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ec_trace_length</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">SYSTEM</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">ASMLEMMAS</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_determinate_at</span> <span class="id">p</span> <span class="id">st</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">determinate_at</span> (<span class="id">semantics</span> <span class="id">p</span>) <span class="id">st</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7117')">Proof.</div>
<div class="proofscript" id="proof7117">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">semantics_determinate</span> <span class="id">p</span>); <span class="tactic">intro</span> <span class="id">P</span>. <span class="id">inv</span> <span class="id">P</span>. <span class="id">econs</span>; <span class="id">ii</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">sd_final_nostep</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">ASMLEMMAS</span>.<br/>
<br/>
<h3> regset ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">initial_regset</span> : <span class="id">regset</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Pregmap.init</span> <span class="id">Vundef</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# <span class="id">PC</span> &lt;- (<span class="id">Genv.symbol_address</span> <span class="id">tge</span> <span class="id">tprog</span>.(<span class="id">prog_main</span>) <span class="id">Ptrofs.zero</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# <span class="id">RA</span> &lt;- <span class="id">Vnullptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# <span class="id">RSP</span> &lt;- (<span class="id">Vptr</span> 1%<span class="id">positive</span> <span class="id">Ptrofs.zero</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">initial_tgt_regset</span> := <span class="id">initial_regset</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">init_mem_nextblock</span> <span class="id">F</span> <span class="id">V</span> (<span class="id">p</span>: <span class="id">AST.program</span> <span class="id">F</span> <span class="id">V</span>) <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INIT</span>: <span class="id">Genv.init_mem</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">m</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Plt</span> 1 (<span class="id">Mem.nextblock</span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7118')">Proof.</div>
<div class="proofscript" id="proof7118">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.init_mem</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.alloc_globals_unchanged</span> <span class="kwd">with</span> (<span class="id">P</span>:=<span class="id">top2</span>) <span class="kwd">in</span> <span class="id">INIT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span> <span class="kwd">in</span> <span class="id">INIT</span>. <span class="id">ss</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">update_agree</span> <span class="id">j</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">pr</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UPDATE</span>: <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">v</span> (<span class="id">rs_tgt</span> # <span class="id">pr</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">agree</span> <span class="id">j</span> (<span class="id">rs_src</span> # <span class="id">pr</span> &lt;- <span class="id">v</span>) <span class="id">rs_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7119')">Proof.</div>
<div class="proofscript" id="proof7119">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="tactic">intros</span> <span class="id">pr0</span>; <span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">pr0</span>); <span class="tactic">destruct</span> <span class="id">pr0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">i</span>, <span class="id">i0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">f</span>, <span class="id">f0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">c</span>, <span class="id">c0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">initial_regset_agree</span>: <span class="id">agree</span> <span class="id">init_inject</span> <span class="id">initial_regset</span> <span class="id">initial_tgt_regset</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7120')">Proof.</div>
<div class="proofscript" id="proof7120">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">initial_tgt_regset</span>, <span class="id">initial_regset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">eapply</span> <span class="id">agree_step</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>; <span class="id">des_ifs</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">init_inject</span>, <span class="id">Mem.flat_inj</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">tge</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id">Genv.init_mem_genv_next</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">TGT_INIT_MEM</span>. <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">Ptrofs.add_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">init_inject</span>, <span class="id">Mem.flat_inj</span>; <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">eapply</span> <span class="id">init_mem_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> <span class="id">INIT_MEM</span>. <span class="tactic">apply</span> <span class="id">INIT_MEM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">Ptrofs.add_zero</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> calee initial ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">wf_init_rs</span> (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">rs_caller</span> <span class="id">rs_callee</span>: <span class="id">regset</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wf_init_rs_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PCSAME</span>: <span class="id">rs_caller</span> # <span class="id">PC</span> = <span class="id">rs_callee</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANOTFPTR</span>: <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">ofs</span> (<span class="id">RAVAL</span>: <span class="id">rs_callee</span> <span class="id">RA</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">Plt</span> <span class="id">blk</span> (<span class="id">Genv.genv_next</span> <span class="id">skenv_link</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RASAME</span>: <span class="id">inj_same</span> <span class="id">j</span> (<span class="id">rs_caller</span> # <span class="id">RA</span>) (<span class="id">rs_callee</span> # <span class="id">RA</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPSAME</span>: <span class="id">inj_same</span> <span class="id">j</span> (<span class="id">rs_caller</span> # <span class="id">RSP</span>) (<span class="id">rs_callee</span> # <span class="id">RSP</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CALLEESAVE</span>: <span class="kwd">forall</span> <span class="id">mr</span>, <span class="id">Conventions1.is_callee_save</span> <span class="id">mr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inj_same</span> <span class="id">j</span> (<span class="id">rs_caller</span> (<span class="id">to_preg</span> <span class="id">mr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rs_callee</span> (<span class="id">to_preg</span> <span class="id">mr</span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">preg_case</span> <span class="id">pr</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">mr</span>, <span class="id">pr</span> = <span class="id">to_preg</span> <span class="id">mr</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pr</span> = <span class="id">PC</span>) \/ (<span class="id">exists</span> <span class="id">c</span>, <span class="id">pr</span> = <span class="id">CR</span> <span class="id">c</span>) \/ (<span class="id">pr</span> = <span class="id">RSP</span>) \/ (<span class="id">pr</span> = <span class="id">RA</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7121')">Proof.</div>
<div class="proofscript" id="proof7121">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">to_mreg</span> <span class="id">pr</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="id">exists</span> <span class="id">m</span>. <span class="tactic">unfold</span> <span class="id">to_mreg</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">clarify</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">clarify</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">unfold</span> <span class="id">to_mreg</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="id">clarify</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">clarify</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">clarify</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_save_agree</span> <span class="id">j</span> <span class="id">rs_caller</span> <span class="id">init_rs</span> <span class="id">rs_callee</span> <span class="id">rs_tgt</span> <span class="id">sg</span> <span class="id">mr</span> <span class="id">rs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WF</span>: <span class="id">wf_init_rs</span> <span class="id">j</span> <span class="id">rs_caller</span> <span class="id">init_rs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">rs_callee</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RETV</span>: <span class="id">loc_result</span> <span class="id">sg</span> = <span class="id">One</span> <span class="id">mr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CALLEESAVE</span>: <span class="kwd">forall</span> <span class="id">mr</span>, <span class="id">Conventions1.is_callee_save</span> <span class="id">mr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.lessdef</span> (<span class="id">init_rs</span> <span class="id">mr</span>.(<span class="id">to_preg</span>)) (<span class="id">rs_callee</span> <span class="id">mr</span>.(<span class="id">to_preg</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSRA</span>: <span class="id">rs_callee</span> # <span class="id">PC</span> = <span class="id">init_rs</span> # <span class="id">RA</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSRSP</span>: <span class="id">rs_callee</span> # <span class="id">RSP</span> = <span class="id">init_rs</span> # <span class="id">RSP</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RS</span>: <span class="id">rs</span> = (<span class="id">set_pair</span> (<span class="id">loc_external_result</span> <span class="id">sg</span>) (<span class="id">rs_callee</span> <span class="id">mr</span>.(<span class="id">to_preg</span>)) (<span class="id">Asm.regset_after_external</span> <span class="id">rs_caller</span>)) #<span class="id">PC</span> &lt;- (<span class="id">rs_caller</span> <span class="id">RA</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">agree</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">rs_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7122')">Proof.</div>
<div class="proofscript" id="proof7122">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WF</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">loc_external_result</span>. <span class="tactic">rewrite</span> <span class="id">RETV</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">update_agree</span>; <span class="tactic">eauto</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">inj_same_inj</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">RSRA</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">update_agree</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Asm.regset_after_external</span> <span class="kwd">in</span> *. <span class="tactic">intros</span> <span class="id">pr</span>. <span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">pr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">preg_case</span> <span class="id">pr</span>); <span class="id">des</span>; <span class="id">clarify</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">CALLEESAVE</span> <span class="id">mr0</span>). <span class="id">specialize</span> (<span class="id">CALLEESAVE0</span> <span class="id">mr0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">inj_same_inj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.val_lessdef_inject_compose</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">CALLEESAVE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">RSRSP</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">inj_same_inj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> match stack ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">match_stack</span> (<span class="id">j</span>: <span class="id">meminj</span>) : (<span class="id">Values.block</span> -&gt; <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) -&gt; <span class="id">regset</span> -&gt; <span class="id">list</span> <span class="id">Frame.t</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_stack_init</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init_rs</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSRA</span>: <span class="id">init_rs</span> # <span class="id">RA</span> = <span class="id">Vnullptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPC</span>: <span class="id">init_rs</span> # <span class="id">PC</span> = <span class="id">Genv.symbol_address</span> <span class="id">tge</span> <span class="id">tprog</span>.(<span class="id">prog_main</span>) <span class="id">Ptrofs.zero</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">Genv.symbol_address</span> <span class="id">tge</span> <span class="id">tprog</span>.(<span class="id">prog_main</span>) <span class="id">Ptrofs.zero</span>) = <span class="id">Some</span> (<span class="id">Internal</span> <span class="id">signature_main</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack</span> <span class="id">j</span> <span class="id">P</span> <span class="id">init_rs</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;| <span class="id">match_stack_cons</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">st</span> <span class="id">init_rs0</span> <span class="id">init_rs1</span> <span class="id">P0</span> <span class="id">P1</span> <span class="id">sg</span> <span class="id">blk</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FRAME</span>: <span class="id">fr</span> = <span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>) (<span class="id">AsmC.mkstate</span> <span class="id">init_rs1</span> <span class="id">st</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack</span> <span class="id">j</span> <span class="id">P0</span> <span class="id">init_rs1</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WF</span>: <span class="id">wf_init_rs</span> <span class="id">j</span> <span class="id">st</span>.(<span class="id">st_rs</span>) <span class="id">init_rs0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GELE</span>: <span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">init_rs0</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">Some</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPPTR</span>: <span class="id">st</span>.(<span class="id">st_rs</span>) # <span class="id">RSP</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">P0</span> \2/ (<span class="id">brange</span> <span class="id">blk</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span>)) &lt;2= <span class="id">P1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack</span> <span class="id">j</span> <span class="id">P1</span> <span class="id">init_rs0</span> (<span class="id">fr</span>::<span class="id">frs</span>)<br/>
&nbsp;&nbsp;| <span class="id">match_stack_cons_asmstyle</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">st</span> <span class="id">init_rs0</span> <span class="id">init_rs1</span> <span class="id">P0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FRAME</span>: <span class="id">fr</span> = <span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>) (<span class="id">AsmC.mkstate</span> <span class="id">init_rs1</span> <span class="id">st</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack</span> <span class="id">j</span> <span class="id">P0</span> <span class="id">init_rs1</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WF</span>: <span class="id">inj_same</span> <span class="id">j</span> (<span class="id">st</span>.(<span class="id">st_rs</span>) # <span class="id">RA</span>) (<span class="id">init_rs0</span> # <span class="id">RA</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GELE</span>: <span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">init_rs0</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">None</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack</span> <span class="id">j</span> <span class="id">P0</span> <span class="id">init_rs0</span> (<span class="id">fr</span>::<span class="id">frs</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">match_stack_call</span> (<span class="id">j</span>: <span class="id">meminj</span>) : <span class="id">mem</span> -&gt; (<span class="id">Values.block</span> -&gt; <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) -&gt; <span class="id">regset</span> -&gt; <span class="id">list</span> <span class="id">Frame.t</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_stack_call_init</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init_rs</span> <span class="id">m</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">m</span> = <span class="id">m_init</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INITRS</span>: <span class="id">init_rs</span> = <span class="id">initial_regset</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">Genv.symbol_address</span> <span class="id">tge</span> <span class="id">tprog</span>.(<span class="id">prog_main</span>) <span class="id">Ptrofs.zero</span>) = <span class="id">Some</span> (<span class="id">Internal</span> <span class="id">signature_main</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack_call</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P</span> <span class="id">init_rs</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;| <span class="id">match_stack_call_cons</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">st</span> <span class="id">init_rs0</span> <span class="id">init_rs1</span> <span class="id">m</span> <span class="id">P0</span> <span class="id">P1</span> <span class="id">sg</span> <span class="id">blk</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FRAME</span>: <span class="id">fr</span> = <span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs1</span> <span class="id">st</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INITRS</span>: <span class="id">init_rs0</span> = <span class="id">st</span>.(<span class="id">st_rs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack</span> <span class="id">j</span> <span class="id">P0</span> <span class="id">init_rs1</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">m</span> = <span class="id">st</span>.(<span class="id">st_m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GELE</span>: <span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">init_rs0</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">Some</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPPTR</span>: <span class="id">init_rs0</span> # <span class="id">RSP</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">P0</span> \2/ (<span class="id">brange</span> <span class="id">blk</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span>)) &lt;2= <span class="id">P1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack_call</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P1</span> <span class="id">init_rs0</span> (<span class="id">fr</span>::<span class="id">frs</span>)<br/>
&nbsp;&nbsp;| <span class="id">match_stack_call_cons_asmstyle</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">st</span> <span class="id">init_rs0</span> <span class="id">init_rs1</span> <span class="id">m</span> <span class="id">P0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FRAME</span>: <span class="id">fr</span> = <span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs1</span> <span class="id">st</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INITRS</span>: <span class="id">init_rs0</span> = <span class="id">st</span>.(<span class="id">st_rs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack</span> <span class="id">j</span> <span class="id">P0</span> <span class="id">init_rs1</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">m</span> = <span class="id">st</span>.(<span class="id">st_m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GELE</span>: <span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">init_rs0</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">None</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack_call</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P0</span> <span class="id">init_rs0</span> (<span class="id">fr</span>::<span class="id">frs</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_stack_incr</span> <span class="id">j1</span> <span class="id">j2</span> <span class="id">init_rs</span> <span class="id">l</span> <span class="id">P0</span> <span class="id">P1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j1</span> <span class="id">j2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PLE</span>: <span class="id">P0</span> &lt;2= <span class="id">P1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MATCH</span>: <span class="id">match_stack</span> <span class="id">j1</span> <span class="id">P0</span> <span class="id">init_rs</span> <span class="id">l</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stack</span> <span class="id">j2</span> <span class="id">P1</span> <span class="id">init_rs</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7123')">Proof.</div>
<div class="proofscript" id="proof7123">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">init_rs</span> <span class="id">INCR</span> <span class="id">P0</span> <span class="id">P1</span> <span class="id">PLE</span> <span class="id">MATCH</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="id">ss</span>; <span class="id">ii</span>; <span class="id">inv</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHl</span>; <span class="id">cycle</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">WF</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span> 3; <span class="id">ss</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">frame_inj</span> <span class="id">a0</span> <span class="id">b0</span> <span class="id">a1</span> <span class="id">b1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span>: <span class="id">Frame.mk</span> <span class="id">a0</span> <span class="id">b0</span> = <span class="id">Frame.mk</span> <span class="id">a1</span> <span class="id">b1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b0</span> ~= <span class="id">b1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7124')">Proof.</div>
<div class="proofscript" id="proof7124">
 <span class="id">inv</span> <span class="id">EQ</span>. <span class="tactic">eauto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_frame_inj</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">st1</span> <span class="id">st2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span> : <span class="id">Frame.mk</span> (<span class="id">modsem</span> <span class="id">se1</span> <span class="id">p1</span>) <span class="id">st1</span> = <span class="id">Frame.mk</span> (<span class="id">modsem</span> <span class="id">se2</span> <span class="id">p2</span>) <span class="id">st2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st1</span> = <span class="id">st2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7125')">Proof.</div>
<div class="proofscript" id="proof7125">
 <span class="tactic">apply</span> <span class="id">frame_inj</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="tactic">apply</span> <span class="id">JMeq_eq</span>. <span class="tactic">eauto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_frame_inj2</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">st1</span> <span class="id">st2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span> : <span class="id">Frame.mk</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p1</span>) <span class="id">st1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Frame.mk</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p2</span>) <span class="id">st2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">local_genv</span> <span class="id">p1</span> = <span class="id">local_genv</span> <span class="id">p2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7126')">Proof.</div>
<div class="proofscript" id="proof7126">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="tactic">f_equal</span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">Frame.ms</span>) <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">f_hequal</span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">ModSem.globalenv</span>) <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">JMeq_eq</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">skenv_inject_memory</span> <span class="id">j</span> <span class="id">m</span> <span class="id">m_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GEINJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">m_tgt</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ple</span> (<span class="id">Genv.genv_next</span> <span class="id">skenv_link</span>) (<span class="id">Mem.nextblock</span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7127')">Proof.</div>
<div class="proofscript" id="proof7127">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~ <span class="id">Plt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Mem.nextblock</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Genv.genv_next</span> <span class="id">skenv_link</span>)); [|<span class="id">xomega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> arguments ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id">callee_initial_mem</span>' (<span class="id">blk</span>: <span class="id">Values.block</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m0</span>: <span class="id">mem</span>) (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">sg</span>: <span class="id">signature</span>) (<span class="id">args</span>: <span class="id">list</span> <span class="id">val</span>): <span class="id">mem</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.mkmem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PMap.set</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>.(<span class="id">Mem.nextblock</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_FillArgsParallel.fill_args_src_blk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m0</span>.(<span class="id">Mem.mem_contents</span>) !! <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">fst</span> (<span class="id">Mem.alloc</span> <span class="id">m</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>))).(<span class="id">Mem.mem_contents</span>) !! (<span class="id">Mem.nextblock</span> <span class="id">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) 0 <span class="id">args</span> (<span class="id">loc_arguments</span> <span class="id">sg</span>)) ((<span class="id">fst</span> (<span class="id">Mem.alloc</span> <span class="id">m</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>))).(<span class="id">Mem.mem_contents</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">fst</span> (<span class="id">Mem.alloc</span> <span class="id">m</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>))).(<span class="id">Mem.mem_access</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">fst</span> (<span class="id">Mem.alloc</span> <span class="id">m</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>))).(<span class="id">Mem.nextblock</span>)) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7128')">Next Obligation.</div>
<div class="proofscript" id="proof7128">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.access_max</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof7129')">Next Obligation.</div>
<div class="proofscript" id="proof7129">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.nextblock_noaccess</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof7130')">Next Obligation.</div>
<div class="proofscript" id="proof7130">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">_FillArgsParallel.fill_args_src_blk_default</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.contents_default</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.contents_default</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">callee_initial_reg</span>' (<span class="id">sg</span>: <span class="id">signature</span>) (<span class="id">args</span>: <span class="id">list</span> <span class="id">val</span>): <span class="id">Mach.regset</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">mr</span> =&gt; <span class="kwd">if</span> <span class="id">extcall_args_reg</span> <span class="id">mr</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">_FillArgsParallel.fill_args_src_reg</span> <span class="id">args</span> (<span class="id">loc_arguments</span> <span class="id">sg</span>) <span class="id">mr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Vundef</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">callee_initial_inj</span>' (<span class="id">blk</span>: <span class="id">Values.block</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">m_src</span>: <span class="id">mem</span>): <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">blk</span>' =&gt; <span class="kwd">if</span> (<span class="id">peq</span> <span class="id">blk</span>' (<span class="id">Mem.nextblock</span> <span class="id">m_src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id">j</span> <span class="id">blk</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>) =&gt; <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">j</span> <span class="id">blk</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">typify_list_lessdef</span> <span class="id">args</span> <span class="id">typs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LEN</span>: <span class="id">Datatypes.length</span> <span class="id">args</span> = <span class="id">Datatypes.length</span> <span class="id">typs</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.lessdef_list</span> (<span class="id">typify_list</span> <span class="id">args</span> <span class="id">typs</span>) <span class="id">args</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7131')">Proof.</div>
<div class="proofscript" id="proof7131">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">typs</span> <span class="id">LEN</span>. <span class="tactic">induction</span> <span class="id">args</span>; <span class="id">ss</span>. <span class="id">ii</span>. <span class="tactic">destruct</span> <span class="id">typs</span>; <span class="id">inv</span> <span class="id">LEN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">typify_list</span>, <span class="id">zip</span>, <span class="id">typify</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_extcall_arguments_mach</span> <span class="id">rs</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Asm.extcall_arguments</span> <span class="id">rs</span> <span class="id">m</span> &lt;2=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mach.extcall_arguments</span> (<span class="id">AsmregsC.to_mregset</span> <span class="id">rs</span>) <span class="id">m</span> (<span class="id">rs</span> <span class="id">RSP</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7132')">Proof.</div>
<div class="proofscript" id="proof7132">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">list_forall2_imply</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">inv</span> <span class="id">H1</span>; <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H2</span>; <span class="id">econs</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_arguments</span> (<span class="id">rs</span>: <span class="id">regset</span>) <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">args</span> <span class="id">targs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGS</span>: <span class="id">Asm.extcall_arguments</span> <span class="id">rs</span> <span class="id">m0</span> <span class="id">sg</span> <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSRSP</span>: <span class="id">rs</span> <span class="id">RSP</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGRANGE</span>: <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TYP</span>: <span class="id">typecheck</span> <span class="id">args</span> <span class="id">sg</span> <span class="id">targs</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mach.extcall_arguments</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_reg</span>' <span class="id">sg</span> <span class="id">targs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">sg</span> <span class="id">targs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Vptr</span> (<span class="id">Mem.nextblock</span> <span class="id">m1</span>) <span class="id">Ptrofs.zero</span>) <span class="id">sg</span> <span class="id">targs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7133')">Proof.</div>
<div class="proofscript" id="proof7133">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">TYP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">extcall_arguments_same</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">_FillArgsParallel.fill_args_src_reg</span> <span class="id">_</span> (<span class="id">loc_arguments</span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>'. <span class="id">ii</span>. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">extcall_arg_in_stack_in_reg_extcall_argument</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">_FillArgsParallel.fill_args_src_blk_args</span>; [..|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">val_inject_list_lessdef</span>. <span class="tactic">apply</span> <span class="id">typify_list_lessdef</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">loc_arguments_norepet</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id">typify_list_length</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">LEN</span>. <span class="tactic">rewrite</span> <span class="id">Nat.min_id</span>. <span class="tactic">eapply</span> <span class="id">sig_args_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">extcall_arguments_extcall_arg_in_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id">Ptrofs.repr_unsigned</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">RSRSP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_extcall_arguments_mach</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">_FillArgsParallel.fill_args_src_reg_args</span>; [..|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">loc_arguments_norepet</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">loc_arguments_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id">typify_list_length</span>. <span class="tactic">rewrite</span> <span class="id">LEN</span>. <span class="tactic">rewrite</span> <span class="id">Nat.min_id</span>. <span class="tactic">eapply</span> <span class="id">sig_args_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Mem.alloc</span> <span class="id">m1</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>)) <span class="id">eqn</span>:<span class="id">MEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">Mem_alloc_range_perm</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">callee_initial_mem</span>' <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">MEQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.alloc_result</span> <span class="kwd">in</span> <span class="id">MEQ</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="id">nia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_inj_incr</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NONE</span>: <span class="id">j</span> (<span class="id">Mem.nextblock</span> <span class="id">m_src</span>) = <span class="id">None</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inject_incr</span> <span class="id">j</span> (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7134')">Proof.</div>
<div class="proofscript" id="proof7134">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>'. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_mem_nextblock</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">targs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.nextblock</span> (<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">sg</span> <span class="id">targs</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Pos.succ</span> (<span class="id">Mem.nextblock</span> <span class="id">m1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7135')">Proof.</div>
<div class="proofscript" id="proof7135">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_mem</span>'. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_mem_perm</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">targs</span> <span class="id">blk</span>' <span class="id">ofs</span>' <span class="id">p</span> <span class="id">k</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> (<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">sg</span> <span class="id">targs</span>) <span class="id">blk</span>' <span class="id">ofs</span>' <span class="id">p</span> <span class="id">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="kwd">if</span> (<span class="id">peq</span> (<span class="id">Mem.nextblock</span> <span class="id">m1</span>) <span class="id">blk</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id">zle</span> 0 <span class="id">ofs</span>' &amp;&amp; <span class="id">zlt</span> <span class="id">ofs</span>' (4 * <span class="id">size_arguments</span> <span class="id">sg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">blk</span>' <span class="id">ofs</span>' <span class="id">p</span> <span class="id">k</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7136')">Proof.</div>
<div class="proofscript" id="proof7136">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_mem</span>', <span class="id">Mem.perm</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Mem.alloc</span> <span class="id">m1</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>)) <span class="id">eqn</span>:<span class="id">MEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">proj_sumbool</span>. <span class="id">des_ifs</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Mem_alloc_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_inject</span>' (<span class="id">rs</span>: <span class="id">regset</span>) <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">j</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">args</span> <span class="id">targs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGS</span>: <span class="id">Asm.extcall_arguments</span> <span class="id">rs</span> <span class="id">m_src0</span> <span class="id">sg</span> <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSRSP</span>: <span class="id">rs</span> <span class="id">RSP</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">freed_from</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>) (<span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>) + 4 * (<span class="id">size_arguments</span> <span class="id">sg</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGRANGE</span>: <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TYP</span>: <span class="id">typecheck</span> <span class="id">args</span> <span class="id">sg</span> <span class="id">targs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ALIGN</span>: <span class="kwd">forall</span> <span class="id">chunk</span> (<span class="id">CHUNK</span>: <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= 4 * (<span class="id">size_arguments</span> <span class="id">sg</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">align_chunk</span> <span class="id">chunk</span> | <span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>))):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">sg</span> <span class="id">targs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7137')">Proof.</div>
<div class="proofscript" id="proof7137">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">TYP</span>. <span class="id">dup</span> <span class="id">FREE</span>. <span class="id">inv</span> <span class="id">FREE</span>. <span class="id">inv</span> <span class="id">freed_from_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ARGRANGE0</span>:= <span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j</span> (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">callee_initial_inj_incr</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>. <span class="tactic">apply</span> <span class="id">Plt_strict</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; [<span class="id">econs</span>|..].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.mi_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">INJECT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs0</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="tactic">replace</span> (<span class="id">ofs0</span> + (<span class="id">z</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>)) <span class="kwd">with</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs0</span> + <span class="id">z</span>); <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">RANGE</span>: 0 &lt;= <span class="id">ofs0</span> /\ <span class="id">ofs0</span> + <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= 4 * <span class="id">size_arguments</span> <span class="id">sg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> - <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">size_chunk_pos</span> <span class="id">chunk</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">ofs0</span>). <span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">H0</span> (<span class="id">ofs0</span> + <span class="id">size_chunk</span> <span class="id">chunk</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="id">des_ifs</span>. <span class="id">i</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z.divide_add_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.mi_align</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">ALIGN</span>. <span class="id">lia</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_align</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2:=<span class="id">ofs0</span>). <span class="id">ii</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">_FillArgsParallel.fill_args_src_blk_inject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">val_inject_list_lessdef</span>. <span class="tactic">apply</span> <span class="id">typify_list_lessdef</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">typify_list_length</span>. <span class="tactic">rewrite</span> <span class="id">LEN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.min_id</span>. <span class="tactic">eapply</span> <span class="id">sig_args_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=(<span class="id">Mem.mem_contents</span> <span class="id">m_src0</span>) !! <span class="id">blk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">extcall_arguments_extcall_arg_in_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Ptrofs.repr_unsigned</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">RSRSP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_extcall_arguments_mach</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Mem.mi_memval</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">ofs0</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; [<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>|<span class="id">econs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">replace</span> (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src0</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">compose_meminj</span> (<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id">Some</span> (<span class="id">b</span>, 0)) (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src0</span>)); <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">extensionality</span> <span class="id">b</span>. <span class="tactic">unfold</span> <span class="id">compose_meminj</span>. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">memval_inject_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=(<span class="id">ZMap.get</span> (<span class="id">ofs0</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">z</span>) (<span class="id">Mem.mem_contents</span> <span class="id">m_tgt</span>) !! <span class="id">b2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2:=(<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_src1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">memval_inject_incr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">ofs0</span>). <span class="id">rpapply</span> <span class="id">H2</span>. <span class="tactic">f_equal</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">callee_initial_inj_incr</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>. <span class="tactic">apply</span> <span class="id">Plt_strict</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_mem</span>'. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=0) <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">zsimpl</span>. <span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rpapply</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">extensionality</span> <span class="id">b</span>. <span class="tactic">unfold</span> <span class="id">compose_meminj</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.alloc</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">f_equal</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">memval_inject_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_mem</span>', <span class="id">Mem.alloc</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gso</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_memval</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">unchanged_on_contents</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">callee_initial_mem_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>'. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">clear</span> - <span class="id">H</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">freed_from_nextblock</span>. <span class="id">xomega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">erewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H0</span>, <span class="id">H1</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">ofs2</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">replace</span> (<span class="id">ofs2</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="kwd">with</span> <span class="id">ofs1</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.mi_no_overlap</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">n1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="id">right</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">blk</span> <span class="id">b2</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">ofs1</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">replace</span> (<span class="id">ofs1</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="kwd">with</span> <span class="id">ofs2</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.mi_no_overlap</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">n1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="id">right</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.mi_no_overlap</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">erewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.mi_representable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.add</span> <span class="id">ofs</span> <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des</span>; <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">left</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_unsigned</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Ptrofs.unsigned_repr</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_unsigned</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Ptrofs.unsigned_repr</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>).  <span class="tactic">clear</span> - <span class="id">a</span> <span class="id">H</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_unsigned</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Ptrofs.unsigned_repr</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> - <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des</span>; <span class="id">des_ifs_safe</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.mi_representable</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des</span>; <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">erewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.mi_perm_inv</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">ofs0</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs0</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:<span class="id">BOUND</span>; <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *; <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">erewrite</span> &lt;- <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">erewrite</span> &lt;- <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">erewrite</span> &lt;- <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">erewrite</span> &lt;- <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span>; <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_rsp_inj_same</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">j</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) = <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAPPED</span>: <span class="id">j</span> <span class="id">blk</span> &lt;&gt; <span class="id">None</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inj_same</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Vptr</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) <span class="id">Ptrofs.zero</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7138')">Proof.</div>
<div class="proofscript" id="proof7138">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">blk</span>) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">EQ</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">z</span>). <span class="id">instantiate</span> (1:=<span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Ptrofs.unsigned_zero</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">JunkBlock</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pos_nat_add</span> (<span class="id">p</span>: <span class="id">positive</span>) (<span class="id">n</span>: <span class="id">nat</span>) : <span class="id">positive</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Zerob.zerob</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> (<span class="id">p</span> + <span class="id">Pos.of_nat</span> <span class="id">n</span>)%<span class="id">positive</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">callee_initial_junk</span>' (<span class="id">rs</span>: <span class="id">regset</span>) (<span class="id">nb</span>: <span class="id">Values.block</span>) (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">l</span>: <span class="id">list</span> <span class="id">preg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">regset</span> * <span class="id">nat</span> * <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; (<span class="id">rs</span>, 0%<span class="id">nat</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">hd</span>::<span class="id">tl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">callee_initial_junk</span>' <span class="id">rs</span> <span class="id">nb</span> <span class="id">j</span> <span class="id">tl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">rs</span>', <span class="id">n</span>, <span class="id">j</span>') =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rs</span>' <span class="id">hd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Pregmap.set</span> <span class="id">hd</span> (<span class="id">Vptr</span> (<span class="id">pos_nat_add</span> <span class="id">nb</span> <span class="id">n</span>) <span class="id">ofs</span>) <span class="id">rs</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Datatypes.S</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blk</span>' =&gt; <span class="kwd">if</span> <span class="id">peq</span> <span class="id">blk</span>' (<span class="id">pos_nat_add</span> <span class="id">nb</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id">j</span>' <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> (<span class="id">j</span>' <span class="id">blk</span>')))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; (<span class="id">rs</span>', <span class="id">n</span>, <span class="id">j</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">assign_junk_blocks_contents</span> <span class="id">m</span> <span class="id">n</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">m</span> <span class="id">b</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Mem.mem_contents</span> (<span class="id">assign_junk_blocks</span> <span class="id">m</span> <span class="id">n</span>)) !! <span class="id">b</span> = (<span class="id">Mem.mem_contents</span> <span class="id">m</span>) !! <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7139')">Proof.</div>
<div class="proofscript" id="proof7139">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">n</span> <span class="id">b</span> <span class="id">m</span> <span class="id">VALID</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="id">ss</span>. <span class="id">i</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">IHn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Mem.alloc</span> <span class="kwd">in</span> *. <span class="id">clarify</span>. <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">PMap.gso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_alloc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_initial_junk_spec</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">rs</span>' <span class="id">m_src</span> <span class="id">m_tgt</span> <span class="id">j</span> <span class="id">j</span>' <span class="id">l</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INITIAL</span>: <span class="id">callee_initial_junk</span>' <span class="id">rs_src</span> <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>) <span class="id">j</span> <span class="id">l</span> = (<span class="id">rs</span>', <span class="id">n</span>, <span class="id">j</span>')):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span>' <span class="id">rs</span>' <span class="id">rs_tgt</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span>' (<span class="id">assign_junk_blocks</span> <span class="id">m_src</span> <span class="id">n</span>) <span class="id">m_tgt</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SEP</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">p</span> (<span class="id">NOTMAP</span>: <span class="id">j</span> <span class="id">b</span> = <span class="id">None</span>) (<span class="id">MAP</span>: <span class="id">j</span>' <span class="id">b</span> = <span class="id">Some</span> <span class="id">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">Mem.valid_block</span> <span class="id">m_src</span> <span class="id">b</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j</span> <span class="id">j</span>'&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">JUNK</span>: <span class="kwd">forall</span> <span class="id">r</span> (<span class="id">IN</span>: <span class="id">In</span> <span class="id">r</span> <span class="id">l</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_junk_value</span> <span class="id">m_src</span> (<span class="id">assign_junk_blocks</span> <span class="id">m_src</span> <span class="id">n</span>) (<span class="id">rs</span>' <span class="id">r</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SAME</span>: <span class="kwd">forall</span> <span class="id">r</span>, <span class="id">inj_same</span> <span class="id">j</span>' (<span class="id">rs_src</span> <span class="id">r</span>) (<span class="id">rs</span>' <span class="id">r</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">EQ</span>: <span class="kwd">forall</span> <span class="id">r</span> (<span class="id">NIN</span>: ~ <span class="id">In</span> <span class="id">r</span> <span class="id">l</span>), <span class="id">rs_src</span> <span class="id">r</span> = <span class="id">rs</span>' <span class="id">r</span>&gt;&gt;)<br/>
&nbsp;&nbsp;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7140')">Proof.</div>
<div class="proofscript" id="proof7140">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l</span> <span class="id">rs</span>' <span class="id">j</span>' <span class="id">n</span> <span class="id">INITIAL</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="id">ss</span>; <span class="id">i</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">exists</span> <span class="id">blk</span> <span class="id">ofs</span>, <span class="id">r</span> <span class="id">a</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>) \/ (<span class="kwd">forall</span> <span class="id">blk</span> <span class="id">ofs</span>, <span class="id">r</span> <span class="id">a</span> &lt;&gt; <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">destruct</span> (<span class="id">r</span> <span class="id">a</span>); <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="tactic">by</span> (<span class="id">right</span>; <span class="id">ii</span>; <span class="id">clarify</span>). } <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">INCR0</span>: <span class="id">inject_incr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blk</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">blk</span>' (<span class="id">pos_nat_add</span> (<span class="id">Mem.nextblock</span> <span class="id">m_src</span>) <span class="id">n0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">m</span> <span class="id">blk</span> <span class="kwd">else</span> <span class="id">m</span> <span class="id">blk</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">des_ifs_safe</span>; <span class="tactic">eauto</span>. <span class="id">des_ifs_safe</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Pregmap.set</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cinv</span> (<span class="id">AGREE0</span> <span class="id">a</span>); <span class="tactic">rewrite</span> <span class="id">Heq0</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">val_inject_incr</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; [<span class="id">econs</span>|..]; <span class="id">i</span>; <span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_perm</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> *. <span class="id">exfalso</span>. <span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">ofs0</span>). <span class="tactic">set</span> (<span class="id">size_chunk_pos</span> <span class="id">chunk</span>). <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_align</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> *. <span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">replace</span> (<span class="id">ZMap.get</span> <span class="id">ofs0</span> (<span class="id">Mem.mem_contents</span> (<span class="id">assign_junk_blocks</span> <span class="id">m_src</span> (<span class="id">Datatypes.S</span> <span class="id">n0</span>))) !! <span class="id">b1</span>) <span class="kwd">with</span> (<span class="id">ZMap.get</span> <span class="id">ofs0</span> (<span class="id">Mem.mem_contents</span> (<span class="id">assign_junk_blocks</span> <span class="id">m_src</span> <span class="id">n0</span>)) !! <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.mi_memval</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">memval_inject_incr</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_contents</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">clear</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>. <span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Zerob.zerob</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_no_overlap</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> <span class="id">H1</span>. <span class="id">des_ifs</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">clear</span> - <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> <span class="id">H2</span>. <span class="id">des_ifs</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.mi_representable</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">Mem.mi_perm_inv</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">erewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clarify</span>. <span class="tactic">rewrite</span> <span class="id">Pregmap.gss</span>. <span class="tactic">unfold</span> <span class="id">is_junk_value</span>, <span class="id">Mem.valid_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">JUNK</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">is_junk_value</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Pregmap.set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heq0</span>. <span class="tactic">unfold</span> <span class="id">pos_nat_add</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des</span>. <span class="tactic">destruct</span> <span class="id">n0</span>; <span class="id">clarify</span>; <span class="id">ss</span>; <span class="id">xomega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Pregmap.set</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cinv</span> (<span class="id">SAME</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">VAL1</span> <span class="kwd">in</span> *; <span class="id">clarify</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heq0</span> <span class="kwd">in</span> *. <span class="id">cinv</span> (<span class="id">AGREE0</span> <span class="id">a</span>); <span class="tactic">rewrite</span> <span class="id">Heq0</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">Pregmap.set</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">EQ</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span> ((<span class="id">r</span>, <span class="id">n0</span>, <span class="id">m</span>) = (<span class="id">rs</span>', <span class="id">n</span>, <span class="id">j</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">INITIAL</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>; <span class="id">clarify</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">is_junk_value</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">callee_save_registers</span> : <span class="id">list</span> <span class="id">preg</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">RA</span>; <span class="id">IR</span> <span class="id">RBX</span>; <span class="id">IR</span> <span class="id">RBP</span>; <span class="id">IR</span> <span class="id">R12</span>; <span class="id">IR</span> <span class="id">R13</span>; <span class="id">IR</span> <span class="id">R14</span>; <span class="id">IR</span> <span class="id">R15</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">callee_save_registers_spec</span> <span class="id">r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">r</span> <span class="id">callee_save_registers</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">exists</span> <span class="id">mr</span> (<span class="id">MR</span>: <span class="id">to_preg</span> <span class="id">mr</span> = <span class="id">r</span>), <span class="id">is_callee_save</span> <span class="id">mr</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> = <span class="id">RA</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7141')">Proof.</div>
<div class="proofscript" id="proof7141">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">ss</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">to_mreg</span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">MR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">exists</span> <span class="id">m</span>. <span class="id">des</span>; <span class="id">clarify</span>; <span class="id">eexists</span>; <span class="id">ss</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">is_callee_save</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span> 10.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> match states ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">different_owner</span> (<span class="id">v0</span> <span class="id">v1</span> : <span class="id">val</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">mod0</span> <span class="id">mod1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OWNER0</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>) <span class="id">v0</span> <span class="id">mod0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OWNER1</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>) <span class="id">v1</span> <span class="id">mod1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mod0</span> &lt;&gt; <span class="id">mod1</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">match_states</span> : <span class="id">Sem.state</span> -&gt; <span class="id">Asm.state</span> -&gt; <span class="id">nat</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_states_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span> <span class="id">fr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">init_rs</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">m_src</span> <span class="id">m_tgt</span> <span class="id">n</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMWF</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">loc_not_writable</span> <span class="id">m_init</span>) <span class="id">m_init</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GELE</span>: <span class="id">genv_le</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">tge</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GEINJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FRAME</span>: <span class="id">fr</span> = <span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs</span> (<span class="id">Asm.State</span> <span class="id">rs_src</span> <span class="id">m_src</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack</span> <span class="id">j</span> <span class="id">P</span> <span class="id">init_rs</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PWF</span>: <span class="id">P</span> &lt;2= ~2 (<span class="id">SimMemInj.valid_blocks</span> <span class="id">m_init</span> /2\ <span class="id">loc_not_writable</span> <span class="id">m_init</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ORD</span>: <span class="id">n</span> = <span class="kwd">if</span> (<span class="id">external_state</span> (<span class="id">local_genv</span> <span class="id">p</span>) (<span class="id">rs_src</span> # <span class="id">PC</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id">length</span> <span class="id">frs</span> + 2)%<span class="id">nat</span> <span class="kwd">else</span> 0%<span class="id">nat</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">State</span> (<span class="id">fr</span>::<span class="id">frs</span>)) (<span class="id">Asm.State</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span>) <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">match_states_call</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span> <span class="id">init_rs</span> <span class="id">frs</span> <span class="id">args</span> <span class="id">fptr_arg</span> <span class="id">vs_arg</span> <span class="id">m_arg</span> <span class="id">m_src</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span> <span class="id">ofs</span> <span class="id">blk</span> <span class="id">sg</span> <span class="id">P</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CSTYLE</span>: <span class="id">args</span> = <span class="id">Args.Cstyle</span> <span class="id">fptr_arg</span> <span class="id">vs_arg</span> <span class="id">m_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack_call</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">P</span> <span class="id">init_rs</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PWF</span>: <span class="id">P</span> &lt;2= ~2 (<span class="id">SimMemInj.valid_blocks</span> <span class="id">m_init</span> /2\ <span class="id">loc_not_writable</span> <span class="id">m_init</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">init_rs</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMWF</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">loc_not_writable</span> <span class="id">m_init</span>) <span class="id">m_init</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GEINJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FPTR</span>: <span class="id">fptr_arg</span> = <span class="id">init_rs</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGRANGE</span>: <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) <span class="id">fptr_arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">Some</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ALIGN</span>: <span class="kwd">forall</span> <span class="id">chunk</span> (<span class="id">CHUNK</span>: <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= 4 * (<span class="id">size_arguments</span> <span class="id">sg</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">align_chunk</span> <span class="id">chunk</span> | <span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGS</span>: <span class="id">Asm.extcall_arguments</span> <span class="id">init_rs</span> <span class="id">m_src</span> <span class="id">sg</span> <span class="id">vs_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPPTR</span>: <span class="id">init_rs</span> # <span class="id">RSP</span> = <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_arg</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RAPTR</span>: &lt;&lt;<span class="id">TPTR</span>: <span class="id">Val.has_type</span> (<span class="id">init_rs</span> <span class="id">RA</span>) <span class="id">Tptr</span>&gt;&gt; /\ &lt;&lt;<span class="id">RADEF</span>: <span class="id">init_rs</span> <span class="id">RA</span> &lt;&gt; <span class="id">Vundef</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">freed_from</span> <span class="id">m_src</span> <span class="id">m_arg</span> <span class="id">blk</span> <span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>) (<span class="id">ofs</span>.(<span class="id">Ptrofs.unsigned</span>) + 4 * (<span class="id">size_arguments</span> <span class="id">sg</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ORD</span>: <span class="id">n</span> = 1%<span class="id">nat</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) (<span class="id">Asm.State</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span>) <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">match_states_call_asmstyle</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span> <span class="id">init_rs</span> <span class="id">frs</span> <span class="id">args</span> <span class="id">m_src</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span> <span class="id">P</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ASMSTYLE</span>: <span class="id">args</span> = <span class="id">Args.Asmstyle</span> <span class="id">init_rs</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACK</span>: <span class="id">match_stack_call</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">P</span> <span class="id">init_rs</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PWF</span>: <span class="id">P</span> &lt;2= ~2 (<span class="id">SimMemInj.valid_blocks</span> <span class="id">m_init</span> /2\ <span class="id">loc_not_writable</span> <span class="id">m_init</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">agree</span> <span class="id">j</span> <span class="id">init_rs</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMWF</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">loc_not_writable</span> <span class="id">m_init</span>) <span class="id">m_init</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GEINJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIG</span>: <span class="id">exists</span> <span class="id">skd</span>, <span class="id">skenv_link</span>.(<span class="id">Genv.find_funct</span>) (<span class="id">init_rs</span> # <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">skd</span> /\ <span class="id">Sk.get_csig</span> <span class="id">skd</span> = <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">skenv_link</span> <span class="id">j</span> <span class="id">m_src</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RAPTR</span>: &lt;&lt;<span class="id">TPTR</span>: <span class="id">Val.has_type</span> (<span class="id">init_rs</span> <span class="id">RA</span>) <span class="id">Tptr</span>&gt;&gt; /\ &lt;&lt;<span class="id">RADEF</span>: <span class="id">init_rs</span> <span class="id">RA</span> &lt;&gt; <span class="id">Vundef</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ORD</span>: <span class="id">n</span> = 1%<span class="id">nat</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) (<span class="id">Asm.State</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span>) <span class="id">n</span><br/>
&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">init_volatile_readonly</span> <span class="id">blk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VOL</span>: <span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ofs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc_not_writable</span> <span class="id">m_init</span> <span class="id">blk</span> <span class="id">ofs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7142')">Proof.</div>
<div class="proofscript" id="proof7142">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">INIT_MEM</span>. <span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> <span class="id">INIT_MEM0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.init_mem_characterization_gen</span> <span class="kwd">in</span> <span class="id">INIT_MEM0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.block_is_volatile</span>, <span class="id">Genv.globals_initialized</span>, <span class="id">Genv.find_var_info</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>. <span class="id">exploit</span> <span class="id">INIT_MEM0</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id">Genv.perm_globvar</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">des</span>. <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">volatile_readonly</span> <span class="id">m</span> <span class="id">blk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMWF</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">loc_not_writable</span> <span class="id">m_init</span>) <span class="id">m_init</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VOL</span>: <span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ofs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc_not_writable</span> <span class="id">m</span> <span class="id">blk</span> <span class="id">ofs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7143')">Proof.</div>
<div class="proofscript" id="proof7143">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">INIT_MEM</span>. <span class="tactic">unfold</span> <span class="id">Sk.load_mem</span> <span class="kwd">in</span> <span class="id">INIT_MEM0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">VOL</span>. <span class="tactic">eapply</span> <span class="id">init_volatile_readonly</span> <span class="kwd">in</span> <span class="id">VOL0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">VOL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="id">erewrite</span> &lt;- <span class="id">Genv.init_mem_genv_next</span>; <span class="tactic">eauto</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">inj_range_wf_step</span> <span class="id">j0</span> <span class="id">j1</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMPERM</span>: <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span> -&gt; <span class="id">Mem.perm</span> <span class="id">m0</span> <span class="id">blk</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span> \/ <span class="id">j0</span> <span class="id">blk</span> = <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j0</span> <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGEWF</span>: <span class="id">inj_range_wf</span> <span class="id">skenv_link</span> <span class="id">j0</span> <span class="id">m0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">exists</span> <span class="id">m_tgt</span>, <span class="id">Mem.inject</span> <span class="id">j1</span> <span class="id">m1</span> <span class="id">m_tgt</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inj_range_wf</span> <span class="id">skenv_link</span> <span class="id">j1</span> <span class="id">m1</span> <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7144')">Proof.</div>
<div class="proofscript" id="proof7144">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">des</span>. <span class="id">inv</span> <span class="id">INJ</span>. <span class="id">inv</span> <span class="id">mi_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">RANGEWF</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">j1</span> <span class="id">blk</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">econs</span> 2; <span class="tactic">eauto</span>; <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">mi_align</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H0</span>). <span class="id">ss</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">BOT</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des</span>; <span class="id">exfalso</span>; <span class="tactic">eapply</span> <span class="id">BOT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">BOT</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span> 2; <span class="tactic">eauto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ALIGN</span>. <span class="id">ii</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x0</span> <span class="id">PR</span>). <span class="id">ss</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">MEMPERM</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">des</span>; <span class="id">clarify</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_step_init_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">args</span> <span class="id">frs</span> <span class="id">st_tgt</span> <span class="id">p</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) <span class="id">st_tgt</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OWNER</span>: <span class="id">valid_owner</span> <span class="id">args</span>.(<span class="id">Args.get_fptr</span>) <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.initial_frame</span> <span class="id">skenv_link</span> <span class="id">p</span> <span class="id">args</span> (<span class="id">AsmC.mkstate</span> <span class="id">rs</span> (<span class="id">Asm.State</span> <span class="id">rs</span> <span class="id">m</span>))) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">match_states</span> (<span class="id">State</span> ((<span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>) (<span class="id">AsmC.mkstate</span> <span class="id">rs</span> (<span class="id">Asm.State</span> <span class="id">rs</span> <span class="id">m</span>))) :: <span class="id">frs</span>)) <span class="id">st_tgt</span> 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7145')">Proof.</div>
<div class="proofscript" id="proof7145">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Cstyle&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">dup</span> <span class="id">OWNER</span>. <span class="id">inv</span> <span class="id">OWNER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">owner_genv_le</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">GELE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Mem.alloc</span> <span class="id">m_arg</span> 0 (4 * <span class="id">size_arguments</span> <span class="id">sg</span>)) <span class="id">eqn</span>:<span class="id">MEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Genv.find_funct</span> <span class="id">skenv_link</span> (<span class="id">init_rs</span> <span class="id">PC</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">Internal</span> (<span class="id">fn_sig</span> <span class="id">fd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">dup</span> <span class="id">OWNER0</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Genv.find_funct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_funct</span>, <span class="id">Genv.find_funct_ptr</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">sub_match_local_genv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">MATCHGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">sub_mge_defs</span> <span class="id">MATCHGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>. <span class="id">specialize</span> (<span class="id">e</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Heq1</span>). <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MATCHDEF</span>. <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TYPCHK</span>: <span class="id">typecheck</span> <span class="id">vs_arg</span> (<span class="id">fn_sig</span> <span class="id">fd</span>) (<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">sig_args_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">list_forall2_length</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">callee_initial_inject</span>'; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">FREE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">INJECT0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">callee_initial_inj_incr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">m_arg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_strict</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">ofs</span>). <span class="id">instantiate</span> (1:= <span class="id">blk</span>). <span class="tactic">intros</span> <span class="id">INCR</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">callee_initial_arguments</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ARGS0</span>. <span class="id">instantiate</span> (1:=<span class="id">m_arg</span>) <span class="kwd">in</span> <span class="id">ARGS0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">callee_initial_rsp_inj_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">m_arg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_strict</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">blk</span>). <span class="id">ii</span>. <span class="id">cinv</span> (<span class="id">AGREE</span> <span class="id">RSP</span>); <span class="tactic">rewrite</span> <span class="id">RSPPTR</span> <span class="kwd">in</span> *; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">ofs</span>). <span class="tactic">intros</span> <span class="id">SAME</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">callee_initial_reg</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">pr</span> =&gt; <span class="kwd">match</span> <span class="id">Asm.to_mreg</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">mr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id">is_callee_save</span> <span class="id">mr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id">init_rs</span> <span class="id">pr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_reg</span>' (<span class="id">fn_sig</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">IR</span> <span class="id">RSP</span> =&gt; (<span class="id">Vptr</span> (<span class="id">Mem.nextblock</span> <span class="id">m_src</span>) <span class="id">Ptrofs.zero</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">PC</span> =&gt; <span class="id">init_rs</span> <span class="id">PC</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RA</span> =&gt; <span class="id">init_rs</span> <span class="id">RA</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Vundef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">callee_initial_junk</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">callee_initial_reg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Mem.nextblock</span> (<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m_src</span> <span class="id">m_arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fn_sig</span> <span class="id">fd</span>) (<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">callee_save_registers</span>) <span class="kwd">as</span> [[<span class="id">rs_callee</span> <span class="id">n</span>] <span class="id">j_callee</span>] <span class="id">eqn</span>:<span class="id">JUNKED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">callee_initial_junk_spec</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">JUNKED</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">rs_tgt</span>). <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>'. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.val_lessdef_inject_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">val_inject_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">_FillArgsParallel.fill_args_src_reg_agree</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">val_inject_list_lessdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">typify_list_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">TYPCHK</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">TYPCHK</span>. <span class="id">erewrite</span> <span class="id">typify_list_length</span>. <span class="tactic">rewrite</span> <span class="id">LEN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.min_id</span>. <span class="tactic">eapply</span> <span class="id">sig_args_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">extcall_arguments_extcall_arg_in_reg</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Ptrofs.repr_unsigned</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">RSPPTR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_extcall_arguments_mach</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">val_inject_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AsmregsC.to_mregset</span>. <span class="id">erewrite</span> <span class="id">to_mreg_preg_of</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">inj_same_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="id">dup</span> <span class="id">SAME</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">freed_from_nextblock</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">RSPPTR</span>. <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs_callee</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">assign_junk_blocks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m_src</span> <span class="id">m_arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fn_sig</span> <span class="id">fd</span>) (<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)))) <span class="id">n</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNCH</span>: <span class="id">Mem.unchanged_on</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">b</span> : <span class="id">Values.block</span>) (<span class="id">ofs0</span> : <span class="id">Z</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">eq_block</span> <span class="id">b</span> (<span class="id">Mem.nextblock</span> <span class="id">m_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> ~ 0 &lt;= <span class="id">ofs0</span> &lt; 4 * <span class="id">size_arguments</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">True</span>) <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">callee_initial_mem</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">m_src</span> <span class="id">m_arg</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>))))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">eauto</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Mem.alloc</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">MEQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">clear</span> - <span class="id">MEQ</span> <span class="id">H0</span> <span class="id">H1</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_3</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">PMap.gso</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_contents</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.alloc_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1:=<span class="id">top2</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_4</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> - <span class="id">TPTR</span> <span class="id">RADEF</span> <span class="id">SAME0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (<span class="id">SAME0</span> <span class="id">RA</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">VAL1</span>. <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">JUNK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=<span class="id">RA</span>). <span class="id">ss</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">is_junk_value</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">RAVAL</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">callee_initial_mem_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">skenv_inject_memory</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">clear</span> - <span class="id">H2</span>. <span class="id">xomega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> &lt;- <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>; <span class="id">clarify</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">extcall_arguments_same</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">hexploit</span> <span class="id">Conventions1C.loc_args_callee_save_disjoint</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AsmregsC.to_mregset</span>. <span class="id">erewrite</span> &lt;- <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span>. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">callee_save_registers_spec</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="tactic">f_equal</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">to_mreg</span>) <span class="kwd">in</span> <span class="id">MR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="tactic">f_equal</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">to_mreg</span>) <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span> <span class="kwd">in</span> *. <span class="id">ss</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> <span class="id">JUNKED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LEN</span>: <span class="id">Datatypes.length</span> <span class="id">vs_arg</span> = <span class="id">Datatypes.length</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">sig_args_length</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">list_forall2_length</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">_FillArgsParallel.fill_args_src_blk_only_args</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">val_inject_list_lessdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">typify_list_lessdef</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">loc_arguments_norepet</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">typify_list_length</span>. <span class="tactic">rewrite</span> <span class="id">LEN</span>. <span class="tactic">rewrite</span> <span class="id">Nat.min_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sig_args_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">loc_arguments_one</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">extcall_arguments_extcall_arg_in_stack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range</span> <span class="id">ofs</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id">Ptrofs.repr_unsigned</span>. <span class="id">erewrite</span> &lt;- <span class="id">RSPPTR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_extcall_arguments_mach</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ONLY</span> <span class="id">ofs0</span>. <span class="id">specialize</span> (<span class="id">ONLY</span> <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.alloc</span> <span class="id">Mem.load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_mem</span>', <span class="id">Mem.alloc</span>. <span class="id">ss</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">left</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.load</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">loc_arguments_bounded</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">loc_arguments_acceptable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:=(<span class="id">fn_sig</span> <span class="id">fd</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">One</span> (<span class="id">S</span> <span class="id">Outgoing</span> <span class="id">ofs1</span> <span class="id">ty</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">in_regs_of_rpairs_inv</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rpapply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loc_arguments_one</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id">is_one</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">des</span>; <span class="id">clarify</span>. } <span class="id">i</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero_l</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.unsigned_repr</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">typesize_chunk</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H2</span> <span class="id">ARGRANGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="tactic">set</span> (<span class="id">typesize_pos</span> <span class="id">ty</span>). <span class="id">lia</span>. } <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">erewrite</span> <span class="id">PMap.gss</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_access</span>, <span class="id">Mem.range_perm</span>, <span class="id">Mem.perm</span>. <span class="id">ss</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>. <span class="tactic">rewrite</span> <span class="id">typesize_chunk</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span>; <span class="id">des_ifs</span>; (<span class="tactic">try</span> <span class="tactic">by</span> <span class="id">econs</span>); <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="tactic">by</span> <span class="tactic">eapply</span> <span class="id">Z.divide_factor_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Z.mul_divide_mono_l</span> <span class="kwd">with</span> (<span class="id">p</span>:=4) <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span>. <span class="id">i</span>. <span class="id">erewrite</span> <span class="id">callee_initial_mem_perm</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span>. <span class="tactic">clear</span> - <span class="id">H0</span>. <span class="id">des_ifs</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> &lt;- <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>; <span class="id">clarify</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">assert</span> (<span class="id">NIN</span>: ~ <span class="id">In</span> <span class="id">pr</span> <span class="id">callee_save_registers</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">NIN</span>. <span class="id">erewrite</span> <span class="id">callee_save_registers_spec</span> <span class="kwd">in</span> <span class="id">NIN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">PTR</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span> <span class="kwd">in</span> <span class="id">PTR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">to_mreg</span> <span class="id">pr</span>) <span class="id">eqn</span>:<span class="id">MR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">NIN</span>. <span class="id">left</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">AsmregsC.to_mreg_some_to_preg</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>' <span class="kwd">in</span> <span class="id">PTR</span>. <span class="id">des_ifs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>. <span class="id">exfalso</span>. <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">AGREE0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">INJECT1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">JUNKED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mem_readonly_trans</span> <span class="kwd">with</span> <span class="id">m_src</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mem_readonly_trans</span> <span class="kwd">with</span> <span class="id">m_arg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mem_readonly_trans</span> <span class="kwd">with</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.alloc_unchanged_on</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mem_readonly_trans</span> <span class="kwd">with</span> (<span class="id">callee_initial_mem</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk</span> <span class="id">ofs</span> <span class="id">m_src</span> <span class="id">m_arg</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typify_list</span> <span class="id">vs_arg</span> (<span class="id">sig_args</span> (<span class="id">fn_sig</span> <span class="id">fd</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem_alloc_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">assign_junk_blocks_unchanged_on</span>. } <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">dup</span> <span class="id">GEINJECT</span>. <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">dup</span> <span class="id">PERM</span>. <span class="tactic">eapply</span> <span class="id">Senv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">DOMAIN</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1:=0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PERM</span>. <span class="tactic">apply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="tactic">apply</span> <span class="id">INCR0</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_arg</span> (<span class="id">Mem.nextblock</span> <span class="id">m_arg</span>)) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">DELTA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">dup</span> <span class="id">DELTA</span>. <span class="tactic">apply</span> <span class="id">INCR0</span> <span class="kwd">in</span> <span class="id">DELTA0</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">DELTA</span>. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Heq0</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">blk</span>) <span class="id">eqn</span>:<span class="id">VEQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">volatile_readonly</span> <span class="kwd">in</span> <span class="id">VEQ0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">VEQ0</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">JUNKED</span>. <span class="id">des_ifs</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> (<span class="id">Mem.nextblock</span> <span class="id">m_arg</span>)) <span class="id">eqn</span>: <span class="id">VEQ1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">VEQ1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">skenv_inject_memory</span>; <span class="tactic">try</span> <span class="id">eassumption</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> - <span class="id">VEQ1</span> <span class="id">H1</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">exists</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">clear</span> - <span class="id">l0</span> <span class="id">l</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">hexploit</span> <span class="id">SEP</span>; <span class="tactic">try</span> <span class="id">eassumption</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">callee_initial_mem_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">callee_initial_inj</span>' <span class="id">blk</span> <span class="id">ofs</span> <span class="id">j</span> <span class="id">m_arg</span> <span class="id">b1</span>) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">DELTA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">callee_initial_inj</span>' <span class="kwd">in</span> <span class="id">DELTA</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dup</span> <span class="id">DELTA</span>. <span class="tactic">eapply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">DELTA</span>. <span class="tactic">eapply</span> <span class="id">INCR0</span> <span class="kwd">in</span> <span class="id">DELTA</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">try</span> <span class="id">eassumption</span>. <span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">hexploit</span> <span class="id">SEP</span>; <span class="tactic">try</span> <span class="id">eassumption</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">callee_initial_mem_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="tactic">clear</span> - <span class="id">PERM</span>. <span class="id">xomega</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ss</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">P</span>). <span class="id">inv</span> <span class="id">STACK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">SAME0</span> <span class="id">RA</span>). <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span> <span class="kwd">in</span> <span class="id">SAME0</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">initial_regset</span>, <span class="id">Pregmap.set</span> <span class="kwd">in</span> <span class="id">SAME0</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> &lt;- <span class="id">EQ</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="id">ii</span>. <span class="id">ss</span>; <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">match_stack_incr</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">STACK0</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span>. <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="id">ii</span>. <span class="id">ss</span>; <span class="id">des</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">JUNK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">RA</span>). <span class="id">ss</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">is_junk_value</span>. <span class="tactic">rewrite</span> <span class="id">RAVAL</span>. <span class="id">i</span>. <span class="tactic">apply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">skenv_inject_memory</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> - <span class="id">H2</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">etrans</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">SAME0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>. <span class="id">refl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">etrans</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">SAME0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">RSPPTR0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">RSPPTR</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">freed_from_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">inj_same_incr</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">etrans</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">SAME0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">callee_initial_reg</span>. <span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs_safe</span>. <span class="id">refl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">replace</span> (<span class="id">rs_callee</span> <span class="id">PC</span>) <span class="kwd">with</span> (<span class="id">st_rs</span> <span class="id">st</span> <span class="id">PC</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">EQ</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="id">ii</span>. <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">FINDF</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">cinv</span> (<span class="id">WFINJ</span> <span class="id">blk0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">j_callee</span> <span class="id">blk0</span>) <span class="kwd">as</span> [[]|]<span class="id">eqn</span>:<span class="id">BLK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_align</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">BOT</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_representable</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJECT1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="id">des</span>; <span class="tactic">eapply</span> <span class="id">BOT</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">BOT</span>. <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span> 1; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span> 2; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">ALIGN0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> <span class="id">PR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">callee_initial_mem_perm</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">DELTA</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="tactic">unfold</span> <span class="id">external_state</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">callee_initial_reg</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">clear</span> <span class="id">JUNKED</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_funct</span> <span class="kwd">in</span> <span class="id">FINDF</span>. <span class="tactic">clear</span> - <span class="id">Heq2</span> <span class="id">FINDF</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span>. <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des</span>; <span class="id">clarify</span>. } }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;asmstyle&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">dup</span> <span class="id">OWNER</span>. <span class="id">inv</span> <span class="id">OWNER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">owner_genv_le</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">GELE</span>. <span class="id">des</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">callee_initial_junk</span>' <span class="id">init_rs</span> <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>) <span class="id">j</span> [<span class="id">RA</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [[<span class="id">rs_callee</span> <span class="id">n</span>] <span class="id">j_callee</span>] <span class="id">eqn</span>:<span class="id">JUNKED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">callee_initial_junk_spec</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs_callee</span>. <span class="id">exists</span> (<span class="id">assign_junk_blocks</span> <span class="id">m_src</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">splits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">dup</span> <span class="id">FINDF</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">FINDF</span>; <span class="tactic">eauto</span>. <span class="id">econs</span> 2; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">FINDF</span>. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=<span class="id">rs_callee</span> # <span class="id">RA</span>). <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">JUNK</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">RAVAL</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Pregmap.gss</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">skenv_inject_memory</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pos_nat_add</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">JUNK</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">extensionality</span> <span class="id">pr</span>. <span class="tactic">unfold</span> <span class="id">Pregmap.set</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">EQ</span>. <span class="id">ii</span>. <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span> <span class="kwd">with</span> (<span class="id">P</span>:=<span class="id">top2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">assign_junk_blocks_unchanged_on</span>. <span class="id">i</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cinv</span> <span class="id">GEINJECT</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">BLK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p0</span>. <span class="id">dup</span> <span class="id">BLK</span>. <span class="tactic">apply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">BLK</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">SEP</span> <span class="kwd">in</span> <span class="id">INJ</span>; <span class="tactic">auto</span>. <span class="id">exfalso</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">INJ</span>. <span class="tactic">eapply</span> <span class="id">Senv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">skenv_inject_memory</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">STACK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">clear</span> - <span class="id">FINDF</span> <span class="id">SIG</span> <span class="id">SIG0</span> <span class="id">SIG1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">initial_regset</span>, <span class="id">Pregmap.set</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">FINDF</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span> 3; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">match_stack_incr</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">STACK0</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inj_range_wf_step</span>; <span class="id">cycle</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">external_state</span>, <span class="id">Genv.find_funct</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> transf initial final  ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">transf_initial_states</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span>, <span class="id">Sem.initial_state</span> <span class="id">prog</span> <span class="id">st1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st2</span>, <span class="id">Asm.initial_state</span> <span class="id">tprog</span> <span class="id">st2</span> /\ <span class="id">match_states</span> <span class="id">st1</span> <span class="id">st2</span> 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7146')">Proof.</div>
<div class="proofscript" id="proof7146">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">TGT_INIT_MEM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">initial_regset_agree</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">initmem_inject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">initmem_inject</span> <span class="id">initial_regset_agree</span> <span class="id">TGT_INT_MEM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">st1</span> <span class="id">INIT</span>. <span class="id">inv</span> <span class="id">INIT</span>. <span class="tactic">move</span> <span class="id">INITSK</span> <span class="tactic">at</span> <span class="id">top</span>. <span class="id">clarify</span>. <span class="id">esplits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id">symb_main</span>. <span class="tactic">unfold</span> <span class="id">skenv_link</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=<span class="id">bot2</span>). <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">init_inject_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">initial_regset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Pregmap.gso</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Pregmap.gso</span>; <span class="id">clarify</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Pregmap.gss</span>. <span class="tactic">unfold</span> <span class="id">tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">MAIN</span>:= <span class="id">symb_main</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>. <span class="tactic">unfold</span> <span class="id">skenv_link</span>, <span class="id">tge</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">MAIN</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=<span class="id">signature_main</span>). <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Ptrofs.unsigned_zero</span>. <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Z.divide_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">initmem_inject</span>. <span class="id">inv</span> <span class="id">mi_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">init_inject</span> <span class="id">blk</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">econs</span> 2; <span class="id">i</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">mi_align</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H0</span>). <span class="id">ss</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">mi_representable</span>; <span class="tactic">eauto</span>. <span class="id">des</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span> 1; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clarify</span>. <span class="tactic">apply</span> <span class="id">init_mem_freed_from</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">transf_final_states</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">r</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">n</span> -&gt; <span class="id">Sem.final_state</span> <span class="id">st1</span> <span class="id">r</span> -&gt; <span class="id">Asm.final_state</span> <span class="id">st2</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7147')">Proof.</div>
<div class="proofscript" id="proof7147">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">st_src</span> <span class="id">st_tgt</span> <span class="id">r</span> <span class="id">n</span> <span class="id">MTCHST</span> <span class="id">FINAL</span>. <span class="id">inv</span> <span class="id">FINAL</span>. <span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FINAL0</span>; <span class="id">clarify</span>. <span class="id">inv</span> <span class="id">STACK</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">PC</span>). <span class="tactic">rewrite</span> <span class="id">RSRA</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">RSRA0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">AGREE</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des</span>. <span class="tactic">rewrite</span> <span class="id">RSPC</span> <span class="kwd">in</span> *. <span class="id">exploit</span> <span class="id">local_global_consistent</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">SGEQ</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">SGEQ</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">signature_main</span>, <span class="id">loc_arguments</span>, <span class="id">loc_result</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Transparent</span> <span class="id">Archi.ptr64</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">loc_result_64</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">RAX</span>). <span class="id">clarify</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">INT</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">AGREE</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> transf step  ********************************</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">asm_step_internal_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_src0</span> <span class="id">st_src1</span> <span class="id">st_tgt0</span> <span class="id">tr</span> <span class="id">frs</span> <span class="id">p</span> <span class="id">init_rs</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP</span>: <span class="id">Asm.step</span> <span class="id">skenv_link</span> (<span class="id">local_genv</span> <span class="id">p</span>) <span class="id">st_src0</span> <span class="id">tr</span> <span class="id">st_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">State</span> ((<span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs</span> <span class="id">st_src0</span>))::<span class="id">frs</span>)) <span class="id">st_tgt0</span> <span class="id">n0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st_tgt1</span> <span class="id">n1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Asm.step</span> <span class="id">skenv_link</span> <span class="id">tge</span> <span class="id">st_tgt0</span> <span class="id">tr</span> <span class="id">st_tgt1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">State</span> ((<span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs</span> <span class="id">st_src1</span>))::<span class="id">frs</span>)) <span class="id">st_tgt1</span> <span class="id">n1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7148')">Proof.</div>
<div class="proofscript" id="proof7148">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">dup</span> <span class="id">FRAME</span>. <span class="id">dup</span> <span class="id">FRAME</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">asm_frame_inj</span> <span class="kwd">in</span> <span class="id">FRAME0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">asm_frame_inj2</span> <span class="kwd">in</span> <span class="id">FRAME</span>. <span class="id">inv</span> <span class="id">FRAME0</span>. <span class="tactic">destruct</span> <span class="id">st_src1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">owner_genv_le</span> <span class="kwd">in</span> <span class="id">PROGIN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FRAME</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">asm_step_preserve_injection</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> <span class="id">FRAME1</span> <span class="id">FRAME</span>. <span class="id">inv</span> <span class="id">GELE</span>. <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">exploit</span> <span class="id">sub_mge_defs0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WFSKELINK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DOMAIN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> &lt;- <span class="id">Genv.mge_next</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">b_src</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">clarify</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">exploit</span> <span class="id">sub_mge_symb0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Genv.mge_next</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">match_skenv_link_tge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">system_symbols_inject</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">des</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">senv_same</span> <span class="kwd">in</span> *. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">mem_readonly_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_step_readonly</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ { <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">inject_incr</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INCR</span>. <span class="tactic">eapply</span> <span class="id">DOMAIN</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b2</span>) <span class="id">eqn</span>:<span class="id">EQ1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">EQ2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">EQ1</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">EQ2</span>; <span class="tactic">eapply</span> <span class="id">IMAGE</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">PERM</span> <span class="kwd">as</span> [<span class="id">n</span>|[<span class="id">ofs</span> <span class="id">PERM</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">n</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Genv.block_is_volatile_below</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b1</span>) <span class="id">eqn</span> : <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p2</span>. <span class="tactic">apply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">SEP</span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">INJ1</span>). <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INJ</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">FRAME1</span>. <span class="id">des</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b1</span>) <span class="kwd">as</span>[[]|] <span class="id">eqn</span>:<span class="id">BEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs</span>. <span class="tactic">eapply</span> <span class="id">asm_step_max_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>. <span class="tactic">apply</span> <span class="id">BEQ</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">exploit</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">Genv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">EQ1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Genv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">DOMAIN</span> <span class="id">_</span> <span class="id">EQ2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">INCR</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e</span>). <span class="id">clarify</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">FRAME1</span>. <span class="id">des</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=<span class="id">init_rs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">JEQ</span>: @<span class="id">JMeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ModSem.state</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id">init_rs</span> := <span class="id">init_rs0</span>; <span class="id">st</span> := <span class="id">Asm.State</span> <span class="id">r</span> <span class="id">m</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ModSem.state</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id">init_rs</span> := <span class="id">init_rs0</span>; <span class="id">st</span> := <span class="id">Asm.State</span> <span class="id">r</span> <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">JEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ({| <span class="id">init_rs</span> := <span class="id">init_rs0</span>; <span class="id">st</span> := <span class="id">Asm.State</span> <span class="id">r</span> <span class="id">m</span> |} : <span class="id">ModSem.state</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p0</span>)) <span class="tactic">at</span> 2 4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ({| <span class="id">init_rs</span> := <span class="id">init_rs0</span>; <span class="id">st</span> := <span class="id">Asm.State</span> <span class="id">r</span> <span class="id">m</span> |} : <span class="id">ModSem.state</span> (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="tactic">f_equal</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">Frame.ms</span>) <span class="kwd">in</span> <span class="id">FRAME1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">FRAME1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">FRAME1</span>. <span class="tactic">destruct</span> <span class="id">FRAME1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">JMeq_eq</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">match_stack_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inj_range_wf_step</span>; <span class="id">cycle</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">blk</span>) <span class="id">eqn</span>: <span class="id">EQ</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">p2</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">asm_step_max_perm</span> <span class="kwd">in</span> <span class="id">STEP</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">step_internal_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr0</span> <span class="id">frs</span> <span class="id">tr</span> <span class="id">st0</span> <span class="id">st_tgt0</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP</span>: <span class="id">fr0</span>.(<span class="id">Frame.ms</span>).(<span class="id">ModSem.step</span>) <span class="id">skenv_link</span> <span class="id">fr0</span>.(<span class="id">Frame.ms</span>).(<span class="id">ModSem.globalenv</span>) <span class="id">fr0</span>.(<span class="id">Frame.st</span>) <span class="id">tr</span> <span class="id">st0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">State</span> (<span class="id">fr0</span> :: <span class="id">frs</span>)) <span class="id">st_tgt0</span> <span class="id">n0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st_tgt1</span> <span class="id">n1</span>, <span class="id">Asm.step</span> <span class="id">skenv_link</span> <span class="id">tge</span> <span class="id">st_tgt0</span> <span class="id">tr</span> <span class="id">st_tgt1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">State</span> ((<span class="id">fr0</span>.(<span class="id">Frame.update_st</span>) <span class="id">st0</span>) :: <span class="id">frs</span>)) <span class="id">st_tgt1</span> <span class="id">n1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7149')">Proof.</div>
<div class="proofscript" id="proof7149">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">inv</span> <span class="id">STEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">asm_step_internal_simulation</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">st0</span>; <span class="id">ss</span>; <span class="id">clarify</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Mem_unchanged_on_strengthen</span> <span class="id">P</span> <span class="id">m0</span> <span class="id">m1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.unchanged_on</span> <span class="id">P</span> <span class="id">m0</span> <span class="id">m1</span> &lt;-&gt; <span class="id">Mem.unchanged_on</span> (<span class="id">SimMemInj.valid_blocks</span> <span class="id">m0</span> /2\ <span class="id">P</span>) <span class="id">m0</span> <span class="id">m1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7150')">Proof.</div>
<div class="proofscript" id="proof7150">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">step_return_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr0</span> <span class="id">fr1</span> <span class="id">frs</span> <span class="id">retv</span> <span class="id">st0</span> <span class="id">st_tgt</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FINAL</span>: <span class="id">fr0</span>.(<span class="id">Frame.ms</span>).(<span class="id">ModSem.final_frame</span>) <span class="id">fr0</span>.(<span class="id">Frame.st</span>) <span class="id">retv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AFTER</span>: <span class="id">fr1</span>.(<span class="id">Frame.ms</span>).(<span class="id">ModSem.after_external</span>) <span class="id">fr1</span>.(<span class="id">Frame.st</span>) <span class="id">retv</span> <span class="id">st0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">State</span> (<span class="id">fr0</span> :: <span class="id">fr1</span> :: <span class="id">frs</span>)) <span class="id">st_tgt</span> <span class="id">n0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n1</span>, <span class="id">match_states</span> (<span class="id">State</span> ((<span class="id">fr1</span>.(<span class="id">Frame.update_st</span>) <span class="id">st0</span>) :: <span class="id">frs</span>)) <span class="id">st_tgt</span> <span class="id">n1</span> /\ (<span class="id">n1</span> &lt; <span class="id">n0</span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7151')">Proof.</div>
<div class="proofscript" id="proof7151">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">inv</span> <span class="id">STACK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ss</span>. <span class="id">inv</span> <span class="id">FINAL</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">INITSIG</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">INITSIG</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">AFTER</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">INITSIG</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">INITSIG</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> <span class="id">WF</span> <span class="kwd">as</span> <span class="id">WF2</span>. <span class="id">inv</span> <span class="id">WF2</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PCSAME</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="tactic">rewrite</span> <span class="id">RSPPTR</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SG</span>: <span class="id">fn_sig</span> <span class="id">fd</span> = <span class="id">Sk.get_sig</span> <span class="id">skd0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">local_global_consistent</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">GELE</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sg</span> = <span class="id">fn_sig</span> <span class="id">fd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">SG</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. } <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">unfree_free_inj_inj_wf</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Ptrofs.unsigned_zero</span>. <span class="tactic">rewrite</span> <span class="id">Z.add_0_l</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">SG</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">INITRSP</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">INITRSP</span> <span class="kwd">in</span> *. <span class="id">ii</span>. <span class="id">cinv</span> (<span class="id">AGREE</span> <span class="id">RSP</span>); <span class="tactic">rewrite</span> <span class="id">RSRSP</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">RSPSAME</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">RANGE</span>. <span class="id">right</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="tactic">unfold</span> <span class="id">Frame.update_st</span>; <span class="tactic">simpl</span>; <span class="id">cycle</span> 5; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inj_range_wf_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">callee_save_agree</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Mem_unchanged_on_strengthen</span>. <span class="tactic">transitivity</span> <span class="id">retv_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id">Mem_unchanged_on_strengthen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mem_readonly_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mem_free_readonly</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">PWF</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ss</span>. <span class="id">inv</span> <span class="id">FINAL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">INITSIG</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">INITSIG</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">AFTER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">local_global_consistent</span> <span class="kwd">in</span> <span class="id">INITSIG</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">INITSIG</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">match_states_intro</span> <span class="kwd">with</span> (<span class="id">rs_src</span> := <span class="id">retv_rs</span> # <span class="id">PC</span> &lt;- (<span class="id">rs0</span> <span class="id">RA</span>)); <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Pregmap.set</span>. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">inj_same_inj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">RSRA</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des_ifs</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">step_call_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fr0</span> <span class="id">frs</span> <span class="id">args</span> <span class="id">st_tgt</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AT</span>: <span class="id">fr0</span>.(<span class="id">Frame.ms</span>).(<span class="id">ModSem.at_external</span>) <span class="id">fr0</span>.(<span class="id">Frame.st</span>) <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">State</span> (<span class="id">fr0</span> :: <span class="id">frs</span>)) <span class="id">st_tgt</span> <span class="id">n</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> (<span class="id">fr0</span> :: <span class="id">frs</span>)) <span class="id">st_tgt</span> 1%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7152')">Proof.</div>
<div class="proofscript" id="proof7152">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">AT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econstructor</span> 2 <span class="kwd">with</span> (<span class="id">P</span> := (<span class="id">P</span> \2/ <span class="id">brange</span> <span class="id">blk1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + 4 * <span class="id">size_arguments</span> <span class="id">sg</span>))); <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">blk</span> <span class="id">ofs0</span>. <span class="id">i</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">blk1</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">blk</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p0</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span> 2; <span class="tactic">eauto</span>; <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">ALIGN0</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">Nonempty</span>). <span class="id">instantiate</span> (1:=<span class="id">Max</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span> <span class="kwd">in</span> <span class="id">PR</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span> <span class="kwd">in</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">FREE</span>. <span class="id">instantiate</span> (1:=<span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">eapply</span> <span class="id">PR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">INJ</span>; <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id">mi_representable</span>; <span class="tactic">eauto</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span> <span class="kwd">in</span> <span class="id">FREE</span>. <span class="id">exploit</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id">mi_representable</span>; <span class="tactic">eauto</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span> <span class="kwd">in</span> <span class="id">FREE</span>. <span class="id">exploit</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id">VOLATILE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs0</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">IN</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">specialize</span> (<span class="id">AGREE</span> (<span class="id">IR</span> <span class="id">Asm.RSP</span>)). <span class="tactic">rewrite</span> <span class="id">RSP</span> <span class="kwd">in</span> <span class="id">AGREE</span>. <span class="id">inv</span> <span class="id">AGREE</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">blk</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p0</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span> 2; <span class="tactic">eauto</span>; <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">ALIGN0</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="id">des</span>; <span class="tactic">eauto</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="id">des</span>; <span class="tactic">eauto</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">VOLATILE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IN</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span> 1; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">blk</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="id">clarify</span>. <span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">free_freed_from</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span> 3; <span class="tactic">eauto</span>. <span class="id">econs</span> 3; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">below_block_is_volatile</span> <span class="id">F</span> <span class="id">V</span> (<span class="id">ge</span>': <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>) <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LE</span>: ~ <span class="id">Plt</span> <span class="id">b</span> (<span class="id">Genv.genv_next</span> <span class="id">ge</span>')):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.block_is_volatile</span> <span class="id">ge</span>' <span class="id">b</span> = <span class="id">false</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7153')">Proof.</div>
<div class="proofscript" id="proof7153">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.block_is_volatile</span> <span class="id">ge</span>' <span class="id">b</span>) <span class="id">eqn</span>: <span class="id">EQ</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">step_init_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">args</span> <span class="id">frs</span> <span class="id">st_tgt</span> <span class="id">p</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) <span class="id">st_tgt</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OWNER</span>: <span class="id">valid_owner</span> <span class="id">args</span>.(<span class="id">Args.get_fptr</span>) <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PROGIN</span>: <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st_src</span>, <span class="id">step</span> <span class="id">ge</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) <span class="id">E0</span> <span class="id">st_src</span> /\ <span class="id">match_states</span> <span class="id">st_src</span> <span class="id">st_tgt</span> 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7154')">Proof.</div>
<div class="proofscript" id="proof7154">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">asm_step_init_simulation</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">OWNER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">at_external_external</span> <span class="id">p</span> <span class="id">st</span> <span class="id">frs</span> <span class="id">st_tgt</span> <span class="id">n</span> <span class="id">args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">State</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">Frame.mk</span> (<span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>) <span class="id">st</span>)::<span class="id">frs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_tgt</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ATEXTERNAL</span>: <span class="id">at_external</span> <span class="id">skenv_link</span> <span class="id">p</span> <span class="id">st</span> <span class="id">args</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(1 &lt; <span class="id">n</span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7155')">Proof.</div>
<div class="proofscript" id="proof7155">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">at_external</span> <span class="id">skenv_link</span> <span class="id">p</span>) <span class="kwd">with</span> (<span class="id">at_external</span> <span class="id">skenv_link</span> <span class="id">p0</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">ATEXTERNAL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">asm_frame_inj</span> <span class="kwd">in</span> <span class="id">FRAME</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">external_state</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">local_genv</span>, <span class="id">fundef</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">asm_frame_inj</span> <span class="kwd">in</span> <span class="id">FRAME</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">external_state</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">local_genv</span>, <span class="id">fundef</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="tactic">f_equal</span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">Frame.ms</span>) <span class="kwd">in</span> <span class="id">FRAME</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FRAME</span>. <span class="tactic">apply</span> <span class="id">Eqdep.EqdepTheory.inj_pair2</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">normal_state_fsim_step</span> <span class="id">frs</span> <span class="id">st_src1</span> <span class="id">st_tgt0</span> <span class="id">t</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">State</span> <span class="id">frs</span>) <span class="id">st_tgt0</span> <span class="id">n0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP</span>: <span class="id">step</span> <span class="id">ge</span> (<span class="id">State</span> <span class="id">frs</span>) <span class="id">t</span> <span class="id">st_src1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">st_tgt1</span> <span class="id">n1</span>, <span class="id">Asm.step</span> <span class="id">skenv_link</span> <span class="id">tge</span> <span class="id">st_tgt0</span> <span class="id">t</span> <span class="id">st_tgt1</span> /\ <span class="id">match_states</span> <span class="id">st_src1</span> <span class="id">st_tgt1</span> <span class="id">n1</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n1</span>, <span class="id">match_states</span> <span class="id">st_src1</span> <span class="id">st_tgt0</span> <span class="id">n1</span> /\ <span class="id">n1</span> &lt; <span class="id">n0</span>)%<span class="id">nat</span> /\ (<span class="id">t</span> = <span class="id">E0</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7156')">Proof.</div>
<div class="proofscript" id="proof7156">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">exploit</span> <span class="id">step_call_simulation</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">at_external_external</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">try</span> <span class="id">eassumption</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="id">exploit</span> <span class="id">step_internal_simulation</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">exploit</span> <span class="id">step_return_simulation</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">owner_asm_or_system</span> <span class="id">fptr</span> <span class="id">ms</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OWNER</span>: <span class="id">Ge.find_fptr_owner</span> <span class="id">ge</span> <span class="id">fptr</span> <span class="id">ms</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">ASMMOD</span>: <span class="id">exists</span> <span class="id">p</span>, <span class="id">ms</span> = <span class="id">AsmC.modsem</span> <span class="id">skenv_link</span> <span class="id">p</span> /\ <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>&gt;&gt;)\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SYSMOD</span>: <span class="id">ms</span> = <span class="id">System.modsem</span> <span class="id">skenv_link</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7157')">Proof.</div>
<div class="proofscript" id="proof7157">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">OWNER</span>. <span class="tactic">clear</span> - <span class="id">MODSEM</span>. <span class="tactic">unfold</span> <span class="id">ge</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">load_genv</span>, <span class="id">load_modsems</span>, <span class="id">prog</span>, <span class="id">flip</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">des</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">generalize</span> <span class="id">progs</span> <span class="id">ms</span> <span class="id">MODSEM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="id">ss</span>; <span class="id">i</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">in_map_iff</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">in_map_iff</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">right</span>. <span class="tactic">apply</span> <span class="id">in_map_iff</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_fptr_owner_determ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fptr</span> <span class="id">ms0</span> <span class="id">ms1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND0</span>: <span class="id">Ge.find_fptr_owner</span> <span class="id">ge</span> <span class="id">fptr</span> <span class="id">ms0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND1</span>: <span class="id">Ge.find_fptr_owner</span> <span class="id">ge</span> <span class="id">fptr</span> <span class="id">ms1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ms0</span> = <span class="id">ms1</span><br/>
&nbsp;&nbsp;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7158')">Proof.</div>
<div class="proofscript" id="proof7158">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">SemProps.find_fptr_owner_determ</span>; <span class="id">et</span>; <span class="id">ss</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">LINK_SK</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">init_case</span> <span class="id">st</span> <span class="id">args</span> <span class="id">frs</span> <span class="id">fptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STATE</span>: <span class="id">st</span> = <span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FPTR</span>: <span class="id">fptr</span> = <span class="id">args</span>.(<span class="id">Args.get_fptr</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">ASMMOD</span>: <span class="id">exists</span> <span class="id">p</span>, <span class="id">valid_owner</span> <span class="id">fptr</span> <span class="id">p</span>&gt;&gt;) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SYSMOD</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fptr</span> (<span class="id">System.modsem</span> <span class="id">skenv_link</span>)&gt;&gt;) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">UNSAFE</span>: ~ <span class="id">safe</span> (<span class="id">sem</span> <span class="id">prog</span>) <span class="id">st</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7159')">Proof.</div>
<div class="proofscript" id="proof7159">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">exists</span> <span class="id">p</span>, <span class="id">Ge.find_fptr_owner</span> <span class="id">ge</span> <span class="id">args</span>.(<span class="id">Args.get_fptr</span>) (<span class="id">modsem</span> <span class="id">skenv_link</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">In</span> (<span class="id">AsmC.module</span> <span class="id">p</span>) <span class="id">prog</span>)) <span class="kwd">as</span> [[<span class="id">p</span> <span class="id">OWNER</span>] | <span class="id">NOOWNER</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">des</span>. <span class="id">simpl_depind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">valid_owner</span> <span class="id">args</span>.(<span class="id">Args.get_fptr</span>) <span class="id">p</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>. <span class="tactic">intros</span> <span class="id">SAFE</span>. <span class="id">exploit</span> <span class="id">SAFE</span>; [<span class="id">econs</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">MSFIND</span> <span class="id">st_init</span> <span class="id">INIT</span>. <span class="tactic">intros</span> <span class="id">MSFIND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">find_fptr_owner_determ</span> <span class="id">OWNER</span> <span class="id">MSFIND</span>) <span class="kwd">in</span> *. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INIT</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SkEnv.revive_incl_skenv</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">FINDF</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ININCL</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">ss</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">Ge.find_fptr_owner</span> <span class="id">ge</span> <span class="id">fptr</span> (<span class="id">System.modsem</span> <span class="id">skenv_link</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="id">left</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>. <span class="tactic">intros</span> <span class="id">SAFE</span>. <span class="id">clarify</span>. <span class="id">exploit</span> <span class="id">SAFE</span>; [<span class="id">econs</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">owner_asm_or_system</span> <span class="id">MSFIND</span>); <span class="id">des</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">NOOWNER</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">call_step_noevent</span> <span class="id">ge</span>' <span class="id">args</span> <span class="id">frs</span> <span class="id">st1</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP</span>: <span class="id">step</span> <span class="id">ge</span>' (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) <span class="id">tr</span> <span class="id">st1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E0</span> = <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7160')">Proof.</div>
<div class="proofscript" id="proof7160">
 <span class="id">inv</span> <span class="id">STEP</span>. <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">syscall_receptive</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_src0</span> <span class="id">st_src1</span> <span class="id">st_tgt0</span> <span class="id">args</span> <span class="id">frs</span> <span class="id">fptr</span> <span class="id">tr0</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STATE</span>: <span class="id">st_src0</span> = <span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FPTR</span>: <span class="id">fptr</span> = <span class="id">args</span>.(<span class="id">Args.get_fptr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYSMOD</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fptr</span> (<span class="id">System.modsem</span> <span class="id">skenv_link</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> <span class="id">st_src0</span> <span class="id">st_tgt0</span> <span class="id">n0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP0</span>: <span class="id">Sem.step</span> <span class="id">ge</span> <span class="id">st_src0</span> <span class="id">tr0</span> <span class="id">st_src1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">receptive_at</span> (<span class="id">sem</span> <span class="id">prog</span>) <span class="id">st_src1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7161')">Proof.</div>
<div class="proofscript" id="proof7161">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>. <span class="id">inv</span> <span class="id">STEP0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">system_receptive_at</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">syscall_simulation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_src0</span> <span class="id">st_src1</span> <span class="id">st_src2</span> <span class="id">st_tgt0</span> <span class="id">args</span> <span class="id">frs</span> <span class="id">fptr</span> <span class="id">tr0</span> <span class="id">tr1</span> <span class="id">n0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STATE</span>: <span class="id">st_src0</span> = <span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FPTR</span>: <span class="id">fptr</span> = <span class="id">args</span>.(<span class="id">Args.get_fptr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYSMOD</span>: <span class="id">ge</span>.(<span class="id">Ge.find_fptr_owner</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fptr</span> (<span class="id">System.modsem</span> <span class="id">skenv_link</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> <span class="id">st_src0</span> <span class="id">st_tgt0</span> <span class="id">n0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP0</span>: <span class="id">Sem.step</span> <span class="id">ge</span> <span class="id">st_src0</span> <span class="id">tr0</span> <span class="id">st_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP1</span>: <span class="id">Sem.step</span> <span class="id">ge</span> <span class="id">st_src1</span> <span class="id">tr1</span> <span class="id">st_src2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">receptive_at</span> (<span class="id">sem</span> <span class="id">prog</span>) <span class="id">st_src2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st_tgt1</span> <span class="id">n1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt; <span class="id">STEPTGT</span>: <span class="id">Asm.step</span> <span class="id">skenv_link</span> <span class="id">tge</span> <span class="id">st_tgt0</span> <span class="id">tr1</span> <span class="id">st_tgt1</span> &gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt; <span class="id">MTCHST</span>: <span class="kwd">forall</span> <span class="id">st_src3</span> <span class="id">tr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP2</span>: <span class="id">Sem.step</span> <span class="id">ge</span> <span class="id">st_src2</span> <span class="id">tr2</span> <span class="id">st_src3</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> <span class="id">st_src3</span> <span class="id">st_tgt1</span> <span class="id">n1</span> /\ <span class="id">tr2</span> = <span class="id">E0</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> &lt; <span class="id">length</span> <span class="id">frs</span> + 3)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7162')">Proof.</div>
<div class="proofscript" id="proof7162">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clarify</span>; <span class="id">inv</span> <span class="id">MTCHST</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="id">inv</span> <span class="id">STEP0</span>. <span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">inv</span> <span class="id">INIT</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STEP0</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>). <span class="id">ss</span>. <span class="id">inv</span> <span class="id">INIT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STEP1</span>; <span class="id">ss</span>; [|<span class="id">inv</span> <span class="id">FINAL</span>]. <span class="id">inv</span> <span class="id">STEP</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">extcall_arguments_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ec_mem_inject_weak</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">external_call_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">system_symbols_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">skenv_inject_max_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Frame.update_st</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">system_receptive_at</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">Asm.State</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">set_pair</span> (<span class="id">loc_external_result</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)) <span class="id">vres</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">regset_after_external</span> <span class="id">rs_tgt</span>)) #<span class="id">PC</span> &lt;- (<span class="id">rs_tgt</span> <span class="id">RA</span>)) <span class="id">m2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STACK</span>; <span class="id">cycle</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">System.globalenv</span>, <span class="id">initial_regset</span>, <span class="id">Pregmap.set</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SIGEQ</span>: <span class="id">sg</span> = <span class="id">ef_sig</span> <span class="id">ef</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Sk.get_csig</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="tactic">unfold</span> <span class="id">System.globalenv</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">if</span> <span class="id">external_state</span> (<span class="id">local_genv</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">set_pair</span> (<span class="id">loc_external_result</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)) <span class="id">vres</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">regset_after_external</span> <span class="id">st</span>.(<span class="id">st_rs</span>))) # <span class="id">PC</span> &lt;- (<span class="id">st</span>.(<span class="id">st_rs</span>) <span class="id">RA</span>) <span class="id">PC</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id">length</span> <span class="id">frs0</span> + 2)%<span class="id">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> 0%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">splits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">st_rs</span> <span class="id">st</span> <span class="id">PC</span>) <span class="id">eqn</span>:<span class="id">EQ</span>; <span class="id">ss</span>; <span class="id">des_ifs</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> (<span class="id">AGREE</span> <span class="id">PC</span>); <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1 := <span class="id">b2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">delta</span> = 0); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">system_function_ofs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1 := <span class="id">ef</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">system_sig</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1 := <span class="id">args2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">inv</span> <span class="id">STEP2</span>; [<span class="id">inv</span> <span class="id">AT</span>|<span class="id">inv</span> <span class="id">STEP</span>|]. <span class="id">inv</span> <span class="id">FINAL</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">Frame.update_st</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">AFTER</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">AGREE</span> <span class="id">RSP</span>). <span class="tactic">rewrite</span> <span class="id">RSPPTR</span> <span class="kwd">in</span> *. <span class="id">clarify</span>. <span class="id">inv</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">private_unfree_inj_inj_wf</span>; [<span class="tactic">eauto</span>|<span class="tactic">eauto</span>|..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (2:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">Ptrofs.unsigned</span> <span class="id">ofs0</span>+4 * <span class="id">size_arguments</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">exploit</span> <span class="id">Mem.unchanged_on_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_out_of_reach</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">ofs</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">PERM</span>. <span class="tactic">eapply</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1:=<span class="id">ofs</span>-<span class="id">delta</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">replace</span> <span class="id">ofs</span> <span class="kwd">with</span> (<span class="id">ofs</span> - <span class="id">delta</span> + <span class="id">delta</span>); [<span class="tactic">auto</span>|<span class="tactic">omega</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">delta</span>' <span class="id">BOUND</span>. <span class="tactic">eapply</span> <span class="id">separated_out_of_reach</span>; <span class="id">cycle</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_out_of_reach</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">range</span> <span class="kwd">in</span> *. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">ec_max_perm</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">external_call_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_inject</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rpapply</span> <span class="id">UNFREE</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">GEINJECT</span>. <span class="id">econs</span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b1</span>) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">DELTA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">dup</span> <span class="id">DELTA</span>. <span class="tactic">apply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">DELTA</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IMAGE</span>; [<span class="tactic">eauto</span>| |<span class="tactic">auto</span>]. <span class="id">des</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm_greater</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_max_perm</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FREE</span>. <span class="tactic">rewrite</span> <span class="id">freed_from_nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Senv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DOMAIN</span> <span class="kwd">in</span> <span class="id">PERM</span>. <span class="tactic">clear</span> - <span class="id">PERM</span> <span class="id">DELTA</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">Senv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b0</span>) <span class="id">eqn</span>:<span class="id">VEQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Senv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">VEQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H5</span>; <span class="tactic">try</span> <span class="id">eassumption</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DOMAIN</span> <span class="kwd">in</span> <span class="id">VEQ0</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Senv.block_is_volatile</span> <span class="id">skenv_link</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">VEQ1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Senv.block_is_volatile_below</span> <span class="kwd">in</span> <span class="id">VEQ1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DOMAIN</span> <span class="kwd">in</span> <span class="id">VEQ1</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">inj_range_wf_step</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">WFINJ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">Mem.valid_block</span> <span class="id">m</span> <span class="id">blk</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">external_call_max_perm</span> <span class="kwd">in</span> <span class="id">EXTCALL</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">freed_from_nextblock</span>. <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">RANGE</span>. <span class="id">right</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">range</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">cycle</span> 4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">instantiate</span> (1:=<span class="id">P</span>). <span class="tactic">eapply</span> <span class="id">match_stack_incr</span>; [| |<span class="tactic">eauto</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">set_pair</span>. <span class="id">des_ifs</span>; <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id">agree_step</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">unfold</span> <span class="id">regset_after_external</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> []; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">unfold</span> <span class="id">regset_after_external</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> []; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">Val.hiword_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">Val.loword_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Mem_unchanged_on_strengthen</span>. <span class="tactic">transitivity</span> <span class="id">retv_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">Mem_unchanged_on_strengthen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mem_readonly_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mem_readonly_trans</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_unchanged</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H6</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">freed_from_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">external_call_readonly</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">PWF</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">RANGE</span>. <span class="id">right</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_states_call_ord_1</span> <span class="id">args</span> <span class="id">frs</span> <span class="id">st_tgt</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">args</span> <span class="id">frs</span>) <span class="id">st_tgt</span> <span class="id">n</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1%<span class="id">nat</span> = <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7163')">Proof.</div>
<div class="proofscript" id="proof7163">
 <span class="id">inv</span> <span class="id">MTCHST</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">src_receptive_at</span> <span class="id">st_src</span> <span class="id">st_tgt</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MTCHST</span>: <span class="id">match_states</span> <span class="id">st_src</span> <span class="id">st_tgt</span> <span class="id">n</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">receptive_at</span> (<span class="id">sem</span> <span class="id">prog</span>) <span class="id">st_src</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7164')">Proof.</div>
<div class="proofscript" id="proof7164">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MTCHST</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">SemProps.lift_receptive_at</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ss</span>. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">modsem_receptive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">set</span> (<span class="id">STEP</span> := <span class="id">H</span>). <span class="id">inv</span> <span class="id">STEP</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">eexists</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">ss</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">set</span> (<span class="id">STEP</span> := <span class="id">H</span>). <span class="id">inv</span> <span class="id">STEP</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">eexists</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">ss</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">match_state_xsim</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st_src</span> <span class="id">st_tgt</span> <span class="id">n</span> (<span class="id">MTCHST</span>: <span class="id">match_states</span> <span class="id">st_src</span> <span class="id">st_tgt</span> <span class="id">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xsim</span> (<span class="id">sem</span> <span class="id">prog</span>) (<span class="id">semantics</span> <span class="id">tprog</span>) <span class="id">lt</span> <span class="id">n</span> <span class="id">st_src</span> <span class="id">st_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7165')">Proof.</div>
<div class="proofscript" id="proof7165">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pcofix</span> <span class="id">CIH</span>. <span class="id">i</span>. <span class="id">pfold</span>. <span class="tactic">destruct</span> <span class="id">st_src</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">init_case</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">frs</span>). <span class="id">instantiate</span> (2:=<span class="id">args</span>). <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">match_states_call_ord_1</span> <span class="id">MTCHST</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">econs</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">MTCHST</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">FINALTGT</span>. <span class="id">inv</span> <span class="id">ASMMOD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MSFIND</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_funct</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">PC</span>). <span class="id">inv</span> <span class="id">AGREE</span>; <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Vnullptr</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">FINALTGT</span>. <span class="id">inv</span> <span class="id">ASMMOD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MSFIND</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_funct</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">AGREE</span> <span class="id">PC</span>). <span class="id">inv</span> <span class="id">AGREE</span>; <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Vnullptr</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">step_init_simulation</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">ASMMOD</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="id">econs</span> 2; <span class="id">ss</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">star_one</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">right</span>. <span class="id">econs</span>. <span class="id">econs</span> 1; <span class="id">et</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">FINALSRC</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">call_step_noevent</span> <span class="id">STEPSRC</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">match_states_call_ord_1</span> <span class="id">MTCHST</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> 0%<span class="id">nat</span>. <span class="id">exists</span> <span class="id">st_tgt</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">pfold</span>. <span class="id">left</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>. <span class="id">econs</span>; <span class="id">et</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">STEPSRC</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INIT</span>. <span class="id">inv</span> <span class="id">FINALSRC</span>. <span class="id">inv</span> <span class="id">FINAL</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">exists</span> (<span class="id">length</span> <span class="id">frs</span> + 3)%<span class="id">nat</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">syscall_simulation</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="id">exists</span> <span class="id">st_tgt1</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">left</span>. <span class="tactic">split</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">STEPSRC</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>). <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">system_receptive_at</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">plus_one</span>. <span class="id">econs</span>; [<span class="tactic">apply</span> <span class="id">asm_determinate_at</span>|]. <span class="id">s</span>. <span class="id">folder</span>. <span class="tactic">rewrite</span> <span class="id">senv_same</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">pfold</span>. <span class="id">left</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>. <span class="id">econs</span>; <span class="id">et</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">STEPSRC</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_fptr_owner_determ</span> <span class="id">SYSMOD</span> <span class="id">MSFIND</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INIT</span>. <span class="id">inv</span> <span class="id">STEPSRC0</span>; <span class="id">ss</span>; [|<span class="id">inv</span> <span class="id">FINAL</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STEP</span>. <span class="id">inv</span> <span class="id">FINALSRC</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MTCHST</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STACK</span>. <span class="id">inv</span> <span class="id">SYSMOD</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">System.globalenv</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">initial_regset</span>, <span class="id">Pregmap.set</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">MTCHST0</span> <span class="kwd">in</span> <span class="id">STEPSRC1</span>. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n1</span>, <span class="id">st_tgt1</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">econs</span>; <span class="id">i</span>; <span class="tactic">try</span> (<span class="id">exfalso</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="id">right</span>. <span class="id">econs</span>. <span class="id">econs</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">transf_final_states</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="id">inv</span> <span class="id">FINAL0</span>. <span class="id">inv</span> <span class="id">FINAL1</span>. <span class="id">eq_closure_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="id">inv</span> <span class="id">FINAL</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">eq_closure_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ * <span class="id">i</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">LINK_SK</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">normal_state_fsim_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>; <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">left</span>. <span class="tactic">split</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">src_receptive_at</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">asm_determinate_at</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span>. <span class="id">folder</span>. <span class="tactic">rewrite</span> <span class="id">senv_same</span>. <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">econs</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">rewrite</span> <span class="id">E0_right</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">transf_xsim_properties</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xsim_properties</span> (<span class="id">sem</span> <span class="id">prog</span>) (<span class="id">semantics</span> <span class="id">tprog</span>) <span class="id">nat</span> <span class="id">lt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7166')">Proof.</div>
<div class="proofscript" id="proof7166">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; [<span class="tactic">apply</span> <span class="id">lt_wf</span>| |<span class="id">i</span>; <span class="tactic">apply</span> <span class="id">symb_preserved</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">transf_initial_states</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">inv</span> <span class="id">INIT0</span>. <span class="id">inv</span> <span class="id">INIT1</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">match_state_xsim</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">transf_program_correct</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mixed_simulation</span> (<span class="id">Sem.sem</span> <span class="id">prog</span>) (<span class="id">Asm.semantics</span> <span class="id">tprog</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7167')">Proof.</div>
<div class="proofscript" id="proof7167">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mixed_simulation</span>. <span class="tactic">eapply</span> <span class="id">transf_xsim_properties</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">PRESERVATION</span>.<br/>
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BehaviorsC</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">lower_bound_correct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">asms</span>: <span class="id">list</span> <span class="id">Asm.program</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INITUB</span>: <span class="id">program_behaves</span> (<span class="id">sem</span> (<span class="id">map</span> <span class="id">AsmC.module</span> <span class="id">asms</span>)) (<span class="id">Goes_wrong</span> <span class="id">E0</span>)&gt;&gt;) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">link_tgt</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">TGT</span>: <span class="id">link_list</span> <span class="id">asms</span> = <span class="id">Some</span> <span class="id">link_tgt</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">REFINE</span>: <span class="id">improves</span> (<span class="id">sem</span> (<span class="id">map</span> <span class="id">AsmC.module</span> <span class="id">asms</span>)) (<span class="id">Asm.semantics</span> <span class="id">link_tgt</span>)&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7168')">Proof.</div>
<div class="proofscript" id="proof7168">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">link_sk</span> (<span class="id">map</span> <span class="id">module</span> <span class="id">asms</span>)) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">left</span>. <span class="id">econs</span> 2. <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Sk.load_mem</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">T2</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">left</span>. <span class="id">econs</span> 2. <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="kwd">forall</span> <span class="id">md</span>, <span class="id">In</span> <span class="id">md</span> (<span class="id">map</span> <span class="id">module</span> <span class="id">asms</span>) -&gt; &lt;&lt;<span class="id">WF</span>: <span class="id">Sk.wf</span> <span class="id">md</span> &gt;&gt;)); <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">left</span>. <span class="id">econs</span> 2. <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exploit</span> <span class="id">link_success</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bsim_improves</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mixed_to_backward_simulation</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">transf_program_correct</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
