
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module LowerBoundExtra</title>
<meta name="description" content="Documentation of Coq module LowerBoundExtra" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module LowerBoundExtra</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CoqlibC</span> <span class="id">Maps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ASTC</span> <span class="id">Integers</span> <span class="id">Floats</span> <span class="id">Values</span> <span class="id">MemoryC</span> <span class="id">Events</span> <span class="id">Globalenvs</span> <span class="id">Smallstep</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Locations</span> <span class="id">Stacklayout</span> <span class="id">Conventions</span> <span class="id">Linking</span>.<br/>
<div class="doc">newly added *</div>
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id">Asm</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Simulation</span> <span class="id">Memory</span> <span class="id">ValuesC</span> <span class="id">GlobalenvsC</span> .<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Skeleton</span> <span class="id">ModSem</span> <span class="id">Mod</span> <span class="id">sflib</span> <span class="id">AsmC</span> <span class="id">Sem</span> <span class="kwd">Syntax</span> <span class="id">LinkingC</span> <span class="kwd">Program</span> <span class="id">SemProps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lia</span> <span class="id">LinkingC2</span> <span class="id">Conventions1C</span> <span class="id">JunkBlock</span> <span class="id">StoreArguments</span> <span class="id">StoreArgumentsProps</span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Z.mul</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Notation</span> "<span class="id">a</span> # <span class="id">b</span>" := (<span class="id">PMap.get</span> <span class="id">b</span> <span class="id">a</span>) (<span class="tactic">at</span> <span class="id">level</span> 1).<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">simp</span> := <span class="tactic">repeat</span> (<span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">ss</span>; <span class="id">clarify</span>).<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Classes.RelationClasses</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">inj_same</span> (<span class="id">j</span>: <span class="id">meminj</span>) <span class="id">v0</span> <span class="id">v1</span> : <span class="kwd">Prop</span> :=<br/>
| <span class="id">inj_same_ptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk0</span> <span class="id">blk1</span> <span class="id">blk</span> <span class="id">delta0</span> <span class="id">delta1</span> <span class="id">ofs0</span> <span class="id">ofs1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL0</span>: <span class="id">v0</span> = <span class="id">Vptr</span> <span class="id">blk0</span> <span class="id">ofs0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL1</span>: <span class="id">v1</span> = <span class="id">Vptr</span> <span class="id">blk1</span> <span class="id">ofs1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ0</span>: <span class="id">j</span> <span class="id">blk0</span> = <span class="id">Some</span> (<span class="id">blk</span>, <span class="id">delta0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ1</span>: <span class="id">j</span> <span class="id">blk1</span> = <span class="id">Some</span> (<span class="id">blk</span>, <span class="id">delta1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">Ptrofs.unsigned</span> <span class="id">ofs0</span> + <span class="id">delta0</span> = <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">delta1</span>)<br/>
| <span class="id">inj_same_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span>: <span class="id">v0</span> = <span class="id">v1</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">inj_same</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">inj_same_equivalence</span> <span class="id">j</span>: <span class="id">Equivalence</span> (<span class="id">inj_same</span> <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7266')">Next Obligation.</div>
<div class="proofscript" id="proof7266">
 <span class="id">ii</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof7267')">Next Obligation.</div>
<div class="proofscript" id="proof7267">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">VAL0</span>. <span class="tactic">rewrite</span> <span class="id">INJ1</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">INJ2</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_same_inj</span> <span class="id">j</span> <span class="id">v0</span> <span class="id">v1</span> <span class="id">v_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SAME</span>: <span class="id">inj_same</span> <span class="id">j</span> <span class="id">v0</span> <span class="id">v1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">v1</span> <span class="id">v_tgt</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.inject</span> <span class="id">j</span> <span class="id">v0</span> <span class="id">v_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7268')">Proof.</div>
<div class="proofscript" id="proof7268">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SAME</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">INJ</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">INJ1</span>.<br/>
&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- (<span class="id">Ptrofs.repr_unsigned</span> <span class="id">ofs1</span>).<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- (<span class="id">Ptrofs.repr_unsigned</span> <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">IntegersC.Ptrofs_add_repr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_same_incr</span> <span class="id">j0</span> <span class="id">j1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j0</span> <span class="id">j1</span>):<br/>
&nbsp;&nbsp;<span class="id">inj_same</span> <span class="id">j0</span> &lt;2= <span class="id">inj_same</span> <span class="id">j1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7269')">Proof.</div>
<div class="proofscript" id="proof7269">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">PR</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">separated_out_of_reach</span> <span class="id">j0</span> <span class="id">j1</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt0</span> <span class="id">blk</span> <span class="id">delta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j0</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">j0</span> <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEPARATED</span>: <span class="id">inject_separated</span> <span class="id">j0</span> <span class="id">j1</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BOUND</span>: <span class="id">Plt</span> <span class="id">blk</span> <span class="id">m_tgt0</span>.(<span class="id">Mem.nextblock</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OUTOFREACH</span>: <span class="id">loc_out_of_reach</span> <span class="id">j0</span> <span class="id">m_src0</span> <span class="id">blk</span> <span class="id">delta</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXPERM</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALED</span>: <span class="id">Mem.valid_block</span> <span class="id">m_src0</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">m_src1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m_src0</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span>):<br/>
&nbsp;&nbsp;<span class="id">loc_out_of_reach</span> <span class="id">j1</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">delta</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7270')">Proof.</div>
<div class="proofscript" id="proof7270">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">inject_separated</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">j0</span> <span class="id">b0</span>) <span class="id">eqn</span>:<span class="id">EQ</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">specialize</span> (<span class="id">INCR</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span>). <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">OUTOFREACH</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">MAXPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NNPP</span>. <span class="tactic">intro</span> <span class="id">N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.mi_freeblocks</span> <span class="kwd">in</span> <span class="id">N</span>; <span class="tactic">eauto</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">SEPARATED</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span> <span class="id">H</span>). <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SEPARATED0</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Record</span> <span class="id">freed_from</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">mk_freed_from</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">freed_from_unchanged</span>: <span class="id">Mem.unchanged_on</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blk</span>' <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">eq_block</span> <span class="id">blk</span>' <span class="id">blk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> ~ (<span class="id">lo</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">True</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m0</span> <span class="id">m1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from_nextblock</span>: <span class="id">m1</span>.(<span class="id">Mem.nextblock</span>) = <span class="id">m0</span>.(<span class="id">Mem.nextblock</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from_perm</span>: <span class="id">Mem.range_perm</span> <span class="id">m0</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">Cur</span> <span class="id">Freeable</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from_noperm</span>: <span class="id">Mem_range_noperm</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from_contents</span>: <span class="kwd">forall</span> <span class="id">ofs</span> (<span class="id">IN</span>: <span class="id">lo</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ZMap.get</span> <span class="id">ofs</span> (<span class="id">Mem.mem_contents</span> <span class="id">m0</span>) !! <span class="id">blk</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ZMap.get</span> <span class="id">ofs</span> (<span class="id">Mem.mem_contents</span> <span class="id">m1</span>) !! <span class="id">blk</span>; }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">freed_from_perm_le</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">blk</span>' <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREED</span>: <span class="id">freed_from</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">m_src1</span> <span class="id">blk</span>' <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m_src0</span> <span class="id">blk</span>' <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7271')">Proof.</div>
<div class="proofscript" id="proof7271">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">blk</span>' <span class="id">blk</span>).<br/>
&nbsp;&nbsp;- <span class="id">clarify</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">lo</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> (<span class="id">Mem.unchanged_on_perm</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id">freed_from_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> (<span class="id">Mem.unchanged_on_perm</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">PERM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id">freed_from_nextblock</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">freed_from_inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREED</span>: <span class="id">freed_from</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">m_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7272')">Proof.</div>
<div class="proofscript" id="proof7272">
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.extends_inject_compose</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">freed_from_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">i</span>; <span class="tactic">unfold</span> <span class="id">inject_id</span> <span class="kwd">in</span> *; <span class="id">clarify</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Z.add_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_perm_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Z.divide_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b2</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clarify</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">lo</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">erewrite</span> &lt;- <span class="id">freed_from_contents</span>; <span class="tactic">eauto</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">erewrite</span> (<span class="id">Mem.unchanged_on_contents</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> (<span class="id">Mem.unchanged_on_contents</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">i</span>. <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clarify</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">lo</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="tactic">eapply</span> (<span class="id">Mem.unchanged_on_perm</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">eapply</span> (<span class="id">Mem.unchanged_on_perm</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">freed_from_unchanged</span> <span class="id">FREED</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">freed_from_out_of_reach</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">blk</span>' <span class="id">delta</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREED</span>: <span class="id">freed_from</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk</span> = <span class="id">Some</span> (<span class="id">blk</span>', <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IN</span>: <span class="id">lo</span> + <span class="id">delta</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">hi</span> + <span class="id">delta</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc_out_of_reach</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">blk</span>' <span class="id">ofs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7273')">Proof.</div>
<div class="proofscript" id="proof7273">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b0</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;- <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">freed_from_noperm</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">Mem.inject_no_overlap</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">freed_from_perm_le</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freed_from_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ofs</span> - <span class="id">delta</span>). <span class="tactic">omega</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">des</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">freed_from_perm_greater</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">freed_from</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m1</span> &lt;4= <span class="id">Mem.perm</span> <span class="id">m0</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7274')">Proof.</div>
<div class="proofscript" id="proof7274">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">FREE</span>. <span class="id">inv</span> <span class="id">freed_from_unchanged0</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">unchanged_on_perm</span> <span class="id">x0</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">x3</span>).<br/>
&nbsp;&nbsp;<span class="id">des_ifs</span>; [<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">lo</span> <span class="id">x1</span>); <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">x1</span> <span class="id">hi</span>)|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exploit</span> <span class="id">freed_from_perm0</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>; <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>; <span class="id">econs</span> | ..];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">lia</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">PR</span>; <span class="id">ii</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">freed_from_nextblock0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">free_freed_from</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">Mem.free</span> <span class="id">m0</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7275')">Proof.</div>
<div class="proofscript" id="proof7275">
&nbsp;&nbsp;<span class="id">econs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.free_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.nextblock_free</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_free_noperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">i</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.free</span>. <span class="tactic">unfold</span> <span class="id">Mem.free</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_mem_freed_from</span> <span class="id">m_init</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">freed_from</span> <span class="id">m_init</span> <span class="id">m_init</span> 1%<span class="id">positive</span> 0 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7276')">Proof.</div>
<div class="proofscript" id="proof7276">
&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ii</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">skenv_inject</span> {<span class="id">F</span> <span class="id">V</span>} (<span class="id">ge</span>: <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>) (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">m</span>: <span class="id">mem</span>) : <span class="kwd">Prop</span> :=<br/>
| <span class="id">sken_inject_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DOMAIN</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">Plt</span> <span class="id">b</span> <span class="id">ge</span>.(<span class="id">Genv.genv_next</span>) -&gt; <span class="id">j</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>, 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IMAGE</span>: <span class="kwd">forall</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">delta</span> (<span class="id">INJ</span>: <span class="id">j</span> <span class="id">b1</span> = <span class="id">Some</span>(<span class="id">b2</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">b1</span> = <span class="id">true</span> \/ <span class="id">exists</span> <span class="id">ofs</span>, <span class="id">Mem.perm</span> <span class="id">m</span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">Nonempty</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">b2</span> = <span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">b1</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">skenv_inject_max_perm</span> {<span class="id">F</span> <span class="id">V</span>} (<span class="id">genv</span>: <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>) (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">m0</span> <span class="id">m1</span> <span class="id">m_tgt</span>: <span class="id">mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXPERM</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> (<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">m0</span> <span class="id">b</span>) (<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">genv</span> <span class="id">j</span> <span class="id">m0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skenv_inject</span> <span class="id">genv</span> <span class="id">j</span> <span class="id">m1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7277')">Proof.</div>
<div class="proofscript" id="proof7277">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SYMB</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">symbols_inject_weak</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">splits</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs</span>. <span class="tactic">eapply</span> <span class="id">MAXPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">INJRANGEWF</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">F</span> <span class="id">V</span>: <span class="kwd">Type</span>.<br/>
<span class="kwd">Variable</span> <span class="id">ge</span>: <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">inj_range_block_wf</span> (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">m</span>: <span class="id">mem</span>) <span class="id">blk_src</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span> :=<br/>
| <span class="id">inj_range_wf_empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">REACH</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BOT</span>: <span class="id">P</span> &lt;1= <span class="id">bot1</span>)<br/>
| <span class="id">inj_range_wf_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_tgt</span> <span class="id">delta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ALIGN</span>: <span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, (<span class="id">range</span> <span class="id">ofs</span> (<span class="id">ofs</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>) &lt;1= ((<span class="kwd">fun</span> <span class="id">ofs</span> =&gt; <span class="id">Mem.perm</span> <span class="id">m</span> <span class="id">blk_src</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>) \1/ <span class="id">P</span>)) -&gt; (<span class="id">align_chunk</span> <span class="id">chunk</span> | <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="kwd">forall</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">delta</span> &gt;= 0 /\ 0 &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">delta</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VOLATILE</span>: <span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VOL</span>: <span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">blk_src</span> = <span class="id">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IN</span>: <span class="id">P</span> <span class="id">ofs</span>), <span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">blk_tgt</span> = <span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">blk_src</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">inj_range_wf</span> (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">P</span>: <span class="id">Values.block</span> -&gt; <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">blk</span>, <span class="id">inj_range_block_wf</span> <span class="id">j</span> <span class="id">m</span> <span class="id">blk</span> (<span class="id">P</span> <span class="id">blk</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_range_wf_le</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P0</span> <span class="id">P1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJWF</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PLE</span>: <span class="id">P1</span> &lt;2= <span class="id">P0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m</span> <span class="id">P1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7278')">Proof.</div>
<div class="proofscript" id="proof7278">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">INJWF</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;- <span class="id">econs</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span> 2; <span class="tactic">eauto</span>; <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">ALIGN</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">RANGE</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">private_unfree_symbols_inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk_src</span> <span class="id">blk_tgt</span> <span class="id">delta</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.range_perm</span> <span class="id">m_tgt</span> <span class="id">blk_tgt</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) <span class="id">Cur</span> <span class="id">Freeable</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m_src0</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">range</span> <span class="id">lo</span> <span class="id">hi</span> &lt;1= <span class="id">P</span> <span class="id">blk_src</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src1</span>&gt;&gt;<br/>
.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7279')">Proof.</div>
<div class="proofscript" id="proof7279">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SYMB</span>. <span class="id">econs</span>; <span class="tactic">auto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">b1</span>); <span class="id">clarify</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">brange</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b1</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">Senv.block_is_volatile</span> <span class="id">ge</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">VEQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">VOLATILE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>. <span class="id">right</span>. <span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_perm</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">private_unfree_inj_wf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk_src</span> <span class="id">blk_tgt</span> <span class="id">delta</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.range_perm</span> <span class="id">m_tgt</span> <span class="id">blk_tgt</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) <span class="id">Cur</span> <span class="id">Freeable</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRVT</span>: <span class="id">range</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) &lt;1= <span class="id">loc_out_of_reach</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">blk_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m_src0</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">range</span> <span class="id">lo</span> <span class="id">hi</span> &lt;1= <span class="id">P</span> <span class="id">blk_src</span>):<br/>
&nbsp;&nbsp;&lt;&lt;<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">P</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7280')">Proof.</div>
<div class="proofscript" id="proof7280">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;- <span class="id">econs</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span> 2; <span class="tactic">eauto</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ALIGN</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span> <span class="kwd">in</span> <span class="id">UNFREE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">UNFREE</span>. <span class="id">specialize</span> (<span class="id">unchanged_on_perm</span> <span class="id">blk</span> <span class="id">x0</span> <span class="id">k</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">brange</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">blk</span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">unchanged_on_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">private_unfree_inj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk_src</span> <span class="id">blk_tgt</span> <span class="id">delta</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.range_perm</span> <span class="id">m_tgt</span> <span class="id">blk_tgt</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) <span class="id">Cur</span> <span class="id">Freeable</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRVT</span>: <span class="id">range</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) &lt;1= <span class="id">loc_out_of_reach</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">blk_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m_src0</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">range</span> <span class="id">lo</span> <span class="id">hi</span> &lt;1= <span class="id">P</span> <span class="id">blk_src</span>):<br/>
&nbsp;&nbsp;&lt;&lt;<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">m_tgt</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7281')">Proof.</div>
<div class="proofscript" id="proof7281">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.inject</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem_unfree</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INJ</span>.<br/>
&nbsp;&nbsp;<span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">mi_inj</span>. <span class="id">econs</span>; <span class="id">ii</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">Mem.perm_order</span>' <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ss</span>. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk_src</span> &amp;&amp; <span class="id">zle</span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs</span> <span class="id">hi</span>) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">clarify</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">mi_perm</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span>. <span class="id">bsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(((<span class="id">Mem.mem_access</span> <span class="id">m_src0</span>) # <span class="id">b1</span>) <span class="id">ofs</span> <span class="id">k</span> = <span class="id">Some</span> <span class="id">p1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">des_ifs</span>; <span class="id">simp</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs</span>; <span class="id">simp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span> <span class="kwd">with</span> <span class="id">Freeable</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">PERM</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">b1</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b1</span> <span class="id">blk_src</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">ALIGN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">p0</span>). <span class="id">instantiate</span> (1:=<span class="id">Max</span>). <span class="id">instantiate</span> (1:=<span class="id">ofs</span>). <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.range_perm</span>, <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gss</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">_</span> <span class="id">PR</span>). <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">Mem.range_perm</span> <span class="id">m_src0</span> <span class="id">b1</span> <span class="id">ofs</span> (<span class="id">ofs</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>) <span class="id">Max</span> <span class="id">p0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span>, <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">ofs0</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. } <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mi_align</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span>, <span class="id">Mem.perm</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk_src</span> &amp;&amp; <span class="id">zle</span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs</span> <span class="id">hi</span>) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">clarify</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span>(<span class="id">Mem.perm</span> <span class="id">m_src0</span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">Cur</span> <span class="id">Readable</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">des_ifs</span>; <span class="id">simp</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">mi_memval</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (0 &lt;= <span class="id">hi</span> - <span class="id">lo</span>)); <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span>(<span class="id">NEG</span>: <span class="id">exists</span> <span class="id">n</span>, <span class="id">hi</span> - <span class="id">lo</span> = <span class="id">Z.neg</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span>(<span class="id">Z.sgn</span> (<span class="id">hi</span> - <span class="id">lo</span>) = - 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Z.sgn_neg</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Z.sgn</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des</span>. <span class="tactic">rewrite</span> <span class="id">NEG</span>. <span class="tactic">rewrite</span> <span class="id">Z2Nat.inj_neg</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mi_memval</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Mem.setN_other</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">mi_memval</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span> <span class="kwd">in</span> *. <span class="id">simp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Z2Nat.id</span> <span class="kwd">in</span> *; <span class="id">ss</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simp</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (0 &lt;= <span class="id">hi</span> - <span class="id">lo</span>)); <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">simp</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Mem_setN_in_repeat</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2Nat.id</span>; <span class="id">ss</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;- <span class="id">clear_until</span> <span class="id">mi_no_overlap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rr</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span>; <span class="id">ss</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk_src</span> &amp;&amp; <span class="id">zle</span> <span class="id">lo</span> <span class="id">ofs1</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs1</span> <span class="id">hi</span>) <span class="id">eqn</span>:<span class="id">T1</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simp</span>. <span class="tactic">clear</span> <span class="id">mi_no_overlap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gss</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">simp</span>. <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> *; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">not_and_or</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">PRVT</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:= <span class="id">ofs2</span> + <span class="id">delta2</span>). <span class="id">zsimpl</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rr</span>. <span class="id">xomega</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b2</span> <span class="id">blk_src</span> &amp;&amp; <span class="id">zle</span> <span class="id">lo</span> <span class="id">ofs2</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs2</span> <span class="id">hi</span>) <span class="id">eqn</span>:<span class="id">T2</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">sguard</span> <span class="kwd">in</span> <span class="id">T1</span>. <span class="id">simp</span>. <span class="tactic">clear</span> <span class="id">mi_no_overlap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gss</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">simp</span>. <span class="tactic">clear</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> *; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>; <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">not_and_or</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">PRVT</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:= <span class="id">ofs1</span> + <span class="id">delta1</span>). <span class="id">zsimpl</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rr</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">mi_no_overlap</span> <span class="id">b1</span> <span class="id">b1</span>' <span class="id">delta1</span> <span class="id">b2</span> <span class="id">b2</span>' <span class="id">delta2</span> <span class="id">ofs1</span> <span class="id">ofs2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="id">hexploit1</span> <span class="id">mi_no_overlap</span>; <span class="id">ss</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mi_no_overlap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">des_ifs</span>; <span class="id">simp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">des_ifs</span>; <span class="id">simp</span>.<br/>
&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">ss</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">b</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b</span> <span class="id">blk_src</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des</span>; <span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *; <span class="id">ss</span>; <span class="tactic">rewrite</span> <span class="id">PMap.gss</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *; <span class="id">des_ifs</span>; <span class="tactic">eauto</span> 6.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *; <span class="id">des_ifs</span>; <span class="tactic">eauto</span> 6.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Mem.perm</span> <span class="id">m_src0</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">Max</span> <span class="id">Nonempty</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m_src0</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1) <span class="id">Max</span> <span class="id">Nonempty</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span>, <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. } <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mi_representable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Mem.perm</span>. <span class="id">ss</span>. <span class="id">ii</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">mi_perm_inv</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">blk_src</span> &amp;&amp; <span class="id">zle</span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id">zlt</span> <span class="id">ofs</span> <span class="id">hi</span>) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">bsimpl</span>. <span class="id">des_safe</span>. <span class="id">des_sumbool</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>. <span class="id">des_ifs_safe</span>. <span class="id">ss</span>. <span class="id">left</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>. <span class="id">des_ifs_safe</span>. <span class="id">left</span>. <span class="id">ss</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">private_unfree_inj_inj_wf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_tgt</span> <span class="id">blk_src</span> <span class="id">blk_tgt</span> <span class="id">delta</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.range_perm</span> <span class="id">m_tgt</span> <span class="id">blk_tgt</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) <span class="id">Cur</span> <span class="id">Freeable</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRVT</span>: <span class="id">range</span> (<span class="id">delta</span> + <span class="id">lo</span>) (<span class="id">delta</span> + <span class="id">hi</span>) &lt;1= <span class="id">loc_out_of_reach</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">blk_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m_src0</span> <span class="id">blk_src</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">range</span> <span class="id">lo</span> <span class="id">hi</span> &lt;1= <span class="id">P</span> <span class="id">blk_src</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">m_tgt</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src1</span> <span class="id">P</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src1</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7282')">Proof.</div>
<div class="proofscript" id="proof7282">
&nbsp;&nbsp;<span class="id">splits</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">private_unfree_inj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">private_unfree_inj_wf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">private_unfree_symbols_inject</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unfree_free_inj_inj_wf</span> <span class="id">P</span> <span class="id">j</span> (<span class="id">m_src0</span> <span class="id">m_src1</span> <span class="id">m_src2</span> <span class="id">m_tgt</span>: <span class="id">mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk0</span> <span class="id">blk1</span> <span class="id">delta1</span> <span class="id">delta2</span> <span class="id">ofs1</span> <span class="id">ofs2</span> <span class="id">size</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA1</span>: <span class="id">delta1</span> = <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA2</span>: <span class="id">delta2</span> = <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">Mem.free</span> <span class="id">m_src0</span> <span class="id">blk0</span> <span class="id">delta1</span> (<span class="id">delta1</span> + <span class="id">size</span>) = <span class="id">Some</span> <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m_src1</span> <span class="id">blk1</span> <span class="id">delta2</span> (<span class="id">delta2</span> + <span class="id">size</span>) = <span class="id">Some</span> <span class="id">m_src2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SAME</span>: <span class="id">inj_same</span> <span class="id">j</span> (<span class="id">Vptr</span> <span class="id">blk1</span> <span class="id">ofs2</span>) (<span class="id">Vptr</span> <span class="id">blk0</span> <span class="id">ofs1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAPPED</span>: <span class="id">j</span> <span class="id">blk1</span> &lt;&gt; <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">range</span> <span class="id">delta2</span> (<span class="id">delta2</span> + <span class="id">size</span>) &lt;1= <span class="id">P</span> <span class="id">blk1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src2</span> <span class="id">m_tgt</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">WFINJ</span>: <span class="id">inj_range_wf</span> <span class="id">j</span> <span class="id">m_src2</span> <span class="id">P</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">SYMB</span>: <span class="id">skenv_inject</span> <span class="id">ge</span> <span class="id">j</span> <span class="id">m_src2</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7283')">Proof.</div>
<div class="proofscript" id="proof7283">
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">blk1</span>) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">BEQ</span>; <span class="id">clarify</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAME0</span>: <span class="id">j</span> <span class="id">blk0</span> = <span class="id">Some</span> (<span class="id">b</span>, <span class="id">z</span> - <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">SAME</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">VAL0</span>. <span class="id">inv</span> <span class="id">VAL1</span>. <span class="tactic">rewrite</span> <span class="id">BEQ</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">INJ0</span>. <span class="tactic">rewrite</span> <span class="id">INJ1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">EQ</span>. <span class="tactic">rewrite</span> <span class="id">BEQ</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">private_unfree_inj_inj_wf</span>; <span class="id">cycle</span> 4; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">skenv_inject_max_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">WFINJ</span> <span class="id">blk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+  <span class="id">econs</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span> 2; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">ALIGN</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.free_left_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">hexploit</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.range_perm_inj</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">z</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + (<span class="id">z</span> - <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)); [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">z</span> + (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> + <span class="id">size</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">size</span> + (<span class="id">z</span> - <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)); [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">delta</span>' <span class="id">RANGE0</span> <span class="id">blk</span>' <span class="id">ofs</span>' <span class="id">INJECT</span>. <span class="tactic">unfold</span> <span class="id">range</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">blk</span>' <span class="id">blk0</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_free_2</span>; <span class="tactic">eauto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">PERM</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span> <span class="kwd">in</span> <span class="id">PERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span> <span class="kwd">in</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.inject_no_overlap</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">FREE</span>; [|<span class="id">econs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">delta</span>' - <span class="id">z</span> + <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> - <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="id">des</span>; <span class="id">clarify</span>. <span class="id">zsimpl</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">INJRANGEWF</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
