
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module SimMemInjC</title>
<meta name="description" content="Documentation of Coq module SimMemInjC" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module SimMemInjC</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CoqlibC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">MemoryC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Values</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Maps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Events</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Globalenvs</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AST</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">IntegersC</span> <span class="id">LinkingC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SimSymb</span> <span class="id">Skeleton</span> <span class="id">Mod</span> <span class="id">ModSem</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SimMemLift</span>.<br/>
<span class="kwd">Require</span> <span class="id">SimSymbId</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Conventions1</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id">SimMemInj</span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id">MEMINJ</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update</span> (<span class="id">sm0</span>: <span class="id">t</span>') (<span class="id">src</span> <span class="id">tgt</span>: <span class="id">mem</span>) (<span class="id">inj</span>: <span class="id">meminj</span>): <span class="id">t</span>' :=<br/>
&nbsp;&nbsp;<span class="id">mk</span> <span class="id">src</span> <span class="id">tgt</span> <span class="id">inj</span> <span class="id">sm0</span>.(<span class="id">src_external</span>) <span class="id">sm0</span>.(<span class="id">tgt_external</span>) <span class="id">sm0</span>.(<span class="id">src_parent_nb</span>) <span class="id">sm0</span>.(<span class="id">tgt_parent_nb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src_ge_nb</span>) <span class="id">sm0</span>.(<span class="id">tgt_ge_nb</span>).<br/>
<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">update</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">src_private</span> <span class="id">tgt_private</span> <span class="id">valid_blocks</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">update_src_private</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">sm1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">sm0</span>.(<span class="id">inj</span>) = <span class="id">sm1</span>.(<span class="id">inj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRC</span>: <span class="id">sm0</span>.(<span class="id">src</span>).(<span class="id">Mem.nextblock</span>) = <span class="id">sm1</span>.(<span class="id">src</span>).(<span class="id">Mem.nextblock</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src_private</span>) = (<span class="id">sm1</span>).(<span class="id">src_private</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6467')">Proof.</div>
<div class="proofscript" id="proof6467">
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">apply</span> <span class="id">Axioms.functional_extensionality</span>; <span class="id">i</span>). <span class="tactic">apply</span> <span class="id">prop_ext1</span>.<br/>
&nbsp;&nbsp;<span class="id">u</span>. <span class="tactic">split</span>; <span class="id">ii</span>; <span class="id">des</span>; <span class="id">esplits</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">update_tgt_private</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">sm1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRC</span>: <span class="id">sm0</span>.(<span class="id">src</span>) = <span class="id">sm1</span>.(<span class="id">src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGT</span>: <span class="id">sm0</span>.(<span class="id">tgt</span>).(<span class="id">Mem.nextblock</span>) = <span class="id">sm1</span>.(<span class="id">tgt</span>).(<span class="id">Mem.nextblock</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">sm0</span>.(<span class="id">inj</span>) = <span class="id">sm1</span>.(<span class="id">inj</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">tgt_private</span>) = <span class="id">sm1</span>.(<span class="id">tgt_private</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6468')">Proof.</div>
<div class="proofscript" id="proof6468">
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">apply</span> <span class="id">Axioms.functional_extensionality</span>; <span class="id">i</span>). <span class="tactic">apply</span> <span class="id">prop_ext1</span>.<br/>
&nbsp;&nbsp;<span class="id">u</span>. <span class="tactic">split</span>; <span class="id">ii</span>; <span class="id">des</span>; <span class="id">esplits</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">INJ</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">SRC</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">INJ</span>. <span class="tactic">rewrite</span> <span class="id">SRC</span>. <span class="id">ss</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">lepriv</span> (<span class="id">sm0</span> <span class="id">sm1</span>: <span class="id">SimMemInj.t</span>'): <span class="kwd">Prop</span> :=<br/>
| <span class="id">lepriv_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">sm1</span>.(<span class="id">inj</span>))<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRCGENB</span>: <span class="id">sm0</span>.(<span class="id">src_ge_nb</span>) = <span class="id">sm1</span>.(<span class="id">src_ge_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTGENB</span>: <span class="id">sm0</span>.(<span class="id">tgt_ge_nb</span>) = <span class="id">sm1</span>.(<span class="id">tgt_ge_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FROZEN</span>: <span class="id">frozen</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">sm1</span>.(<span class="id">inj</span>) (<span class="id">sm0</span>.(<span class="id">src_ge_nb</span>)) (<span class="id">sm0</span>.(<span class="id">tgt_ge_nb</span>))).<br/>
<br/>
<span class="kwd">Global</span> <span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">SimMemInj</span> : <span class="id">SimMem.class</span> :=<br/>
{ <span class="id">t</span> := <span class="id">t</span>';<br/>
&nbsp;&nbsp;<span class="id">src</span> := <span class="id">src</span>;<br/>
&nbsp;&nbsp;<span class="id">tgt</span> := <span class="id">tgt</span>;<br/>
&nbsp;&nbsp;<span class="kwd">wf</span> := <span class="kwd">wf</span>';<br/>
&nbsp;&nbsp;<span class="id">le</span> := <span class="id">le</span>';<br/>
&nbsp;&nbsp;<span class="id">lepriv</span> := <span class="id">lepriv</span>;<br/>
&nbsp;&nbsp;<span class="id">sim_val</span> := <span class="kwd">fun</span> (<span class="id">mrel</span>: <span class="id">t</span>') =&gt; <span class="id">Val.inject</span> <span class="id">mrel</span>.(<span class="id">inj</span>);<br/>
&nbsp;&nbsp;<span class="id">sim_val_list</span> := <span class="kwd">fun</span> (<span class="id">mrel</span>: <span class="id">t</span>') =&gt; <span class="id">Val.inject_list</span> <span class="id">mrel</span>.(<span class="id">inj</span>);<br/>
}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6469')">Next Obligation.</div>
<div class="proofscript" id="proof6469">
 <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">LE</span>. <span class="id">inv</span> <span class="id">LE</span>. <span class="id">econs</span>; <span class="id">et</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6470')">Next Obligation.</div>
<div class="proofscript" id="proof6470">
 <span class="id">ii</span>. <span class="id">inv</span> <span class="id">MLE</span>. <span class="tactic">eapply</span> <span class="id">val_inject_incr</span>; <span class="tactic">eauto</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6471')">Next Obligation.</div>
<div class="proofscript" id="proof6471">
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">apply</span> <span class="id">Axioms.functional_extensionality</span>; <span class="id">i</span>). <span class="tactic">apply</span> <span class="id">prop_ext1</span>. <span class="tactic">split</span>; <span class="id">i</span>; <span class="id">ss</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;- <span class="id">ginduction</span> <span class="id">x</span>; <span class="id">ii</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">ss</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ginduction</span> <span class="id">x1</span>; <span class="id">ii</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">ss</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6472')">Next Obligation.</div>
<div class="proofscript" id="proof6472">
 <span class="id">inv</span> <span class="id">H</span>. <span class="id">ss</span>. Qed.</div>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Global</span> <span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">lepriv_Transitive</span>: <span class="id">RelationClasses.Transitive</span> <span class="id">lepriv</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6473')">Next Obligation.</div>
<div class="proofscript" id="proof6473">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="id">des</span>; <span class="id">clarify</span>. <span class="id">econs</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inject_incr_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>; <span class="id">des</span>. <span class="tactic">destruct</span> (<span class="id">inj</span> <span class="id">y</span> <span class="id">b_src</span>) <span class="id">eqn</span>:<span class="id">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">exploit</span> <span class="id">INCR0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">clarify</span>. <span class="id">inv</span> <span class="id">FROZEN</span>. <span class="id">hexploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">FROZEN0</span>. <span class="id">hexploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="tactic">eauto</span>; []; <span class="id">i</span>; <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Global</span> <span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">SimMemInjLift</span> : <span class="id">SimMemLift.class</span> <span class="id">SimMemInj</span> :=<br/>
{ <span class="id">lift</span> := <span class="id">lift</span>';<br/>
&nbsp;&nbsp;<span class="id">unlift</span> := <span class="id">unlift</span>';<br/>
}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6474')">Next Obligation.</div>
<div class="proofscript" id="proof6474">
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">VALID</span>. <span class="id">inv</span> <span class="id">VALID</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="id">ii</span>; <span class="id">des</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="tactic">eapply</span> <span class="id">Pos.compare_gt_iff</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">xomega</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6475')">Next Obligation.</div>
<div class="proofscript" id="proof6475">
 <span class="tactic">eapply</span> <span class="id">unlift_spec</span>; <span class="id">et</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6476')">Next Obligation.</div>
<div class="proofscript" id="proof6476">
 <span class="tactic">eapply</span> <span class="id">unlift_wf</span>; <span class="tactic">eauto</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6477')">Next Obligation.</div>
<div class="proofscript" id="proof6477">
 <span class="id">inv</span> <span class="id">MWF</span>. <span class="tactic">destruct</span> <span class="id">sm0</span>; <span class="id">ss</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">frozen_refl</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6478')">Next Obligation.</div>
<div class="proofscript" id="proof6478">
 <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">inv</span> <span class="id">MLE</span>. <span class="id">inv</span> <span class="id">MLIFT</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="id">et</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="tactic">eapply</span> <span class="id">frozen_refl</span>. Qed.</div>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id">ORIGINALS</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">le_excl</span> (<span class="id">excl_src</span> <span class="id">excl_tgt</span>: <span class="id">block</span> -&gt; <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">mrel0</span> <span class="id">mrel1</span>: <span class="id">t</span>'): <span class="kwd">Prop</span> :=<br/>
| <span class="id">le_excl_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">mrel0</span>.(<span class="id">inj</span>) <span class="id">mrel1</span>.(<span class="id">inj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRCUNCHANGED</span>: <span class="id">Mem.unchanged_on</span> <span class="id">mrel0</span>.(<span class="id">src_external</span>) <span class="id">mrel0</span>.(<span class="id">src</span>) <span class="id">mrel1</span>.(<span class="id">src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTUNCHANGED</span>: <span class="id">Mem.unchanged_on</span> <span class="id">mrel0</span>.(<span class="id">tgt_external</span>) <span class="id">mrel0</span>.(<span class="id">tgt</span>) <span class="id">mrel1</span>.(<span class="id">tgt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRCPARENTEQ</span>: <span class="id">mrel0</span>.(<span class="id">src_external</span>) = <span class="id">mrel1</span>.(<span class="id">src_external</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRCPARENTEQNB</span>: <span class="id">mrel0</span>.(<span class="id">src_parent_nb</span>) = <span class="id">mrel1</span>.(<span class="id">src_parent_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SRCGENB</span>: <span class="id">mrel0</span>.(<span class="id">src_ge_nb</span>) = <span class="id">mrel1</span>.(<span class="id">src_ge_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTPARENTEQ</span>: <span class="id">mrel0</span>.(<span class="id">tgt_external</span>) = <span class="id">mrel1</span>.(<span class="id">tgt_external</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTPARENTEQNB</span>: <span class="id">mrel0</span>.(<span class="id">tgt_parent_nb</span>) = <span class="id">mrel1</span>.(<span class="id">tgt_parent_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTGENB</span>: <span class="id">mrel0</span>.(<span class="id">tgt_ge_nb</span>) = <span class="id">mrel1</span>.(<span class="id">tgt_ge_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FROZEN</span>: <span class="id">frozen</span> <span class="id">mrel0</span>.(<span class="id">inj</span>) <span class="id">mrel1</span>.(<span class="id">inj</span>) (<span class="id">mrel0</span>.(<span class="id">src_parent_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mrel0</span>.(<span class="id">tgt_parent_nb</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXSRC</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">mrel0</span>.(<span class="id">src</span>) <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EXCL</span>: ~ <span class="id">excl_src</span> <span class="id">b</span> <span class="id">ofs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">mrel1</span>.(<span class="id">src</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">mrel0</span>.(<span class="id">src</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXTGT</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">mrel0</span>.(<span class="id">tgt</span>) <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EXCL</span>: ~ <span class="id">excl_tgt</span> <span class="id">b</span> <span class="id">ofs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">mrel1</span>.(<span class="id">tgt</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">mrel0</span>.(<span class="id">tgt</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">has_footprint</span> (<span class="id">excl_src</span> <span class="id">excl_tgt</span>: <span class="id">block</span> -&gt; <span class="id">Z</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">sm0</span>: <span class="id">t</span>'): <span class="kwd">Prop</span> :=<br/>
| <span class="id">has_footprint_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FOOTSRC</span>: <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EXCL</span>: <span class="id">excl_src</span> <span class="id">blk</span> <span class="id">ofs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">blk</span> <span class="id">ofs</span> <span class="id">Cur</span> <span class="id">Freeable</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FOOTTGT</span>: <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EXCL</span>: <span class="id">excl_tgt</span> <span class="id">blk</span> <span class="id">ofs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">blk</span> <span class="id">ofs</span> <span class="id">Cur</span> <span class="id">Freeable</span>&gt;&gt;).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unfree_right</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">blk</span> <span class="id">m_tgt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="kwd">wf</span>' <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NOPERM</span>: <span class="id">Mem_range_noperm</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFR</span>: <span class="id">Mem_unfree</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m_tgt0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RANGE</span>: <span class="id">brange</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> &lt;2= ~2 <span class="id">sm0</span>.(<span class="id">tgt_external</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MSRC</span>: <span class="id">sm1</span>.(<span class="id">src</span>) = <span class="id">sm0</span>.(<span class="id">src</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MTGT</span>: <span class="id">sm1</span>.(<span class="id">tgt</span>) = <span class="id">m_tgt0</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MINJ</span>: <span class="id">sm1</span>.(<span class="id">inj</span>) = <span class="id">sm0</span>.(<span class="id">inj</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MWF</span>: <span class="kwd">wf</span>' <span class="id">sm1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MLE</span>: <span class="id">le_excl</span> <span class="id">bot2</span> (<span class="id">brange</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>) <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6479')">Proof.</div>
<div class="proofscript" id="proof6479">
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">sm0</span>.(<span class="id">update</span>) <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">m_tgt0</span> <span class="id">sm0</span>.(<span class="id">inj</span>)).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="id">et</span>. <span class="tactic">intro</span> <span class="id">UNCH</span>. <span class="id">esplits</span>; <span class="id">u</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> (<span class="tactic">by</span> <span class="id">inv</span> <span class="id">MWF</span>; <span class="id">ss</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">MWF</span>. <span class="tactic">eapply</span> <span class="id">Mem_unfree_right_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">MWF</span>; <span class="tactic">eauto</span>. <span class="id">u</span>. <span class="id">ii</span>; <span class="id">des</span>; <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> &lt;- <span class="id">Mem_valid_block_unfree</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">MWF</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id">Mem_nextblock_unfree</span>; <span class="tactic">eauto</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>. { <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>. } <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">RANGE</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">frozen_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span>; <span class="id">et</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">foot_excl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">sm1</span> <span class="id">sm2</span> <span class="id">excl_src</span> <span class="id">excl_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FOOT</span>: <span class="id">has_footprint</span> <span class="id">excl_src</span> <span class="id">excl_tgt</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE</span>: <span class="id">le</span>' <span class="id">sm0</span> <span class="id">sm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLEEXCL</span>: <span class="id">le_excl</span> <span class="id">excl_src</span> <span class="id">excl_tgt</span> <span class="id">sm1</span> <span class="id">sm2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MLE</span>: <span class="id">le</span>' <span class="id">sm0</span> <span class="id">sm2</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6480')">Proof.</div>
<div class="proofscript" id="proof6480">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">MLE</span>. <span class="id">inv</span> <span class="id">MLEEXCL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FROZENHI</span>: <span class="id">frozen</span> (<span class="id">inj</span> <span class="id">sm0</span>) (<span class="id">inj</span> <span class="id">sm2</span>) (<span class="id">src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_parent_nb</span> <span class="id">sm0</span>)).<br/>
&nbsp;&nbsp;{ - <span class="tactic">clear</span> - <span class="id">FROZEN</span> <span class="id">FROZEN0</span> <span class="id">INCR0</span> <span class="id">SRCPARENTEQNB</span> <span class="id">TGTPARENTEQNB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FROZEN</span>. <span class="id">inv</span> <span class="id">FROZEN0</span>. <span class="id">econs</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="tactic">destruct</span> (<span class="id">inj</span> <span class="id">sm1</span> <span class="id">b_src</span>) <span class="id">eqn</span>:<span class="id">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">ss</span>. <span class="id">exploit</span> <span class="id">INCR0</span>; <span class="id">et</span>. <span class="id">i</span>; <span class="id">clarify</span>. <span class="id">exploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">NEW_IMPLIES_OUTSIDE0</span>; <span class="id">et</span>. <span class="id">i</span>; <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="tactic">congruence</span> <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">et</span>; <span class="tactic">try</span> (<span class="tactic">by</span> <span class="id">etrans</span>; <span class="id">et</span>).<br/>
&nbsp;&nbsp;- <span class="id">etrans</span>; <span class="id">et</span>. <span class="tactic">rewrite</span> <span class="id">SRCPARENTEQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">etrans</span>; <span class="id">et</span>. <span class="tactic">rewrite</span> <span class="id">TGTPARENTEQ</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">frozen_shortened</span>; <span class="id">et</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">MWF</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">excl_src</span> <span class="id">b</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">FOOT</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span> <span class="kwd">with</span> (<span class="id">p1</span> := <span class="id">Freeable</span>); [|<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>]. <span class="tactic">eapply</span> <span class="id">FOOTSRC</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">MAXSRC</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC0</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">excl_tgt</span> <span class="id">b</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">FOOT</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span> <span class="kwd">with</span> (<span class="id">p1</span> := <span class="id">Freeable</span>); [|<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>]. <span class="tactic">eapply</span> <span class="id">FOOTTGT</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">MAXTGT</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">MAXTGT0</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="id">et</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">ORIGINALS</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">parallel_gen</span> <span class="id">sm0</span> <span class="id">m_src1</span> <span class="id">m_tgt1</span> <span class="id">j1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WF</span>: <span class="kwd">wf</span>' <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j1</span> <span class="id">m_src1</span> <span class="id">m_tgt1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INCR</span>: <span class="id">inject_incr</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: <span class="id">inject_separated</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">j1</span> <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">sm0</span>.(<span class="id">tgt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNCHSRC</span>: <span class="id">Mem.unchanged_on</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">loc_unmapped</span> <span class="id">sm0</span>.(<span class="id">inj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">m_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNCHTGT</span>: <span class="id">Mem.unchanged_on</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">loc_out_of_reach</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">sm0</span>.(<span class="id">src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">m_tgt1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXSRC</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">m_src1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXTGT</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">m_tgt1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;):<br/>
&nbsp;&nbsp;(&lt;&lt;<span class="id">MLE</span>: <span class="id">le</span>' <span class="id">sm0</span> (<span class="id">mk</span> <span class="id">m_src1</span> <span class="id">m_tgt1</span> <span class="id">j1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_external</span> <span class="id">sm0</span>) (<span class="id">tgt_external</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_parent_nb</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_ge_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_ge_nb</span> <span class="id">sm0</span>))&gt;&gt;) /\<br/>
&nbsp;&nbsp;(&lt;&lt;<span class="id">MWF</span>: <span class="kwd">wf</span>' (<span class="id">mk</span> <span class="id">m_src1</span> <span class="id">m_tgt1</span> <span class="id">j1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_external</span> <span class="id">sm0</span>) (<span class="id">tgt_external</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_parent_nb</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_ge_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_ge_nb</span> <span class="id">sm0</span>))&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6481')">Proof.</div>
<div class="proofscript" id="proof6481">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WF</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span>(<span class="id">FROZEN</span>: <span class="id">frozen</span> (<span class="id">inj</span> <span class="id">sm0</span>) <span class="id">j1</span> (<span class="id">src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_parent_nb</span> <span class="id">sm0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">exploit</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="tactic">split</span>; <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *; <span class="tactic">red</span>; <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">SRCEXT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">frozen_shortened</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">destruct</span> <span class="id">PR</span>. <span class="tactic">split</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">loc_unmapped</span>. <span class="tactic">destruct</span> (<span class="id">j1</span> <span class="id">x0</span>) <span class="id">eqn</span>:<span class="id">BLK</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">exploit</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">destruct</span> <span class="id">PR</span>. <span class="tactic">split</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">inj</span> <span class="id">sm0</span> <span class="id">b0</span>) <span class="id">eqn</span>:<span class="id">BLK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">dup</span> <span class="id">BLK</span>. <span class="tactic">eapply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">BLK</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">alloc_left_zero_simmem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">blk_src</span> <span class="id">sz</span> <span class="id">m_src1</span> <span class="id">blk_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ALLOC</span>: <span class="id">Mem.alloc</span> <span class="id">sm0</span>.(<span class="id">SimMem.src</span>) 0 <span class="id">sz</span> = (<span class="id">m_src1</span>, <span class="id">blk_src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTPRIV</span>: (<span class="id">range</span> 0 <span class="id">sz</span>) &lt;1= <span class="id">sm0</span>.(<span class="id">tgt_private</span>) <span class="id">blk_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTNOTEXT</span>: ((<span class="id">range</span> 0 <span class="id">sz</span>) /1\ <span class="id">sm0</span>.(<span class="id">tgt_external</span>) <span class="id">blk_tgt</span>) &lt;1= <span class="id">bot1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGTPERM</span>: <span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span> (<span class="id">BOUND</span>: 0 &lt;= <span class="id">ofs</span> &lt; <span class="id">sz</span>), <span class="id">Mem.perm</span> <span class="id">sm0</span>.(<span class="id">SimMem.tgt</span>) <span class="id">blk_tgt</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">blk_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PARENT</span>: (<span class="id">sm0</span>.(<span class="id">tgt_parent_nb</span>) &lt;= <span class="id">blk_tgt</span>)%<span class="id">positive</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sm1</span> := (<span class="id">mk</span> <span class="id">m_src1</span> <span class="id">sm0</span>.(<span class="id">tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blk</span> =&gt; <span class="kwd">if</span> <span class="id">eq_block</span> <span class="id">blk</span> <span class="id">blk_src</span> <span class="kwd">then</span> <span class="id">Some</span> (<span class="id">blk_tgt</span>, 0) <span class="kwd">else</span> <span class="id">sm0</span>.(<span class="id">inj</span>) <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src_external</span>) <span class="id">sm0</span>.(<span class="id">tgt_external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src_parent_nb</span>) <span class="id">sm0</span>.(<span class="id">tgt_parent_nb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span>.(<span class="id">src_ge_nb</span>) <span class="id">sm0</span>.(<span class="id">tgt_ge_nb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm1</span>&gt;&gt; /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMem.le</span> <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6482')">Proof.</div>
<div class="proofscript" id="proof6482">
&nbsp;&nbsp;<span class="id">i</span>. <span class="id">subst_locals</span>. <span class="id">inv</span> <span class="id">MWF</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">clarify</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;* <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_alloc_left_inject</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">TGTPRIV</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="id">u</span>. <span class="id">ii</span>; <span class="id">ss</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">hnf</span>. <span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">u</span>. <span class="id">ii</span>; <span class="id">ss</span>. <span class="id">dup</span> <span class="id">PR</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT</span> <span class="kwd">in</span> <span class="id">PR0</span>. <span class="id">u</span> <span class="kwd">in</span> <span class="id">PR0</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">hnf</span>. <span class="id">hnf</span> <span class="kwd">in</span> <span class="id">PR0</span>. <span class="id">ii</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">TGTNOTEXT</span>; <span class="tactic">eauto</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">u</span>. <span class="tactic">rewrite</span> <span class="id">Z.sub_0_r</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NNPP</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem_alloc_fresh_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">PR0</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="id">exploit</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">assert</span>(<span class="id">FROZEN</span>: <span class="id">frozen</span> (<span class="id">inj</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blk</span> =&gt; <span class="kwd">if</span> <span class="id">eq_block</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> (<span class="id">src</span> <span class="id">sm0</span>)) <span class="kwd">then</span> <span class="id">Some</span> (<span class="id">blk_tgt</span>, 0) <span class="kwd">else</span> <span class="id">inj</span> <span class="id">sm0</span> <span class="id">blk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">tgt_parent_nb</span> <span class="id">sm0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>; <span class="id">ss</span>. <span class="id">des</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">cbn</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="id">ss</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">MWF</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>; <span class="id">ss</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_unchanged_on_trans_strong</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.alloc_unchanged_on</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">frozen_shortened</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Z.mul</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="id">StoreArguments</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">MEMINJ</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">valid_blocks</span> <span class="id">src_private</span> <span class="id">tgt_private</span> <span class="id">range</span>.<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id">SIMSYMB</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">skenv_inject_meminj_preserves_globals</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">F</span> <span class="id">V</span> (<span class="id">skenv</span>: <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>) <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv</span> <span class="id">j</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">INJECT</span>: <span class="id">meminj_preserves_globals</span> <span class="id">skenv</span> <span class="id">j</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6483')">Proof.</div>
<div class="proofscript" id="proof6483">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">rr</span>. <span class="id">esplits</span>; <span class="id">ii</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_var_info</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Genv.find_var_info</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">sim_skenv_inj</span> (<span class="id">sm</span>: <span class="id">SimMem.t</span>) (<span class="id">__noname__</span>: <span class="id">SimSymbId.t</span>') (<span class="id">skenv_src</span> <span class="id">skenv_tgt</span>: <span class="id">SkEnv.t</span>): <span class="kwd">Prop</span> :=<br/>
| <span class="id">sim_skenv_inj_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">skenv_inject</span> <span class="id">skenv_src</span> <span class="id">sm</span>.(<span class="id">inj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIMSKENV</span>: <span class="id">SimSymbId.sim_skenv</span> <span class="id">skenv_src</span> <span class="id">skenv_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NBSRC</span>: <span class="id">skenv_src</span>.(<span class="id">Genv.genv_next</span>) = <span class="id">sm</span>.(<span class="id">src_ge_nb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NBTGT</span>: <span class="id">skenv_tgt</span>.(<span class="id">Genv.genv_next</span>) = <span class="id">sm</span>.(<span class="id">tgt_ge_nb</span>)).<br/>
<br/>
<span class="kwd">Section</span> <span class="id">REVIVE</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">F1</span> <span class="id">V1</span>: <span class="kwd">Type</span>} {<span class="id">LF</span>: <span class="id">Linker</span> <span class="id">F1</span>} {<span class="id">LV</span>: <span class="id">Linker</span> <span class="id">V1</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> `{<span class="id">HasExternal</span> <span class="id">F1</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Variables</span> (<span class="id">p_src</span>: <span class="id">AST.program</span> <span class="id">F1</span> <span class="id">V1</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">skenv_inject_revive</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skenv_proj_src</span> <span class="id">ge_src</span> <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">REVIVESRC</span>: <span class="id">ge_src</span> = <span class="id">SkEnv.revive</span> <span class="id">skenv_proj_src</span> <span class="id">p_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIMSKENV</span>: <span class="id">skenv_inject</span> <span class="id">skenv_proj_src</span> <span class="id">j</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">SIMSKENV</span>: <span class="id">skenv_inject</span> <span class="id">ge_src</span> <span class="id">j</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6484')">Proof.</div>
<div class="proofscript" id="proof6484">
 <span class="id">clarify</span>. <span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">REVIVE</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Global</span> <span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">SimSymbId</span>: <span class="id">SimSymb.class</span> <span class="id">SimMemInj</span> := {<br/>
&nbsp;&nbsp;<span class="id">t</span> := <span class="id">SimSymbId.t</span>';<br/>
&nbsp;&nbsp;<span class="id">src</span> := <span class="id">SimSymbId.src</span>;<br/>
&nbsp;&nbsp;<span class="id">tgt</span> := <span class="id">SimSymbId.tgt</span>;<br/>
&nbsp;&nbsp;<span class="id">le</span> := <span class="id">SimSymbId.le</span>;<br/>
&nbsp;&nbsp;<span class="kwd">wf</span> := <span class="id">SimSymbId.wf</span>;<br/>
&nbsp;&nbsp;<span class="id">sim_skenv</span> := <span class="id">sim_skenv_inj</span>;<br/>
}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6485')">Next Obligation.</div>
<div class="proofscript" id="proof6485">
 <span class="id">rr</span> <span class="kwd">in</span> <span class="id">SIMSK</span>. <span class="id">r</span>. <span class="tactic">congruence</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6486')">Next Obligation.</div>
<div class="proofscript" id="proof6486">
 <span class="tactic">eapply</span> <span class="id">SimSymbId.wf_link</span>; <span class="tactic">eauto</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6487')">Next Obligation.</div>
<div class="proofscript" id="proof6487">
 <span class="id">inv</span> <span class="id">SIMSKE</span>. <span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">ss</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6488')">Next Obligation.</div>
<div class="proofscript" id="proof6488">
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SimSymbId.wf_load_sim_skenv</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span> (<span class="id">mk</span> <span class="id">m_src</span> <span class="id">m_src</span> (<span class="id">Mem.flat_inj</span> <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bot2</span> <span class="id">bot2</span> <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>) <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>) <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>) <span class="id">m_src</span>.(<span class="id">Mem.nextblock</span>)). <span class="id">ss</span>.<br/>
&nbsp;&nbsp;<span class="id">esplits</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>; <span class="id">ii</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Mem.flat_inj</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> ! <span class="id">Genv.init_mem_genv_next</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Mem.flat_inj</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> ! <span class="id">Genv.init_mem_genv_next</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="id">erewrite</span> ! <span class="id">Genv.init_mem_genv_next</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="id">erewrite</span> ! <span class="id">Genv.init_mem_genv_next</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">xomega</span>; <span class="id">ii</span>; <span class="id">des</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Genv.initmem_inject</span>; <span class="tactic">eauto</span>; (<span class="id">u</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">MAINSIM</span>. <span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>. <span class="id">des_ifs</span>. <span class="tactic">unfold</span> <span class="id">Mem.flat_inj</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Genv.init_mem_genv_next</span>; <span class="tactic">eauto</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">psimpl</span>. <span class="id">ss</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6489')">Next Obligation.</div>
<div class="proofscript" id="proof6489">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">MLE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">inv</span> <span class="id">MLE</span>. <span class="tactic">eapply</span> <span class="id">IMAGE</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id">frozen_preserves_tgt</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">NBTGT</span>. <span class="id">rr</span> <span class="kwd">in</span> <span class="id">SIMSKENV0</span>. <span class="id">clarify</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">MLE</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">MLE</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6490')">Next Obligation.</div>
<div class="proofscript" id="proof6490">
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">SkEnv.project</span> <span class="id">skenv_link_src</span> <span class="id">ss</span>.(<span class="id">SimSymbId.src</span>)) <span class="kwd">as</span> <span class="id">skenv_proj_src</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">SkEnv.project_impl_spec</span> <span class="id">INCLSRC</span>); <span class="tactic">intro</span> <span class="id">LESRC</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">SkEnv.project</span> <span class="id">skenv_link_tgt</span> <span class="id">ss</span>.(<span class="id">SimSymbId.tgt</span>)) <span class="kwd">as</span> <span class="id">skenv_proj_tgt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">SkEnv.project_impl_spec</span> <span class="id">INCLTGT</span>); <span class="tactic">intro</span> <span class="id">LETGT</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SimSymbId.sim_skenv_monotone</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">SIMSKENV</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">inv</span> <span class="id">LESRC</span>. <span class="id">inv</span> <span class="id">LETGT</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">econs</span>; <span class="id">ii</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6491')">Next Obligation.</div>
<div class="proofscript" id="proof6491">
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SimSymbId.sim_skenv_func_bisim</span>; <span class="tactic">eauto</span>. { <span class="tactic">eapply</span> <span class="id">SIMSKENV</span>. } <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">inv</span> <span class="id">SIMSKENV0</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ii</span>; <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">FUNCFSIM</span>; <span class="tactic">eauto</span>. <span class="id">rpapply</span> <span class="id">FUNCSRC</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">SIMFPTR</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Genv.find_funct</span>, <span class="id">Genv.find_funct_ptr</span> <span class="kwd">in</span> *. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. { <span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>. } <span class="id">i</span>; <span class="id">clarify</span>. }<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6492')">Next Obligation.</div>
<div class="proofscript" id="proof6492">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">SimSymbId.system_sim_skenv</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof6493')">Next Obligation.</div>
<div class="proofscript" id="proof6493">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sm0</span>, <span class="id">args_src</span>, <span class="id">args_tgt</span>; <span class="id">ss</span>; <span class="id">inv</span> <span class="id">ARGS</span>; <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MWF</span>; <span class="id">ss</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Note:&nbsp;It&nbsp;may&nbsp;be&nbsp;easier&nbsp;&amp;&amp;&nbsp;more&nbsp;natural&nbsp;to&nbsp;use<br/>
"external_call_mem_inject"&nbsp;with&nbsp;"external_call_symbols_preserved",&nbsp;instead&nbsp;of&nbsp;"external_call_mem_inject_gen"&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;exploit&nbsp;external_call_mem_inject_gen;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_mem_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">skenv_inject_meminj_preserves_globals</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">SIMSKENV</span>; <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;<span class="id">i</span>; <span class="id">des</span>. <span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="id">dsplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">instantiate</span> (1:= <span class="id">Retv.mk</span> <span class="id">_</span> <span class="id">_</span>); <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">external_call_symbols_preserved</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">SimSymbId.sim_skenv_equiv</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">SIMSKENV</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">retv_src</span>; <span class="id">ss</span>. <span class="id">instantiate</span> (1:= <span class="id">mk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>). <span class="id">econs</span> 1; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">retv_src</span>.(<span class="id">Retv.m</span>)). <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span>(<span class="id">FROZEN</span>: <span class="id">frozen</span> <span class="id">inj</span> <span class="id">f</span>' <span class="id">src_parent_nb</span> <span class="id">tgt_parent_nb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">inject_separated_frozen</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">u</span>. <span class="id">i</span>; <span class="id">des</span>; <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">SRCEXT</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">unfold</span> <span class="id">src_private</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. <span class="id">u</span>. <span class="id">i</span>; <span class="id">des</span>; <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">des</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">frozen_shortened</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">external_call_max_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">external_call_max_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">inject_separated_frozen</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">econs</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;+&nbsp;eapply&nbsp;after_private_src;&nbsp;ss;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;+&nbsp;eapply&nbsp;after_private_tgt;&nbsp;ss;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">src_private</span>. <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rr</span>. <span class="id">rr</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">destruct</span> (<span class="id">f</span>' <span class="id">x0</span>) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">ss</span>. <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">ss</span>. <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="tactic">unfold</span> <span class="id">valid_blocks</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">r</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span>. <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rr</span>. <span class="id">rr</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">inj</span> <span class="id">b0</span>) <span class="id">eqn</span>:<span class="id">T</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">ss</span>. <span class="id">exploit</span> <span class="id">H4</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">PR</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">external_call_max_perm</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">T</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">H5</span>. <span class="id">exploit</span> <span class="id">NEW_IMPLIES_OUTSIDE</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="tactic">unfold</span> <span class="id">valid_blocks</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">r</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H2</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H3</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Local</span> <span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">SimMemInj</span>.<br/>
<span class="kwd">Local</span> <span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">SimSymbId</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sim_skenv_symbols_inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">ss0</span> <span class="id">skenv_src</span> <span class="id">skenv_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIMSKE</span>: <span class="id">SimSymb.sim_skenv</span> <span class="id">sm0</span> <span class="id">ss0</span> <span class="id">skenv_src</span> <span class="id">skenv_tgt</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symbols_inject</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>) <span class="id">skenv_src</span> <span class="id">skenv_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6494')">Proof.</div>
<div class="proofscript" id="proof6494">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SIMSKE</span>. <span class="id">inv</span> <span class="id">SIMSKENV</span>. <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">rr</span>. <span class="id">esplits</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">NB</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="id">i</span> ;<span class="id">des</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id">Genv.block_is_volatile</span>, <span class="id">Genv.find_var_info</span>. <span class="tactic">destruct</span> (<span class="id">Genv.find_def</span> <span class="id">skenv_tgt</span> <span class="id">b1</span>) <span class="id">eqn</span>:<span class="id">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exploit</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">NB</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">des</span>. <span class="id">clarify</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs</span>. <span class="id">exploit</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">NB</span>. <span class="id">exploit</span> <span class="id">DOMAIN</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IMAGE</span> <span class="id">b1</span> <span class="id">b2</span>); <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">clarify</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">SIMSYMB</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id">skenv_inject_revive</span> [<span class="id">_</span> <span class="id">_</span> <span class="id">_</span>].<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">JunkBlock</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">JUNK</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">inject_junk_blocks_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">n</span> <span class="id">m_tgt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">JUNKTGT</span>: <span class="id">assign_junk_blocks</span> <span class="id">sm0</span>.(<span class="id">SimMem.tgt</span>) <span class="id">n</span> = <span class="id">m_tgt0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">DEF</span>: <span class="id">sm1</span> = <span class="id">update</span> <span class="id">sm0</span> <span class="id">sm0</span>.(<span class="id">SimMem.src</span>) <span class="id">m_tgt0</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMem.le</span> <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">PRIVSRC</span>: <span class="id">sm0</span>.(<span class="id">SimMemInj.src_private</span>) = <span class="id">sm1</span>.(<span class="id">SimMemInj.src_private</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">PRIVTGT</span>: <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt_private</span>) &lt;2= <span class="id">sm1</span>.(<span class="id">SimMemInj.tgt_private</span>)&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6495')">Proof.</div>
<div class="proofscript" id="proof6495">
&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">PUBLIC</span>. <span class="tactic">destruct</span> <span class="id">sm0</span>; <span class="id">ss</span>. <span class="id">clear_tac</span>. <span class="id">ginduction</span> <span class="id">n</span>; <span class="id">ii</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHn</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.alloc_right_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> - <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span>. <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;- <span class="id">clarify</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">assign_junk_blocks_unchanged_on</span>; <span class="id">et</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">clarify</span>. <span class="tactic">clear</span> - <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span>. <span class="id">ss</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">inject_junk_blocks</span> (<span class="id">m_src0</span> <span class="id">m_tgt0</span>: <span class="id">mem</span>) (<span class="id">n</span>: <span class="id">nat</span>) (<span class="id">j</span>: <span class="id">meminj</span>): <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id">Zerob.zerob</span> <span class="id">n</span>) <span class="kwd">then</span> <span class="id">j</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">blk</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">negb</span> (<span class="id">plt</span> <span class="id">blk</span> <span class="id">m_src0</span>.(<span class="id">Mem.nextblock</span>)) &amp;&amp; (<span class="id">plt</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> <span class="id">m_src0</span> + <span class="id">Pos.of_nat</span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">Some</span> ((<span class="id">blk</span> + <span class="id">m_tgt0</span>.(<span class="id">Mem.nextblock</span>) - <span class="id">m_src0</span>.(<span class="id">Mem.nextblock</span>))%<span class="id">positive</span> , 0%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">j</span> <span class="id">blk</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">inject_junk_blocks_parallel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">n</span> <span class="id">m_tgt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">JUNKTGT</span>: <span class="id">assign_junk_blocks</span> <span class="id">sm0</span>.(<span class="id">SimMem.tgt</span>) <span class="id">n</span> = <span class="id">m_tgt0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">DEF</span>: <span class="id">sm1</span> = <span class="id">update</span> <span class="id">sm0</span> (<span class="id">assign_junk_blocks</span> <span class="id">sm0</span>.(<span class="id">SimMem.src</span>) <span class="id">n</span>) <span class="id">m_tgt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">inject_junk_blocks</span> <span class="id">sm0</span>.(<span class="id">SimMem.src</span>) <span class="id">sm0</span>.(<span class="id">SimMem.tgt</span>) <span class="id">n</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>))&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMem.le</span> <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">PRIVSRC</span>: <span class="id">sm0</span>.(<span class="id">SimMemInj.src_private</span>) = <span class="id">sm1</span>.(<span class="id">SimMemInj.src_private</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">PRIVTGT</span>: <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt_private</span>) &lt;2= <span class="id">sm1</span>.(<span class="id">SimMemInj.tgt_private</span>)&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6496')">Proof.</div>
<div class="proofscript" id="proof6496">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inject_junk_blocks</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">PUBLIC</span>. <span class="tactic">destruct</span> <span class="id">sm0</span>; <span class="id">ss</span>. <span class="id">clear_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ginduction</span> <span class="id">n</span>; <span class="id">ii</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_parallel_inject</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Heq</span>; <span class="tactic">try</span> <span class="id">refl</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Q</span>; <span class="id">des</span>. <span class="tactic">rewrite</span> <span class="id">Q</span> <span class="kwd">in</span> *. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHn</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Q0</span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">P</span>. <span class="tactic">clear</span> <span class="id">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rpapply</span> <span class="id">P</span>. <span class="tactic">clear</span> <span class="id">P</span>. <span class="tactic">apply</span> <span class="id">func_ext1</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Heq</span>; <span class="tactic">intro</span> <span class="id">X</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Heq</span>; <span class="tactic">intro</span> <span class="id">X</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Q</span>; <span class="tactic">intro</span> <span class="id">Y</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Q</span>; <span class="tactic">intro</span> <span class="id">Y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">X</span>. <span class="tactic">rewrite</span> ! <span class="id">Y</span>. <span class="tactic">unfold</span> <span class="id">block</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">bsimpl</span>. <span class="id">des</span>. <span class="id">des_sumbool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Plt_succ_inv</span> <span class="id">x0</span> (<span class="id">Mem.nextblock</span> <span class="id">src</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Pos.of_nat</span>. <span class="tactic">unfold</span> <span class="id">Pos.of_nat</span> <span class="kwd">in</span> *. <span class="id">xomega</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">R</span>. <span class="id">des</span>; <span class="id">clarify</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">Q2</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>; <span class="id">ss</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Q3</span>; <span class="id">ss</span>. <span class="id">ii</span>; <span class="id">clarify</span>. <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">x0</span> = (<span class="id">Mem.nextblock</span> <span class="id">src</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">clarify</span>. <span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Q2</span>. <span class="tactic">repeat</span> <span class="tactic">f_equal</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">x0</span> = <span class="id">Pos.succ</span> (<span class="id">Mem.nextblock</span> <span class="id">src</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">clarify</span>. <span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">do</span> 2 <span class="tactic">f_equal</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Pos.of_nat</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 <span class="tactic">f_equal</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Pos.of_nat</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Pos.of_nat</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Q3</span>; <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Q3</span>; <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id">src_private</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">des_ifs</span>. <span class="id">rr</span>. <span class="id">rr</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des_ifs</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>. <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span>. <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="id">rr</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>. <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">clarify</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">des_ifs</span>. <span class="id">bsimpl</span>. <span class="id">des</span>. <span class="id">des_sumbool</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">inv</span> <span class="id">PUBLIC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">mi_freeblocks</span>; <span class="tactic">eauto</span>. <span class="id">i</span>; <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">assign_junk_blocks_unchanged_on</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">assign_junk_blocks_unchanged_on</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">des_ifs</span>. <span class="id">bsimpl</span>. <span class="id">des</span>. <span class="id">des_sumbool</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econs</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="id">des_ifs</span>. <span class="id">bsimpl</span>. <span class="id">des</span>. <span class="id">des_sumbool</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">i</span>. <span class="id">clarify</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">ss</span>. <span class="tactic">repeat</span> (<span class="tactic">apply</span> <span class="id">func_ext1</span>; <span class="id">i</span>). <span class="tactic">apply</span> <span class="id">AxiomsC.prop_ext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">src_private</span>, <span class="id">loc_unmapped</span>, <span class="id">valid_blocks</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="tactic">split</span>; <span class="id">i</span>; <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.nextblock_alloc</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">n</span>; <span class="id">ss</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="tactic">try</span> <span class="id">xomega</span>; <span class="tactic">split</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *; <span class="id">ss</span>. <span class="id">erewrite</span> <span class="id">Mem.nextblock_alloc</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">Heq0</span>. <span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Pos.of_nat</span>. <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Pos.of_nat</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">tgt_private</span>, <span class="id">loc_out_of_reach</span>, <span class="id">valid_blocks</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">inv</span> <span class="id">MWF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">split</span>; <span class="id">ss</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *; <span class="id">ss</span>. <span class="id">des_ifs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">assign_junk_blocks_perm</span>. <span class="comment">(*&nbsp;TODO:&nbsp;change&nbsp;lemma&nbsp;into&nbsp;symmetric&nbsp;version&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">bsimpl</span>; <span class="id">des</span>; <span class="id">des_sumbool</span>; <span class="id">et</span>; <span class="tactic">try</span> <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">JUNK</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">Mem_free_parallel</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">blk_src</span> <span class="id">blk_tgt</span> <span class="id">ofs_src</span> <span class="id">ofs_tgt</span> <span class="id">sz</span> <span class="id">m_src0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="kwd">wf</span>' <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL</span>: <span class="id">Val.inject</span> <span class="id">sm0</span>.(<span class="id">inj</span>) (<span class="id">Vptr</span> <span class="id">blk_src</span> <span class="id">ofs_src</span>) (<span class="id">Vptr</span> <span class="id">blk_tgt</span> <span class="id">ofs_tgt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREESRC</span>: <span class="id">Mem.free</span> <span class="id">sm0</span>.(<span class="id">src</span>) <span class="id">blk_src</span> <span class="id">ofs_src</span>.(<span class="id">Ptrofs.unsigned</span>) (<span class="id">ofs_src</span>.(<span class="id">Ptrofs.unsigned</span>) + <span class="id">sz</span>) = <span class="id">Some</span> <span class="id">m_src0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MSRC</span>: <span class="id">sm1</span>.(<span class="id">src</span>) = <span class="id">m_src0</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MINJ</span>: <span class="id">sm1</span>.(<span class="id">inj</span>) = <span class="id">sm0</span>.(<span class="id">inj</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">FREETGT</span>: <span class="id">Mem.free</span> <span class="id">sm0</span>.(<span class="id">tgt</span>) <span class="id">blk_tgt</span> <span class="id">ofs_tgt</span>.(<span class="id">Ptrofs.unsigned</span>) (<span class="id">ofs_tgt</span>.(<span class="id">Ptrofs.unsigned</span>) + <span class="id">sz</span>) = <span class="id">Some</span> <span class="id">sm1</span>.(<span class="id">tgt</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MWF</span>: <span class="kwd">wf</span>' <span class="id">sm1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MLE</span>: <span class="id">le</span>' <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6497')">Proof.</div>
<div class="proofscript" id="proof6497">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">VAL</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> 0 <span class="id">sz</span>).<br/>
&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">SimMemInj.free_parallel</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">erewrite</span> <span class="id">Mem.address_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">delta</span> + <span class="id">sz</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span> + <span class="id">delta</span>); [<span class="tactic">eauto</span>|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">SimMemInj.free_parallel</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id">Mem_free_zero_same</span>; <span class="tactic">eauto</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">storebytes_mapped</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">b</span> <span class="id">tb</span> <span class="id">ofs</span> <span class="id">bytes1</span> <span class="id">bytes2</span> <span class="id">m_src</span> <span class="id">delta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span> : <span class="id">SimMemInj.wf</span>' <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STRSRC</span>: <span class="id">Mem.storebytes</span> (<span class="id">SimMemInj.src</span> <span class="id">sm0</span>) <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes1</span> = <span class="id">Some</span> <span class="id">m_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIMBLK</span>: (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>) <span class="id">b</span> = <span class="id">Some</span> (<span class="id">tb</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BYTESINJ</span>: <span class="id">list_forall2</span> (<span class="id">memval_inject</span> (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>)) <span class="id">bytes1</span> <span class="id">bytes2</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MSRC</span>: (<span class="id">SimMemInj.src</span> <span class="id">sm1</span>) = <span class="id">m_src</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MINJ</span>: (<span class="id">SimMemInj.inj</span> <span class="id">sm1</span>) = (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">STRTGT</span>: <span class="id">Mem.storebytes</span> (<span class="id">SimMemInj.tgt</span> <span class="id">sm0</span>) <span class="id">tb</span> (<span class="id">ofs</span> + <span class="id">delta</span>) <span class="id">bytes2</span> = <span class="id">Some</span> (<span class="id">SimMemInj.tgt</span> <span class="id">sm1</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMemInj.le</span>' <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;)<br/>
.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6498')">Proof.</div>
<div class="proofscript" id="proof6498">
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.storebytes_mapped_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">MWF</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">i</span>. <span class="id">des</span>. <span class="id">inv</span> <span class="id">MWF</span>. <span class="id">eexists</span> (<span class="id">SimMemInj.mk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>). <span class="id">esplits</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id">SimMemInj.frozen_refl</span>); <span class="tactic">try</span> (<span class="id">ii</span>; <span class="tactic">eapply</span> <span class="id">Mem.perm_storebytes_2</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.storebytes_unchanged_on</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">SRCEXT</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">des</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.storebytes_unchanged_on</span>; <span class="tactic">eauto</span>. <span class="id">ii</span>. <span class="tactic">apply</span> <span class="id">TGTEXT</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">des</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> - <span class="id">BYTESINJ</span> <span class="id">STRSRC</span> <span class="id">H1</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.storebytes_range_perm</span> <span class="kwd">in</span> <span class="id">STRSRC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Datatypes.length</span> <span class="id">bytes2</span> = <span class="id">Datatypes.length</span> <span class="id">bytes1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">list_forall2_length</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">ofs</span> &lt;= <span class="id">i</span> - <span class="id">delta</span>) <span class="tactic">by</span> <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">i</span> - <span class="id">delta</span> &lt; <span class="id">ofs</span> + <span class="id">Z.of_nat</span> (<span class="id">Datatypes.length</span> <span class="id">bytes1</span>)) <span class="tactic">by</span> <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> <span class="id">STRSRC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">STRSRC</span> (<span class="id">i</span> - <span class="id">delta</span>)). <span class="id">exploit</span> <span class="id">STRSRC</span>. <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">perm_any_N</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> (<span class="tactic">by</span> <span class="id">etransitivity</span>; <span class="tactic">eauto</span>; <span class="id">erewrite</span> &lt;- <span class="id">Mem.nextblock_storebytes</span>; <span class="tactic">eauto</span>; <span class="id">refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">SimMemInj.src_private</span>. <span class="id">ss</span>. <span class="id">ii</span>; <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">SimMemInj.valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.nextblock_storebytes</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">SimMemInj.tgt_private</span>. <span class="id">ss</span>. <span class="id">ii</span>; <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">PR</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_storebytes_2</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">SimMemInj.valid_blocks</span>, <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.nextblock_storebytes</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SeparationC</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">SEP</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">sep_scope</span>.<br/>
<span class="kwd">Lemma</span> <span class="id">minjection_disjoint_footprint_private</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: (<span class="id">SimMemInj.tgt</span> <span class="id">sm0</span>) |= <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DISJ</span>: <span class="id">disjoint_footprint</span> (<span class="id">minjection</span> (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.src</span> <span class="id">sm0</span>)) <span class="id">P</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.(<span class="id">m_footprint</span>) &lt;2= <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt_private</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6499')">Proof.</div>
<div class="proofscript" id="proof6499">
&nbsp;&nbsp;<span class="id">u</span>. <span class="id">ii</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">DISJ</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">P</span>; <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">m_valid</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">minjection_private_disjoint_footprint</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRIV</span>: <span class="id">P</span>.(<span class="id">m_footprint</span>) &lt;2= <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt_private</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">DISJ</span>: <span class="id">disjoint_footprint</span> (<span class="id">minjection</span> (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.src</span> <span class="id">sm0</span>)) <span class="id">P</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6500')">Proof.</div>
<div class="proofscript" id="proof6500">
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">ss</span>. <span class="id">des</span>. <span class="tactic">eapply</span> <span class="id">PRIV</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">external_call_parallel_rule_simmem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">F</span> <span class="id">V</span>: <span class="kwd">Type</span>) (<span class="id">ge0</span>: <span class="id">Genv.t</span> <span class="id">F</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm_at</span> <span class="id">sm_after</span> <span class="id">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: <span class="id">sm_at</span>.(<span class="id">SimMem.tgt</span>) |= (<span class="id">minjection</span> <span class="id">sm_at</span>.(<span class="id">SimMemInj.inj</span>) <span class="id">sm_at</span>.(<span class="id">SimMem.src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">globalenv_inject</span> <span class="id">ge0</span> <span class="id">sm_at</span>.(<span class="id">SimMemInj.inj</span>) ** <span class="id">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm_arg</span> <span class="id">sm_ret</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm_at</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF0</span>: <span class="id">SimMem.wf</span> <span class="id">sm_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF1</span>: <span class="id">SimMem.wf</span> <span class="id">sm_ret</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF2</span>: <span class="id">SimMem.wf</span> <span class="id">sm_after</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWFAFTR</span> : <span class="id">SimMem.wf</span> (<span class="id">SimMemInj.unlift</span>' <span class="id">sm_arg</span> <span class="id">sm_ret</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE</span>: <span class="id">SimMem.le</span> <span class="id">sm_at</span> <span class="id">sm_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE0</span>: <span class="id">SimMem.le</span> (<span class="id">SimMemLift.lift</span> <span class="id">sm_arg</span>) <span class="id">sm_ret</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE1</span>: <span class="id">SimMem.le</span> (<span class="id">SimMemLift.unlift</span> <span class="id">sm_at</span> <span class="id">sm_ret</span>) <span class="id">sm_after</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLEAFTR</span>: <span class="id">SimMem.le</span> <span class="id">sm_arg</span> (<span class="id">SimMemLift.unlift</span> <span class="id">sm_arg</span> <span class="id">sm_ret</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRIV0</span>: <span class="id">sm_at</span>.(<span class="id">SimMemInj.tgt_private</span>) = <span class="id">sm_arg</span>.(<span class="id">SimMemInj.tgt_private</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PRIV1</span>: <span class="id">sm_ret</span>.(<span class="id">SimMemInj.tgt_private</span>) = <span class="id">sm_after</span>.(<span class="id">SimMemInj.tgt_private</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNCH0</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">SimMemInj.tgt_private</span> <span class="id">sm_arg</span>) (<span class="id">SimMemInj.tgt</span> <span class="id">sm_at</span>) (<span class="id">SimMemInj.tgt</span> <span class="id">sm_arg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNCH1</span>: <span class="id">Mem.unchanged_on</span> (<span class="id">SimMemInj.tgt_private</span> <span class="id">sm_arg</span>) (<span class="id">SimMemInj.tgt</span> <span class="id">sm_ret</span>) (<span class="id">SimMemInj.tgt</span> <span class="id">sm_after</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">SEP</span>: <span class="id">sm_after</span>.(<span class="id">SimMem.tgt</span>) |= (<span class="id">minjection</span> <span class="id">sm_after</span>.(<span class="id">SimMemInj.inj</span>) <span class="id">sm_after</span>.(<span class="id">SimMem.src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">globalenv_inject</span> <span class="id">ge0</span> <span class="id">sm_at</span>.(<span class="id">SimMemInj.inj</span>) ** <span class="id">P</span>&gt;&gt;.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6501')">Proof.</div>
<div class="proofscript" id="proof6501">
&nbsp;&nbsp;<span class="comment">(*&nbsp;See&nbsp;external_call_parallel_rule&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">disjoint_footprint_sepconj</span> <span class="kwd">in</span> <span class="id">C</span>. <span class="id">des</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">minjection_disjoint_footprint_private</span> <span class="kwd">in</span> <span class="id">DISJ1</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">des</span>. <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;<span class="id">sep_split</span>.<br/>
&nbsp;&nbsp;{ <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">MWF2</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">disjoint_footprint_sepconj</span>. <span class="id">ss</span>. <span class="tactic">split</span>; <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">minjection_private_disjoint_footprint</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PRIV0</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">PRIV1</span>. <span class="id">inv</span> <span class="id">MLEAFTR</span>. <span class="id">inv</span> <span class="id">MLE0</span>. <span class="id">inv</span> <span class="id">MWF0</span>. <span class="id">inv</span> <span class="id">MWF1</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etrans</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">TGTEXT0</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">TGTPARENTEQ0</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id">sep_split</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">globalenv_inject_incr</span> <span class="kwd">in</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sep_pick1</span> <span class="kwd">in</span> <span class="id">B</span>. <span class="id">ss</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">MLE</span>. <span class="id">inv</span> <span class="id">MLE0</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="id">inv</span> <span class="id">MLEAFTR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etrans</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">SimMemInj.inject_separated_frozen</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">SimMemInj.frozen_refl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="id">ss</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">B</span> <span class="kwd">as</span> (<span class="id">X</span> &amp; <span class="id">Y</span> &amp; <span class="id">Z</span>); <span class="id">ss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">m_invar</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">DISJ1</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PRIV0</span>. <span class="id">etrans</span>.<br/>
&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:= (<span class="id">SimMemInj.tgt</span> <span class="id">sm_arg</span>)). <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">etrans</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:= (<span class="id">SimMemInj.tgt</span> <span class="id">sm_ret</span>)). <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">clears</span> <span class="id">sm_after</span>. <span class="tactic">clear</span> <span class="id">sm_after</span>. <span class="id">clears</span> <span class="id">sm_at</span>. <span class="tactic">clear</span> <span class="id">sm_at</span>. <span class="id">inv</span> <span class="id">MLE0</span>. <span class="id">ss</span>.<br/>
<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Mem.empty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sim_skenv_inj_globalenv_inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">F</span> `{<span class="id">HasExternal</span> <span class="id">F</span>} <span class="id">V</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span> <span class="id">skenv_proj_src</span> <span class="id">skenv_proj_tgt</span> <span class="id">sm_arg</span> (<span class="id">prog</span>: <span class="id">AST.program</span> <span class="id">F</span> <span class="id">V</span>) <span class="id">m_tgt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIMSKE</span>: <span class="id">sim_skenv_inj</span> <span class="id">sm_arg</span> <span class="id">ss</span> <span class="id">skenv_proj_src</span> <span class="id">skenv_proj_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NB</span>: <span class="id">Ple</span> (<span class="id">Genv.genv_next</span> <span class="id">skenv_proj_src</span>) (<span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m_tgt0</span> |= <span class="id">globalenv_inject</span> (<span class="id">SkEnv.revive</span> <span class="id">skenv_proj_src</span> <span class="id">prog</span>) (<span class="id">SimMemInj.inj</span> <span class="id">sm_arg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6502')">Proof.</div>
<div class="proofscript" id="proof6502">
&nbsp;&nbsp;<span class="id">ss</span>. <span class="id">inv</span> <span class="id">SIMSKE</span>. <span class="id">inv</span> <span class="id">INJECT</span>. <span class="id">esplits</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">uge0</span>. <span class="id">des_ifs</span>. <span class="id">exploit</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ii</span>. <span class="id">uge0</span>. <span class="id">des_ifs</span>. <span class="id">exploit</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">SEP</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
