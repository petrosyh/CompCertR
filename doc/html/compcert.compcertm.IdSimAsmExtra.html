
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module IdSimAsmExtra</title>
<meta name="description" content="Documentation of Coq module IdSimAsmExtra" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module IdSimAsmExtra</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Program</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Sem</span> <span class="id">SimProg</span> <span class="id">Skeleton</span> <span class="id">Mod</span> <span class="id">ModSem</span> <span class="id">SimMod</span> <span class="id">SimModSem</span> <span class="id">SimSymb</span> <span class="id">SimMem</span> <span class="id">Sound</span> <span class="id">SimSymb</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AsmC</span>.<br/>
<span class="kwd">Require</span> <span class="id">SimMemId</span> <span class="id">SimMemExt</span> <span class="id">SimMemInj</span>.<br/>
<span class="kwd">Require</span> <span class="id">SoundTop</span> <span class="id">UnreachC</span>.<br/>
<span class="kwd">Require</span> <span class="id">SimSymbId</span> <span class="id">SimSymbDrop</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CoqlibC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ValuesC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">LinkingC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">MapsC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AxiomsC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Ord</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">MemoryC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SmallstepC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Events</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Preservation</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Integers</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">LocationsC</span> <span class="id">Conventions</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AsmregsC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">MatchSimModSemExcl2</span> <span class="id">MatchSimModSem</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">StoreArguments</span> <span class="id">StoreArgumentsProps</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AsmStepInj</span> <span class="id">AsmStepExt</span> <span class="id">IntegersC</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Logic.PropExtensionality</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AsmExtra</span> <span class="id">IdSimExtra</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Conventions1C</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">mktac</span>.<br/>
<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<br/>
<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id">Z.mul</span> <span class="id">Z.add</span> <span class="id">Z.sub</span> <span class="id">Z.div</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">lessdef_commute</span> <span class="id">j</span> <span class="id">src0</span> <span class="id">src1</span> <span class="id">tgt0</span> <span class="id">tgt1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ0</span>: <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">src0</span> <span class="id">tgt0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ1</span>: <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">src1</span> <span class="id">tgt1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LESS</span>: <span class="id">Val.lessdef</span> <span class="id">src0</span> <span class="id">src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNDEF</span>: <span class="id">src0</span> = <span class="id">Vundef</span> -&gt; <span class="id">tgt0</span> = <span class="id">Vundef</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">tgt0</span> <span class="id">tgt1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7246')">Proof.</div>
<div class="proofscript" id="proof7246">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">LESS</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">INJ0</span>; <span class="id">inv</span> <span class="id">INJ1</span>; <span class="id">ss</span>; <span class="tactic">try</span> <span class="id">econs</span>; <span class="id">clarify</span>. <span class="tactic">rewrite</span> <span class="id">UNDEF</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">UNDEF</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">MEMORYLEMMA</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Plt_lemma</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LE</span>: ~ <span class="id">Plt</span> <span class="id">a</span> <span class="id">b</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">Plt</span> (<span class="id">a</span> + <span class="id">c</span> - <span class="id">b</span>) <span class="id">c</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7247')">Proof.</div>
<div class="proofscript" id="proof7247">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Plt</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Pos.compare_lt_iff</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">erewrite</span> &lt;- <span class="id">Pos.add_compare_mono_r</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">instantiate</span> (1:=<span class="id">b</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Pos.sub_add</span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">xomega</span>]. <span class="tactic">rewrite</span> <span class="id">Pos.add_comm</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">LE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> -&gt; <span class="id">Pos.compare_lt_iff</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Plt_lemma2</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LE</span>: ~ <span class="id">Plt</span> <span class="id">a</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LT</span>: <span class="id">Plt</span> <span class="id">a</span> (<span class="id">b</span> + <span class="id">d</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Plt</span> (<span class="id">a</span> + <span class="id">c</span> - <span class="id">b</span>) (<span class="id">c</span> + <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7248')">Proof.</div>
<div class="proofscript" id="proof7248">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Plt</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Pos.compare_lt_iff</span> <span class="kwd">in</span> <span class="id">LT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Pos.add_compare_mono_r</span> <span class="kwd">in</span> <span class="id">LT</span>. <span class="id">instantiate</span> (1:=<span class="id">c</span>) <span class="kwd">in</span> <span class="id">LT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Pos.sub_compare_mono_r</span> <span class="kwd">in</span> <span class="id">LT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">instantiate</span> (1:=<span class="id">b</span>) <span class="kwd">in</span> <span class="id">LT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> -&gt; <span class="id">Pos.compare_lt_iff</span> <span class="kwd">in</span> <span class="id">LT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rpapply</span> <span class="id">LT</span>. <span class="tactic">replace</span> (<span class="id">b</span> + <span class="id">d</span> + <span class="id">c</span>)%<span class="id">positive</span> <span class="kwd">with</span> (<span class="id">c</span> + <span class="id">d</span> + <span class="id">b</span>)%<span class="id">positive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Pos.add_sub</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">LT</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Z2Nat_range</span> <span class="id">n</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Z.of_nat</span> (<span class="id">Z.to_nat</span> <span class="id">n</span>) = <span class="kwd">if</span> (<span class="id">zle</span> 0 <span class="id">n</span>) <span class="kwd">then</span> <span class="id">n</span> <span class="kwd">else</span> 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7249')">Proof.</div>
<div class="proofscript" id="proof7249">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Z2Nat.id</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Z.to_nat</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">Mem_unfree_parallel_inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs_src</span> <span class="id">ofs_tgt</span> <span class="id">sz</span> <span class="id">m1</span>' <span class="id">b</span>' <span class="id">delta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m1</span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m1</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>) = <span class="id">Some</span> <span class="id">m1</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL</span>: <span class="id">ofs_tgt</span> = <span class="id">Ptrofs.add</span> <span class="id">ofs_src</span> (<span class="id">Ptrofs.repr</span> <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">b</span> = <span class="id">Some</span> (<span class="id">b</span>', <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ALIGN</span>: <span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">chunk</span> <span class="id">p</span> (<span class="id">PERM</span>: <span class="kwd">forall</span> <span class="id">ofs0</span> (<span class="id">BOUND</span>: <span class="id">ofs</span> &lt;= <span class="id">ofs0</span> &lt; <span class="id">ofs</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) &lt;= <span class="id">ofs0</span> &lt; (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>) \/ <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">ofs0</span> <span class="id">Max</span> <span class="id">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">align_chunk</span> <span class="id">chunk</span> | <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">REPRESENTABLE</span>: <span class="kwd">forall</span> <span class="id">ofs</span> (<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">Max</span> <span class="id">Nonempty</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1) <span class="id">Max</span> <span class="id">Nonempty</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> &lt; (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1 &lt; (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">delta</span> &gt;= 0 /\ 0 &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> + <span class="id">delta</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NOPERM</span>: <span class="id">Mem_range_noperm</span> <span class="id">m2</span> <span class="id">b</span>' (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span> + <span class="id">sz</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m2</span> <span class="id">b</span>' (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span> + <span class="id">sz</span>) = <span class="id">Some</span> <span class="id">m2</span>'&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">INJECT</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m1</span>' <span class="id">m2</span>'&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7250')">Proof.</div>
<div class="proofscript" id="proof7250">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem_unfree</span> <span class="kwd">in</span> <span class="id">UNFREE</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">VALID</span>: <span class="id">Plt</span> <span class="id">b</span>' (<span class="id">Mem.nextblock</span> <span class="id">m2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem_unfree</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NOOVERLAP</span>: <span class="kwd">forall</span> <span class="id">b_src</span> <span class="id">delta</span>' <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span> (<span class="id">DELTA</span>: <span class="id">j</span> <span class="id">b_src</span> = <span class="id">Some</span> (<span class="id">b</span>', <span class="id">delta</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OFS</span>: (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) + <span class="id">delta</span> &lt;= <span class="id">ofs</span> + <span class="id">delta</span>' &lt; <span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">delta</span> + <span class="id">sz</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PERM</span>: <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b_src</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">False</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">exploit</span> <span class="id">NOPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id">unsigned_add</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">eauto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="id">i</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">cinv</span> (<span class="id">Mem.mi_inj</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">INJECT</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b</span> <span class="id">b1</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *. <span class="id">des_ifs_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">clarify</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">NOPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">NOPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">lia</span>. <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">try</span> <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">lia</span>; <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">try</span> <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">Mem.perm</span> <span class="id">m2</span> <span class="id">b2</span> (<span class="id">ofs</span> + <span class="id">delta0</span>) <span class="id">k</span> <span class="id">p1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="id">exploit</span> <span class="id">NOPERM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.perm_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ss</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b1</span> <span class="id">b</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">ALIGN</span>; <span class="tactic">eauto</span>. <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.mi_align</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Mem.mi_inj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gso</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Mem_setN_in_repeat</span>; <span class="tactic">eauto</span>; [<span class="id">econs</span>|]. <span class="tactic">rewrite</span> <span class="id">Z2Nat.id</span>; <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">zsimpl</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> 0 <span class="id">sz</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">nia</span>. <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>; <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>. <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">lia</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>; <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>; <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">nia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">zsimpl</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> 0 <span class="id">sz</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">left</span>. <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>; <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>. <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">lia</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>; <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>; <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">nia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>; <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>; <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>; <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Mem.setN_outside</span>; <span class="id">cycle</span> 1; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">length_list_repeat</span>. <span class="tactic">rewrite</span> <span class="id">Z2Nat_range</span>. <span class="id">des_ifs</span>; <span class="tactic">try</span> <span class="id">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NNPP</span>. <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">NOOVERLAP</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>; <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="id">lia</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">Mem.mi_freeblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">Mem.mi_mappedblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">apply</span> <span class="id">imply_to_or</span>. <span class="id">i</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="tactic">try</span> (<span class="tactic">by</span> <span class="id">exploit</span> <span class="id">Mem.mi_no_overlap</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="id">i</span>; <span class="id">des</span>; <span class="id">clarify</span>; <span class="tactic">eauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">ii</span>; <span class="id">exploit</span> <span class="id">NOOVERLAP</span>; <span class="tactic">eauto</span>; <span class="id">nia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">b0</span> <span class="id">b</span>); <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gss</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="id">des</span>; <span class="tactic">eauto</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.mi_representable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Mem.perm</span>, <span class="id">proj_sumbool</span> <span class="kwd">in</span> *. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>; (<span class="tactic">try</span> <span class="tactic">by</span> <span class="id">exploit</span> <span class="id">Mem.mi_perm_inv</span>; <span class="tactic">eauto</span>); <span class="tactic">try</span> <span class="tactic">by</span> (<span class="id">left</span>; <span class="tactic">try</span> <span class="id">econs</span>; <span class="tactic">try</span> <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">left</span>. <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>. <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">eauto</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">zlt</span> 0 <span class="id">sz</span>); <span class="tactic">try</span> <span class="id">lia</span>. <span class="id">left</span>. <span class="id">erewrite</span> <span class="id">unsigned_add</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>; <span class="tactic">eapply</span> <span class="id">REPRESENTABLE</span>; <span class="tactic">eauto</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">right</span>. <span class="id">ii</span>. <span class="id">exploit</span> <span class="id">Mem.perm_inject</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="tactic">eapply</span> <span class="id">NOPERM</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Mem_unfree_perm_restore</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m3</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREE</span>: <span class="id">Mem.free</span> <span class="id">m0</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MAXPERM</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">m0</span> <span class="id">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREE</span>: <span class="id">Mem_unfree</span> <span class="id">m2</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NBLE</span>: <span class="id">Ple</span> (<span class="id">Mem.nextblock</span> <span class="id">m1</span>) (<span class="id">Mem.nextblock</span> <span class="id">m2</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">m0</span> <span class="id">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MAX</span>: <span class="id">Mem.perm</span> <span class="id">m3</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> &lt;1= <span class="id">Mem.perm</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7251')">Proof.</div>
<div class="proofscript" id="proof7251">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">classic</span> (<span class="id">brange</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">perm_F_any</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.free_unchanged_on</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1:= ~2 <span class="id">brange</span> <span class="id">blk</span> <span class="id">lo</span> <span class="id">hi</span>). <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">H1</span>. <span class="id">splits</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">MAXPERM</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.nextblock_free</span> <span class="kwd">in</span> <span class="id">FREE</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> &lt;- <span class="id">FREE</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Mem_unfree_parallel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">sm_arg</span> <span class="id">sm_ret</span> <span class="id">blk_src</span> <span class="id">ofs_src</span> <span class="id">ofs_tgt</span> <span class="id">sz</span> <span class="id">blk_tgt</span> <span class="id">delta</span> <span class="id">m_src1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DELTA</span>: <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>) <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL</span>: <span class="id">ofs_tgt</span> = <span class="id">Ptrofs.add</span> <span class="id">ofs_src</span> (<span class="id">Ptrofs.repr</span> <span class="id">delta</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE0</span>: <span class="id">SimMemInj.le</span>' <span class="id">sm0</span> <span class="id">sm_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREESRC</span>: <span class="id">Mem.free</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SimMemInj.src</span> <span class="id">sm0</span>) <span class="id">blk_src</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">SimMemInj.src</span> <span class="id">sm_arg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FREETGT</span>: <span class="id">Mem.free</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SimMemInj.tgt</span> <span class="id">sm0</span>) <span class="id">blk_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span> + <span class="id">sz</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">SimMemInj.tgt</span> <span class="id">sm_arg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF0</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF1</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm_arg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF2</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm_ret</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MLE1</span>: <span class="id">SimMemInj.le</span>' (<span class="id">SimMemInj.lift</span>' <span class="id">sm_arg</span>) <span class="id">sm_ret</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNFREESRC</span>: <span class="id">Mem_unfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SimMemInj.src</span> <span class="id">sm_ret</span>) <span class="id">blk_src</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_src</span> + <span class="id">sz</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> <span class="id">m_src1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MSRC</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.src</span>) = <span class="id">m_src1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MINJ</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.inj</span>) = <span class="id">sm_ret</span>.(<span class="id">SimMemInj.inj</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">FREETGT</span>: <span class="id">Mem_unfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SimMemInj.tgt</span> <span class="id">sm_ret</span>) <span class="id">blk_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs_tgt</span> + <span class="id">sz</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span> <span class="id">sm1</span>.(<span class="id">SimMemInj.tgt</span>)&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMemInj.le</span>' <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7252')">Proof.</div>
<div class="proofscript" id="proof7252">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DELTA0</span>: <span class="id">SimMemInj.inj</span> <span class="id">sm_ret</span> <span class="id">blk_src</span> = <span class="id">Some</span> (<span class="id">blk_tgt</span>, <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">MLE0</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">INCR0</span>. <span class="tactic">eapply</span> <span class="id">INCR</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">MWF0</span>. <span class="id">cinv</span> <span class="id">MWF2</span>. <span class="id">exploit</span> <span class="id">Mem_unfree_parallel_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">cinv</span> <span class="id">PUBLIC</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_align</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ii</span>. <span class="id">exploit</span> <span class="id">PERM</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="id">instantiate</span> (1:=<span class="id">p</span>). <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">perm_F_any</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_free_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DELTA</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">inv</span> <span class="id">MWF0</span>. <span class="tactic">eapply</span> <span class="id">Mem.mi_representable</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="id">ss</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_free_1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DELTA</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_free_3</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_free_1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DELTA</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">perm_F_any</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">perm_F_any</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">ii</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="id">ss</span>. <span class="tactic">eapply</span> <span class="id">MAXTGT</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_free_noperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_free_1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DELTA</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">i</span>. <span class="id">des</span>. <span class="id">eexists</span> (<span class="id">SimMemInjC.update</span> <span class="id">sm0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>). <span class="id">inv</span> <span class="id">MLE0</span>. <span class="id">inv</span> <span class="id">MLE1</span>. <span class="id">inv</span> <span class="id">MWF1</span>. <span class="id">esplits</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>. <span class="tactic">rewrite</span> <span class="id">SRCPARENTEQ</span>. <span class="tactic">eapply</span> <span class="id">SRCEXT1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">SimMemInj.src_private</span>, <span class="id">SimMemInj.valid_blocks</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">ii</span>; <span class="id">des</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">SimMemInj.loc_unmapped_frozen</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id">Mem_valid_block_unfree</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">UNFREESRC</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">SimMemInj.tgt_private</span>, <span class="id">SimMemInj.valid_blocks</span> <span class="kwd">in</span> *. <span class="id">ss</span>. <span class="id">ii</span>; <span class="id">des</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">r</span>. <span class="id">ii</span>. <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b0</span> <span class="id">blk_src</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>. <span class="id">r</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">eapply</span> <span class="id">PR</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem_unfree_perm_restore</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">UNFREESRC</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC0</span>; <span class="id">et</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_free_1</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">PUBLIC</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">TGTPARENTEQ</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT1</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>. <span class="id">r</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">eapply</span> <span class="id">PR</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">SimMemInj.frozen_preserves_tgt</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">MAXSRC0</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">PUBLIC1</span>. <span class="tactic">eapply</span> <span class="id">SimMemInj.frozen_preserves_tgt</span>; <span class="id">et</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">UNFREESRC</span> <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id">Mem_unfree</span>, <span class="id">Mem.perm</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">ss</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gso</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">et</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">TGTPARENTEQ</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT1</span> <span class="kwd">in</span> <span class="id">PR</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Mem_valid_block_unfree</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">UNFREE</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span> <span class="kwd">in</span> <span class="id">SRCUNCHANGED0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span> <span class="kwd">in</span> <span class="id">SRCUNCHANGED</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem_nextblock_unfree</span> <span class="kwd">in</span> <span class="id">UNFREESRC</span>. <span class="tactic">rewrite</span> <span class="id">UNFREESRC</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span> <span class="kwd">in</span> <span class="id">TGTUNCHANGED0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span> <span class="kwd">in</span> <span class="id">TGTUNCHANGED</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem_nextblock_unfree</span> <span class="kwd">in</span> <span class="id">UNFREE</span>. <span class="tactic">rewrite</span> <span class="id">UNFREE</span>. <span class="id">refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span>(<span class="id">FROZENHI</span>: <span class="id">SimMemInj.frozen</span> (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.inj</span> <span class="id">sm_ret</span>) (<span class="id">SimMemInj.src_parent_nb</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.tgt_parent_nb</span> <span class="id">sm0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ + <span class="id">econs</span>. <span class="id">ii</span>. <span class="id">des</span>. <span class="tactic">destruct</span> (<span class="id">SimMemInj.inj</span> <span class="id">sm_arg</span> <span class="id">b_src</span>) <span class="id">eqn</span>: <span class="id">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">erewrite</span> <span class="id">INCR0</span> <span class="kwd">in</span> <span class="id">NEW0</span>; <span class="id">et</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">FROZEN</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">SimMemInj.inject_separated_frozen</span> <span class="kwd">in</span> <span class="id">FROZEN0</span>. <span class="id">exploit</span> <span class="id">FROZEN0</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SRCPARENTEQNB</span>, <span class="id">TGTPARENTEQNB</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">SRCLE1</span> <span class="id">TGTLE1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">Ple</span> (<span class="id">Mem.nextblock</span> (<span class="id">SimMemInj.src</span> <span class="id">sm_arg</span>)) <span class="id">b_src</span>) <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">Ple</span> (<span class="id">Mem.nextblock</span> (<span class="id">SimMemInj.tgt</span> <span class="id">sm_arg</span>)) <span class="id">b_tgt</span>) <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id">Pos.le_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econs</span>; <span class="id">ss</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">SRCPARENTEQ</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">SRCEXT</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">brange</span>, <span class="id">loc_unmapped</span> <span class="kwd">in</span> *. <span class="id">des</span>. <span class="id">clarify</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etrans</span>; <span class="tactic">eauto</span>. <span class="id">etrans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">TGTPARENTEQ</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem_unfree_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">TGTEXT</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">brange</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">H1</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">perm_F_any</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.address_inject</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">PUBLIC</span>; <span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.free_range_perm</span>; <span class="tactic">eauto</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">SimMemInj.frozen_shortened</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem_unfree_perm_restore</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">UNFREESRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">MAXSRC0</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id">Mem.nextblock_free</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem_unfree_perm_restore</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">UNFREE</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">MAXTGT0</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id">Mem.nextblock_free</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">MEMORYLEMMA</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">junk_inj</span> (<span class="id">m_src0</span> <span class="id">m_tgt0</span>: <span class="id">mem</span>) (<span class="id">j</span>: <span class="id">meminj</span>) (<span class="id">n</span>: <span class="id">nat</span>): <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">blk</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">plt</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> <span class="id">m_src0</span>) <span class="kwd">then</span> <span class="id">j</span> <span class="id">blk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">plt</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> (<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_src0</span> <span class="id">n</span>)) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> ((<span class="id">blk</span> + (<span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span>) - (<span class="id">Mem.nextblock</span> <span class="id">m_src0</span>))%<span class="id">positive</span>, 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">j</span> <span class="id">blk</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">src_junk_val</span> (<span class="id">m_src0</span> <span class="id">m_tgt0</span>: <span class="id">mem</span>) (<span class="id">n</span>: <span class="id">nat</span>) (<span class="id">v</span>: <span class="id">val</span>): <span class="id">val</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Vptr</span> <span class="id">blk</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">plt</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span>) <span class="kwd">then</span> <span class="id">Vundef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">plt</span> <span class="id">blk</span> (<span class="id">Mem.nextblock</span> (<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_tgt0</span> <span class="id">n</span>)) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Vptr</span> (<span class="id">blk</span> + (<span class="id">Mem.nextblock</span> <span class="id">m_src0</span>) - (<span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span>))%<span class="id">positive</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Vundef</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">src_junk_val_inj</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.inject</span> (<span class="id">junk_inj</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span>) (<span class="id">src_junk_val</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">n</span> <span class="id">v</span>) <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7253')">Proof.</div>
<div class="proofscript" id="proof7253">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">src_junk_val</span>. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="id">econs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">junk_inj</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Plt_lemma</span> <span class="kwd">in</span> <span class="id">p0</span>; <span class="tactic">eauto</span>. <span class="id">clarify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">instantiate</span> (1:=0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">b</span> + <span class="id">Mem.nextblock</span> <span class="id">m_src0</span> - <span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span> + <span class="id">Mem.nextblock</span> <span class="id">m_tgt0</span> - <span class="id">Mem.nextblock</span> <span class="id">m_src0</span>)%<span class="id">positive</span> <span class="kwd">with</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">n0</span>. <span class="tactic">rewrite</span> <span class="id">Pos.sub_add</span>; <span class="tactic">try</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">Pos.add_sub</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">apply</span> <span class="id">n2</span>. <span class="tactic">eapply</span> <span class="id">Plt_lemma2</span> <span class="kwd">in</span> <span class="id">p</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Ptrofs.add_zero</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">src_junk_val_junk</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">n</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">JUNK</span>: <span class="id">JunkBlock.is_junk_value</span> <span class="id">m_tgt0</span> (<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_tgt0</span> <span class="id">n</span>) <span class="id">v</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">JunkBlock.is_junk_value</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m_src0</span> (<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_src0</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">src_junk_val</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">n</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7254')">Proof.</div>
<div class="proofscript" id="proof7254">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">JunkBlock.is_junk_value</span>, <span class="id">src_junk_val</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="id">des</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Plt_lemma</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">Plt_lemma2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">set_regset_junk</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m_src0</span> <span class="id">m_tgt0</span>: <span class="id">mem</span>) (<span class="id">n</span>: <span class="id">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rs0</span> <span class="id">rs1</span>: <span class="id">Mach.regset</span>) (<span class="id">sg</span>: <span class="id">signature</span>) (<span class="id">mr</span>: <span class="id">mreg</span>) : <span class="id">val</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Loc.notin_dec</span> (<span class="id">R</span> <span class="id">mr</span>) (<span class="id">regs_of_rpairs</span> (<span class="id">loc_arguments</span> <span class="id">sg</span>))<br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">src_junk_val</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">n</span> (<span class="id">rs1</span> <span class="id">mr</span>) <span class="kwd">else</span> <span class="id">rs0</span> <span class="id">mr</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">junk_inj_incr</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inject_incr</span> <span class="id">j</span> (<span class="id">junk_inj</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7255')">Proof.</div>
<div class="proofscript" id="proof7255">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">junk_inj</span>. <span class="id">des_ifs</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">assign_junk_blocks_parallel_inject</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.inject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">junk_inj</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_src0</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">JunkBlock.assign_junk_blocks</span> <span class="id">m_tgt0</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7256')">Proof.</div>
<div class="proofscript" id="proof7256">
&nbsp;&nbsp;<span class="id">dup</span> <span class="id">INJ</span>. <span class="id">inv</span> <span class="id">INJ</span>. <span class="tactic">unfold</span> <span class="id">junk_inj</span>.<br/>
&nbsp;&nbsp;<span class="id">econs</span>; [<span class="id">inv</span> <span class="id">mi_inj</span>; <span class="id">econs</span>|..]; <span class="id">i</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_perm</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">exfalso</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Mem.range_perm</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Z.divide_0_r</span>.<br/>
&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">memval_inject_incr</span>; [..|<span class="tactic">eapply</span> <span class="id">junk_inj_incr</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">mi_memval</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">rpapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_contents</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>. } <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_contents</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>. } <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">exfalso</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">exfalso</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">Mem.valid_block_unchanged_on</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b</span>) <span class="kwd">as</span> [[]|] <span class="id">eqn</span>:<span class="id">DELTA</span>; <span class="tactic">auto</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">DELTA</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">INJ0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Mem.valid_block_unchanged_on</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_nextblock</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">Plt_lemma2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">JunkBlock.assign_junk_blocks_perm</span> <span class="kwd">in</span> *. <span class="id">des_ifs</span>; <span class="tactic">eauto</span>; <span class="id">exfalso</span>; <span class="id">apply_all_once</span> <span class="id">Mem.perm_valid_block</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">set</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="id">des_ifs</span>; <span class="id">des</span>; <span class="tactic">eauto</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">des_ifs</span>; <span class="tactic">eauto</span>. <span class="id">zsimpl</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_valid_block</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">Plt_lemma</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">junk_inj_separated</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inject_separated</span> <span class="id">j</span> (<span class="id">junk_inj</span> <span class="id">m_src0</span> <span class="id">m_tgt0</span> <span class="id">j</span> <span class="id">n</span>) <span class="id">m_src0</span> <span class="id">m_tgt0</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7257')">Proof.</div>
<div class="proofscript" id="proof7257">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">junk_inj</span>. <span class="id">ii</span>. <span class="id">des_ifs</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">Mem.valid_block</span>. <span class="tactic">eapply</span> <span class="id">Plt_lemma</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">assign_junk_blocks_parallel</span> <span class="id">n</span> <span class="id">sm0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MSRC</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.src</span>) = <span class="id">JunkBlock.assign_junk_blocks</span> (<span class="id">SimMemInj.src</span> <span class="id">sm0</span>) <span class="id">n</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MTGT</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.tgt</span>) = <span class="id">JunkBlock.assign_junk_blocks</span> (<span class="id">SimMemInj.tgt</span> <span class="id">sm0</span>) <span class="id">n</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MINJ</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.inj</span>) = <span class="id">junk_inj</span> (<span class="id">SimMemInj.src</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.tgt</span> <span class="id">sm0</span>) (<span class="id">SimMemInj.inj</span> <span class="id">sm0</span>) <span class="id">n</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm1</span>&gt;&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMemInj.le</span>' <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;)<br/>
.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7258')">Proof.</div>
<div class="proofscript" id="proof7258">
&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">MWF</span>.<br/>
&nbsp;&nbsp;<span class="id">hexploit</span> <span class="id">assign_junk_blocks_parallel_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">INJ</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SimMemInjC.parallel_gen</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">junk_inj_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">junk_inj_separated</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">JunkBlock.assign_junk_blocks_unchanged_on</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">erewrite</span> &lt;- <span class="id">JunkBlock.assign_junk_blocks_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="id">erewrite</span> &lt;- <span class="id">JunkBlock.assign_junk_blocks_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>; <span class="id">ss</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">store_arguments_nextblock</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m0</span> <span class="id">m1</span> <span class="id">rs</span> <span class="id">vs</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STORE</span>: <span class="id">store_arguments</span> <span class="id">m0</span> <span class="id">rs</span> <span class="id">vs</span> <span class="id">sg</span> <span class="id">m1</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Plt</span> (<span class="id">Mem.nextblock</span> <span class="id">m0</span>) (<span class="id">Mem.nextblock</span> <span class="id">m1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7259')">Proof.</div>
<div class="proofscript" id="proof7259">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STORE</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">NB</span>. <span class="tactic">eapply</span> <span class="id">Mem.nextblock_alloc</span> <span class="kwd">in</span> <span class="id">ALC</span>. <span class="id">erewrite</span> <span class="id">ALC</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">store_arguments_max_perm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m0</span> <span class="id">m1</span> <span class="id">rs</span> <span class="id">vs</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STORE</span>: <span class="id">store_arguments</span> <span class="id">m0</span> <span class="id">rs</span> <span class="id">vs</span> <span class="id">sg</span> <span class="id">m1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALID</span>: <span class="id">Mem.valid_block</span> <span class="id">m0</span> <span class="id">b</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.perm</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">ofs</span> &lt;2= <span class="id">Mem.perm</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">ofs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7260')">Proof.</div>
<div class="proofscript" id="proof7260">
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STORE</span>. <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_unchanged_on_2</span> <span class="kwd">in</span> <span class="id">PR</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">UNCH</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_4</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.alloc_result</span> <span class="kwd">in</span> <span class="id">ALC</span>. <span class="id">ii</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ss</span>. <span class="id">des_ifs</span>. <span class="tactic">eapply</span> <span class="id">Mem.alloc_result</span> <span class="kwd">in</span> <span class="id">ALC</span>. <span class="id">ii</span>. <span class="id">clarify</span>. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.valid_block_alloc</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">store_arguments_parallel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sm0</span> <span class="id">m_tgt1</span> <span class="id">rs_tgt</span> <span class="id">vs</span> <span class="id">vs</span>' <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGSRC</span>: <span class="id">store_arguments</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt</span>) <span class="id">rs_tgt</span> <span class="id">vs</span>' <span class="id">sg</span> <span class="id">m_tgt1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TYP</span>: <span class="id">Val.has_type_list</span> <span class="id">vs</span>' <span class="id">sg</span>.(<span class="id">sig_args</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SZ</span>: 4 * <span class="id">size_arguments</span> <span class="id">sg</span> &lt;= <span class="id">Ptrofs.max_unsigned</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VALINJ</span>: <span class="id">Val.inject_list</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>) <span class="id">vs</span> <span class="id">vs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm0</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm1</span> <span class="id">rs_src</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">ARGTGT</span>: <span class="id">store_arguments</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.src</span>) <span class="id">rs_src</span> <span class="id">vs</span> <span class="id">sg</span> <span class="id">sm1</span>.(<span class="id">SimMemInj.src</span>)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">INJ</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.inj</span>) = (<span class="id">update_meminj</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>) (<span class="id">Mem.nextblock</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.src</span>)) (<span class="id">Mem.nextblock</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt</span>)) 0)&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MWF</span>: <span class="id">SimMemInj.wf</span>' <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MLE</span>: <span class="id">SimMemInj.le</span>' <span class="id">sm0</span> <span class="id">sm1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">MTGT</span>: <span class="id">sm1</span>.(<span class="id">SimMemInj.tgt</span>) = <span class="id">m_tgt1</span>&gt;&gt;) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt;<span class="id">AGREE</span>: <span class="id">StoreArgumentsProps.agree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">update_meminj</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.inj</span>) (<span class="id">Mem.nextblock</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.src</span>)) (<span class="id">Mem.nextblock</span> <span class="id">sm0</span>.(<span class="id">SimMemInj.tgt</span>)) 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs_src</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs_tgt</span>&gt;&gt;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7261')">Proof.</div>
<div class="proofscript" id="proof7261">
&nbsp;&nbsp;<span class="id">cinv</span> <span class="id">MWF</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">store_arguments_parallel_inject</span>; <span class="tactic">eauto</span>. <span class="id">i</span>. <span class="id">des</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">SimMemInjC.parallel_gen</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">update_meminj</span>. <span class="id">ii</span>. <span class="id">des_ifs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">Plt_strict</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">update_meminj</span>. <span class="id">ii</span>. <span class="id">des_ifs</span>. <span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id">Plt_strict</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">store_arguments_unchanged_on</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Mem.unchanged_on_implies</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">store_arguments_unchanged_on</span>; <span class="tactic">eauto</span>. <span class="id">ss</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">store_arguments_max_perm</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">ARGSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">ii</span>. <span class="tactic">eapply</span> <span class="id">store_arguments_max_perm</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">ARGSRC</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">i</span>. <span class="id">des</span>. <span class="id">esplits</span>; <span class="tactic">eauto</span>; <span class="id">ss</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">undef_bisim</span> (<span class="id">rs_src</span> <span class="id">rs_tgt</span>: <span class="id">regset</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">r</span>: <span class="id">mreg</span>) (<span class="id">IN</span>: <span class="id">Conventions1.is_callee_save</span> <span class="id">r</span> = <span class="id">true</span>) (<span class="id">UNDEF</span>: <span class="id">rs_src</span> (<span class="id">to_preg</span> <span class="id">r</span>) = <span class="id">Vundef</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs_tgt</span> (<span class="id">to_preg</span> <span class="id">r</span>) = <span class="id">Vundef</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wf_init_rs</span> (<span class="id">rs</span>: <span class="id">regset</span>): <span class="kwd">Prop</span> :=<br/>
| <span class="id">wf_init_rs_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSPDEF</span>: <span class="id">rs</span> <span class="id">RSP</span> &lt;&gt; <span class="id">Vundef</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TPTR</span>: <span class="id">Val.has_type</span> (<span class="id">rs</span> <span class="id">RA</span>) <span class="id">Tptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RADEF</span>: <span class="id">rs</span> <span class="id">RA</span> &lt;&gt; <span class="id">Vundef</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_init_rs</span> <span class="id">rs</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wf_init_rs_asmstyle</span> (<span class="id">rs</span>: <span class="id">regset</span>): <span class="kwd">Prop</span> :=<br/>
| <span class="id">wf_init_rs_amstyle_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TPTR</span>: <span class="id">Val.has_type</span> (<span class="id">rs</span> <span class="id">RA</span>) <span class="id">Tptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RADEF</span>: <span class="id">rs</span> <span class="id">RA</span> &lt;&gt; <span class="id">Vundef</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_init_rs_asmstyle</span> <span class="id">rs</span><br/>
.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wf_init_rss</span>: <span class="id">signature</span> -&gt; <span class="id">regset</span> -&gt; <span class="id">regset</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">wf_init_rss_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sg</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINITSRC</span>: <span class="id">wf_init_rs</span> <span class="id">init_rs_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINITTGT</span>: <span class="id">wf_init_rs</span> <span class="id">init_rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNDEF</span>: <span class="id">undef_bisim</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CSTYLE</span>: <span class="id">sg</span>.(<span class="id">sig_cstyle</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_init_rss</span> <span class="id">sg</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span><br/>
| <span class="id">wf_init_rss_asmstyle</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sg</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINITSRC</span>: <span class="id">wf_init_rs_asmstyle</span> <span class="id">init_rs_src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINITTGT</span>: <span class="id">wf_init_rs_asmstyle</span> <span class="id">init_rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CSTYLE</span>: <span class="id">sg</span>.(<span class="id">sig_cstyle</span>) = <span class="id">false</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_init_rss</span> <span class="id">sg</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span><br/>
.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">match_states_ext</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">skenv_link_tgt</span> : <span class="id">SkEnv.t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ge_src</span> <span class="id">ge_tgt</span>: <span class="id">genv</span>)<br/>
&nbsp;&nbsp;: <span class="id">unit</span> -&gt; <span class="id">AsmC.state</span> -&gt; <span class="id">AsmC.state</span> -&gt; (@<span class="id">SimMem.t</span> <span class="id">SimMemExt.SimMemExt</span>) -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">match_states_ext_intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">m_src</span> <span class="id">m_tgt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sm0</span> : @<span class="id">SimMem.t</span> <span class="id">SimMemExt.SimMemExt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREE</span>: <span class="id">AsmStepExt.agree</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREEINIT</span>: <span class="id">AsmStepExt.agree</span> <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MCOMPATSRC</span>: <span class="id">m_src</span> = <span class="id">sm0</span>.(<span class="id">SimMem.src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MCOMPATTGT</span>: <span class="id">m_tgt</span> = <span class="id">sm0</span>.(<span class="id">SimMem.tgt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MWF</span>: <span class="id">SimMem.wf</span> <span class="id">sm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FINDF</span>: <span class="id">Genv.find_funct</span> <span class="id">ge_src</span> (<span class="id">init_rs_src</span> <span class="id">PC</span>) = <span class="id">Some</span> (<span class="id">Internal</span> <span class="id">fd</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WFINITRS</span>: <span class="id">wf_init_rss</span> <span class="id">fd</span>.(<span class="id">fn_sig</span>) <span class="id">init_rs_src</span> <span class="id">init_rs_tgt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RAWF</span>: <span class="id">Genv.find_funct</span> <span class="id">skenv_link_tgt</span> (<span class="id">init_rs_tgt</span> <span class="id">RA</span>) = <span class="id">None</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states_ext</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">skenv_link_tgt</span> <span class="id">ge_src</span> <span class="id">ge_tgt</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs_src</span> (<span class="id">Asm.State</span> <span class="id">rs_src</span> <span class="id">m_src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AsmC.mkstate</span> <span class="id">init_rs_tgt</span> (<span class="id">Asm.State</span> <span class="id">rs_tgt</span> <span class="id">m_tgt</span>)) <span class="id">sm0</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">asm_init_rs</span> (<span class="id">rs_src</span> <span class="id">rs_tgt</span>: <span class="id">Mach.regset</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sg</span> <span class="id">v_pc</span> <span class="id">v_ra</span> <span class="id">blk</span> :=<br/>
&nbsp;&nbsp;(((<span class="id">to_pregset</span> (<span class="id">set_regset</span> <span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">sg</span>)) # <span class="id">PC</span> &lt;- <span class="id">v_pc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# <span class="id">RA</span> &lt;- <span class="id">v_ra</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;# <span class="id">RSP</span> &lt;- (<span class="id">Vptr</span> <span class="id">blk</span> <span class="id">Ptrofs.zero</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">asm_init_rs_undef_bisim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs_src</span> <span class="id">rs_tgt</span> <span class="id">sg</span> <span class="id">v_pc</span> <span class="id">v_ra</span> <span class="id">blk</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">undef_bisim</span> (<span class="id">asm_init_rs</span> <span class="id">rs_src</span> (<span class="id">to_mregset</span> <span class="id">rs_tgt</span>) <span class="id">sg</span> <span class="id">v_pc</span> <span class="id">v_ra</span> <span class="id">blk</span>) <span class="id">rs_tgt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7262')">Proof.</div>
<div class="proofscript" id="proof7262">
&nbsp;&nbsp;<span class="id">ii</span>. <span class="tactic">unfold</span> <span class="id">asm_init_rs</span>, <span class="id">to_pregset</span>, <span class="id">set_regset</span>, <span class="id">to_mregset</span>, <span class="id">Pregmap.set</span>, <span class="id">to_preg</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">des_ifs</span>; <span class="tactic">try</span> (<span class="tactic">by</span> <span class="tactic">unfold</span> <span class="id">preg_of</span> <span class="kwd">in</span> *; <span class="id">des_ifs</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">to_preg_to_mreg</span> <span class="kwd">in</span> *. <span class="id">clarify</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loc_args_callee_save_disjoint</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">NNPP</span>. <span class="id">ii</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">loc_notin_not_in</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
